---
title: "Caracterización Jericó"
author: "Lehyton Arenas"
date: "3/5/2021"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

setwd("/Volumes/Respaldo/Google Drive-Actualizado/Ecsim/2021_CaracterizaciónJericó/1_EntregablesLehyton")

# Paquetes a usar
library(tidyverse)
library(plyr); library(dplyr)
library(readxl)
library(writexl)
library(survey)
```

## Caracterización Microdata ECVD2019: con FExp

```{r Data ECVD2019}
#### Data original ####

# Datas iniciales de ECV Antioquia 2019:
ECVPersonas <- read.csv("/Volumes/Respaldo/Google Drive-Actualizado/Ecsim/2021_CaracterizaciónJericó/3_InsumosDiego&Otros/ECV2019_v2_Planeacion/ECV2019_Personas_Anonimizada.csv",sep = ";", header = TRUE, dec = ",")

ECVHogares <- read.csv("/Volumes/Respaldo/Google Drive-Actualizado/Ecsim/2021_CaracterizaciónJericó/3_InsumosDiego&Otros/ECV2019_v2_Planeacion/ECV2019_Hogares_Anonimizada.csv",sep = ";", header = TRUE, dec = ",")

#### DFs por subpoblaciones #### 

# Traemos solo población de la Provincia del Cartama: Individuos
# Renombramos
CartamaPersonas <- ECVPersonas %>% 
  dplyr::filter(.,NomMpio=="CARAMANTA" | NomMpio=="CONCORDIA" | NomMpio=="FREDONIA" | NomMpio=="HISPANIA"
                  | NomMpio=="JERICÓ" | NomMpio=="LA PINTADA" | NomMpio=="PUEBLORRICO" | NomMpio=="SALGAR"
                  | NomMpio=="TÁMESIS" | NomMpio=="TARSO" | NomMpio=="VALPARAÍSO" | NomMpio=="VENECIA") %>% 
  dplyr::mutate(NomMpio=ifelse(NomMpio=="CARAMANTA","Caramanta",NomMpio),
              NomMpio=ifelse(NomMpio=="CONCORDIA","Concordia",NomMpio),
              NomMpio=ifelse(NomMpio=="FREDONIA","Fredonia",NomMpio),
              NomMpio=ifelse(NomMpio=="HISPANIA","Hispania",NomMpio),
              NomMpio=ifelse(NomMpio=="JERICÓ","Jericó",NomMpio),
              NomMpio=ifelse(NomMpio=="LA PINTADA","La Pintada",NomMpio),
              NomMpio=ifelse(NomMpio=="PUEBLORRICO","Pueblorrico",NomMpio),
              NomMpio=ifelse(NomMpio=="SALGAR","Salgar",NomMpio),
              NomMpio=ifelse(NomMpio=="TÁMESIS","Támesis",NomMpio),
              NomMpio=ifelse(NomMpio=="TARSO","Tarso",NomMpio),
              NomMpio=ifelse(NomMpio=="VALPARAÍSO","Valparaíso",NomMpio),
              NomMpio=ifelse(NomMpio=="VENECIA","Venecia",NomMpio))

# Traemos solo población de Jericó: Individuos
JericoPersonas <- CartamaPersonas %>% 
  dplyr::filter(NomMpio=="Jericó")

# Traemos solo población de Jericó: Hogares
JericoHogares <- ECVHogares%>% 
  dplyr::filter(.,NomMpio=="JERICÓ")%>% 
  dplyr::mutate(NomMpio=ifelse(NomMpio=="JERICÓ","Jericó",NomMpio))

# Traemos data para Cartama: Hogares
CartamaHogares <- ECVHogares%>% 
  dplyr::filter(.,NomMpio=="CARAMANTA" | NomMpio=="CONCORDIA" | NomMpio=="FREDONIA" | NomMpio=="HISPANIA"
                  | NomMpio=="JERICÓ" | NomMpio=="LA PINTADA" | NomMpio=="PUEBLORRICO" | NomMpio=="SALGAR"
                  | NomMpio=="TÁMESIS" | NomMpio=="TARSO" | NomMpio=="VALPARAÍSO" | NomMpio=="VENECIA") %>% 
  dplyr::mutate(NomMpio=ifelse(NomMpio=="CARAMANTA","Caramanta",NomMpio),
              NomMpio=ifelse(NomMpio=="CONCORDIA","Concordia",NomMpio),
              NomMpio=ifelse(NomMpio=="FREDONIA","Fredonia",NomMpio),
              NomMpio=ifelse(NomMpio=="HISPANIA","Hispania",NomMpio),
              NomMpio=ifelse(NomMpio=="JERICÓ","Jericó",NomMpio),
              NomMpio=ifelse(NomMpio=="LA PINTADA","La Pintada",NomMpio),
              NomMpio=ifelse(NomMpio=="PUEBLORRICO","Pueblorrico",NomMpio),
              NomMpio=ifelse(NomMpio=="SALGAR","Salgar",NomMpio),
              NomMpio=ifelse(NomMpio=="TÁMESIS","Támesis",NomMpio),
              NomMpio=ifelse(NomMpio=="TARSO","Tarso",NomMpio),
              NomMpio=ifelse(NomMpio=="VALPARAÍSO","Valparaíso",NomMpio),
              NomMpio=ifelse(NomMpio=="VENECIA","Venecia",NomMpio))

#### Data Tipo Svy #### 

# Creamos objeto tipo Svy para Cartama: Individuos
Cartama_Svy <- svydesign(ids=~0,weights=~FexpPer_EQ,
                                  data=CartamaPersonas)

CartamaHogar_Svy <- svydesign(ids=~0,weights=~FexpHog,
                                  data=CartamaHogares)

# Creamos objeto tipo Svy para Jericó: Individuos
Jerico_Svy <- svydesign(ids=~0,weights=~FexpPer_EQ,
                                  data=JericoPersonas)

# Creamos objeto tipo Svy para Jericó: Hogares
JericoHogar_Svy <- svydesign(ids=~0,weights=~FexpHog,
                                  data=JericoHogares)

#### Algunos cálculos ####

# Creamos el total de población en cada municipio 
TotalMcipio <- svytotal(~NomMpio,design = Cartama_Svy, na = TRUE)

TotalMcipio <- as.data.frame(TotalMcipio) %>% 
  dplyr::select(.,-c("SE")) %>% 
  dplyr::rename(PoblacionTotal=total)

Municipios <- c("Caramanta","Concordia","Fredonia","Hispania","Jericó","La Pintada","Pueblorrico","Salgar","Támesis","Tarso","Valparaíso","Venecia")

TotalMcipio_v2 <- data.frame(Municipios,TotalMcipio)

# Creamos el total de hogares en cada municipio 
TotalMcipioHogar <- svytotal(~NomMpio,design = CartamaHogar_Svy, na = TRUE)

TotalMcipioHogar <- as.data.frame(TotalMcipioHogar) %>% 
  dplyr::select(.,-c("SE")) %>% 
  dplyr::rename(PoblacionTotal=total)

Municipios <- c("Caramanta","Concordia","Fredonia","Hispania","Jericó","La Pintada","Pueblorrico","Salgar","Támesis","Tarso","Valparaíso","Venecia")

TotalMcipioHog_v2 <- data.frame(Municipios,TotalMcipioHogar)
```

```{r Educación}
#### Tema: Condición educativa. Cartama ####
# Pregunta data: "P_043"
# Creamos totales y subtotales:
TotalesYSubt <- as.data.frame(svytable(~NomMpio+P_043, design = Cartama_Svy)) %>% 
  dplyr::rename(Municipios=NomMpio,Subtotal=Freq)

# Conacatenamos
Proporciones <- join_all(list(TotalMcipio_v2,TotalesYSubt), by=c("Municipios"),type = "full")

Proporciones <- Proporciones %>% 
  dplyr::mutate(Porcentaje=round((Subtotal/PoblacionTotal)*100,2),
                P_043=ifelse(P_043==1,"Presencial",P_043),
                P_043=ifelse(P_043==2,"Virtual",P_043),
                P_043=ifelse(P_043==3,"No estudia",P_043)
                )

# Graficamos:
ggplot(Proporciones, aes(x = Porcentaje, y = Municipios, fill=P_043))+
  geom_col()+
  labs(x="Porcentaje",y="Municipios",fill="Condición de estudio")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.8),
            size=4, vjust=0.5, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.3)),
        legend.text=element_text(size=rel(1.3)))

# Paso opcional: exportamos data:
write_xlsx(Proporciones, "Proporciones.xlsx")

# Eliminamos intermedios:
rm(TotalMcipio,TotalMcipio_v2,Municipios,TotalesYSubt,Proporciones)

#### Tema: Causa para no continuar estudios. Cartama ####
# Pregunta data: : P:046

# Creamos totales y subtotales:
TotalesYSubt <- as.data.frame(svytable(~NomMpio+P_046, design = Cartama_Svy)) %>% 
  dplyr::rename(Municipios=NomMpio,Subtotal=Freq) %>% 
  dplyr::filter(.,P_046!="-99",P_046!="-88")
  
TotalesYSubt$Columna <- c("Columna")

TotalesYSubt <- TotalesYSubt %>% 
  dplyr::mutate(Columna=ifelse(P_046=="1","No está en edad escolar",Columna),
                Columna=ifelse(P_046=="2","Ya terminó",Columna),
                Columna=ifelse(P_046=="3","Costos educativos",Columna),
                Columna=ifelse(P_046=="4","Oficios del hogar",Columna),
                Columna=ifelse(P_046=="5","Falta de tiempo",Columna),
                Columna=ifelse(P_046=="6","Embarazo",Columna),
                Columna=ifelse(P_046=="7","Inseguridad",Columna),
                Columna=ifelse(P_046=="8","Falta de cupos",Columna),
                Columna=ifelse(P_046=="9","No hay centro educativo",Columna),
                Columna=ifelse(P_046=="10","Necesita trabajar",Columna),
                Columna=ifelse(P_046=="11","No le gusta estudiar",Columna),
                Columna=ifelse(P_046=="12","Enfermedad",Columna),
                Columna=ifelse(P_046=="13","Necesita educación especial",Columna),
                Columna=ifelse(P_046=="14","Malos tratos en colegio",Columna),
                Columna=ifelse(P_046=="15","Se casó o formó pareja",Columna),
                Columna=ifelse(P_046=="16","Abandono de residencia",Columna),
                Columna=ifelse(P_046=="17","Bajo rendimiento",Columna),
                Columna=ifelse(P_046=="18","No tiene documentos necesarios",Columna),
                Columna=ifelse(P_046=="19","Razones familiares",Columna),
                Columna=ifelse(P_046=="20","Servicio militar",Columna),
                Columna=ifelse(P_046=="21","No responde",Columna)
                )

# Hallamos los totales por municipio:
TotalesYSubt_v2 <- TotalesYSubt %>% 
  dplyr::group_by(Municipios) %>% 
  dplyr::summarise(
      Total = sum(Subtotal,na.rm = TRUE))

# Concatenamos:
TotalesYSubt_v3 <- join_all(list(TotalesYSubt_v2,TotalesYSubt), by=c("Municipios"),type = "full")

# Hacemos los cálculos:
TotalesYSubt_v3 <- TotalesYSubt_v3 %>% 
  dplyr::mutate(Porcentaje=round((Subtotal/Total)*100,2)
                )
# hacemos una prueba para validar el caso de Jericó:
Prueba <- TotalesYSubt_v3 %>% 
  dplyr::filter(Municipios=="Jericó")

# Graficamos:
ggplot(Prueba,aes(x=Porcentaje,y=reorder(Columna,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(x="Porcentaje",y="Jericó: Causas de no estudiar")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0.5, hjust=-0.1 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)))+
  scale_x_continuous(limits=c(0,60))

# Paso opcional: exportamos data:
write_xlsx(TotalesYSubt_v3, "TotalesYSubt_v3.xlsx")

# eliminamos intermedios:
rm(TotalesYSubt,TotalesYSubt_v2,TotalesYSubt_v3,Prueba)

#### Tema: Causa para no continuar estudios. jericó ####
# Pregunta data: : P:046

# Creamos totales y subtotales:
TotalesYSubt2 <- as.data.frame(svytable(~NomMpio+P_046, design = Jerico_Svy)) %>% 
  dplyr::rename(Municipios=NomMpio,Subtotal=Freq) %>% 
  dplyr::filter(.,P_046!="-99",P_046!="-88")
  
TotalesYSubt2$Columna <- c("Columna")

TotalesYSubt2 <- TotalesYSubt2 %>% 
  dplyr::mutate(Columna=ifelse(P_046=="2","Ya terminó",Columna),
                Columna=ifelse(P_046=="3","Costos educativos",Columna),
                Columna=ifelse(P_046=="4","Oficios del hogar",Columna),
                Columna=ifelse(P_046=="5","Falta de tiempo",Columna),
                Columna=ifelse(P_046=="6","Embarazo",Columna),
                Columna=ifelse(P_046=="7","Inseguridad",Columna),
                Columna=ifelse(P_046=="8","Falta de cupos",Columna),
                Columna=ifelse(P_046=="9","No hay centro educativo",Columna),
                Columna=ifelse(P_046=="10","Necesita trabajar",Columna),
                Columna=ifelse(P_046=="11","No le gusta estudiar",Columna),
                Columna=ifelse(P_046=="12","Enfermedad",Columna),
                Columna=ifelse(P_046=="16","Abandono de residencia",Columna),
                Columna=ifelse(P_046=="19","Razones familiares",Columna),
                Total=sum(Subtotal),
                Porcentaje=round((Subtotal/Total)*100,2)
                )

# Graficamos:
ggplot(TotalesYSubt,aes(x=Porcentaje,y=reorder(Columna,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(x="Porcentaje",y="Jericó: Causas de no estudiar")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0.5, hjust=-0.1 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)))+
  scale_x_continuous(limits=c(0,60))

# Paso opcional: exportamos data:
write_xlsx(TotalesYSubt, "TotalesYSubt.xlsx")

# eliminamos intermedios:
rm(TotalesYSubt)

#### Tema: Ultimo nivel de estudios. Jericó ####
# Pregunta data: : P:049

# Creamos totales y subtotales:
TotalesYSubt <- as.data.frame(svytable(~NomMpio+P_049, design = Jerico_Svy)) %>% 
  dplyr::rename(Municipios=NomMpio,Subtotal=Freq) 

TotalesYSubt$Columna <- c("Columna")

TotalesYSubt <- TotalesYSubt %>% 
  dplyr::mutate(Columna=ifelse(P_049==0,"Ninguno",Columna),
                Columna=ifelse(P_049==1,"Preescolar",Columna),
                Columna=ifelse(P_049==2,"Primaria",Columna),
                Columna=ifelse(P_049==3,"Secundaria",Columna),
                Columna=ifelse(P_049==4,"Media",Columna),
                Columna=ifelse(P_049==5,"Técnico",Columna),
                Columna=ifelse(P_049==6,"Tecnológico",Columna),
                Columna=ifelse(P_049==7,"Pregrado",Columna),
                Columna=ifelse(P_049==8,"Especialización",Columna),
                Columna=ifelse(P_049==9,"Maestría",Columna),
                Columna=ifelse(P_049==10,"Doctorado",Columna),
                Total=sum(Subtotal),
                Porcentaje=round((Subtotal/Total)*100,2)
                )

# Paso opcional: poner data en factores para un orden establecido:
TotalesYSubt$Columna <- factor(TotalesYSubt$Columna, levels=c("Ninguno",         "Preescolar","Primaria","Secundaria","Media","Técnico","Tecnológico","Pregrado","Especialización","Maestría"))


# Graficamos:
ggplot(TotalesYSubt,aes(x=Porcentaje,y=Columna))+
  geom_col(fill="coral")+
  labs(x="Porcentaje",y="Jericó: Ultimo nivel de estudios")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0.5, hjust=-0.1 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)))+
  scale_x_continuous(limits=c(0,35))

# Paso opcional: exportamos data:
write_xlsx(TotalesYSubt, "TotalesYSubt.xlsx")

# eliminamos:
rm(TotalesYSubt)

#### Tema: Area del conocimiento. Cartama  ####
# Pregunta data: : P:052

# Creamos totales y subtotales:
TotalesYSubt <- as.data.frame(svytable(~NomMpio+P_052, design=Cartama_Svy)) %>% 
  dplyr::rename(Municipios=NomMpio,Subtotal=Freq) %>% 
  dplyr::filter(.,P_052!="-99",P_052!="-98",P_052!="-88") 

TotalesYSubt$Columna <- c("Columna")

TotalesYSubt <- TotalesYSubt %>% 
  dplyr::mutate(Columna=ifelse(P_052==1,"Agronomia y afines",Columna),
                Columna=ifelse(P_052==2,"Bellas Artes",Columna),
                Columna=ifelse(P_052==3,"Ciencias de la Educación",Columna),
                Columna=ifelse(P_052==4,"Ciencias de la Salud",Columna),
                Columna=ifelse(P_052==5,"Ciencias Sociales y afines",Columna),
                Columna=ifelse(P_052==6,"Economia y afines",Columna),
                Columna=ifelse(P_052==7,"Humanidades y religiosas",Columna),
                Columna=ifelse(P_052==8,"Ing. Sistemas y afines",Columna),
                Columna=ifelse(P_052==9,"Ing. Industrial y afines",Columna),
                Columna=ifelse(P_052==10,"Ing. Electrónica y afines",Columna),
                Columna=ifelse(P_052==11,"Ing. Mecánica y afines",Columna),
                Columna=ifelse(P_052==12,"Ing. Ambiental y afines",Columna),
                Columna=ifelse(P_052==13,"Ing. Química y afines ",Columna),
                Columna=ifelse(P_052==14,"Ing. Civil y afines",Columna),
                Columna=ifelse(P_052==15,"Matemáticas y C. Naturales",Columna),
                Columna=ifelse(P_052==16,"Otras",Columna)
                )

# Hallamos los totales por municipio:
TotalesYSubt_v2 <- TotalesYSubt %>% 
  dplyr::group_by(Municipios) %>% 
  dplyr::summarise(
      Total = sum(Subtotal,na.rm = TRUE))

# Concatenamos:
TotalesYSubt_v3 <- join_all(list(TotalesYSubt_v2,TotalesYSubt), by=c("Municipios"),type = "full")

# Hacemos los cálculos:
TotalesYSubt_v3 <- TotalesYSubt_v3 %>% 
  dplyr::mutate(Porcentaje=round((Subtotal/Total)*100,2)
                )

# hacemos una prueba para validar el caso de Jericó:
Prueba <- TotalesYSubt_v3 %>% 
  dplyr::filter(Municipios=="Jericó")

# Graficamos:
ggplot(Prueba,aes(x=Porcentaje,y=reorder(Columna,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(x="Porcentaje",y="Jericó: Area de conocimiento")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0.5, hjust=-0.1 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)))+
  scale_x_continuous(limits=c(0,40))

# Paso opcional: exportamos data:
write_xlsx(TotalesYSubt_v3, "TotalesYSubt_v3.xlsx")

# eliminamos:
rm(Prueba,TotalesYSubt,TotalesYSubt_v2,TotalesYSubt_v3)

#### Tema: Area del conocimiento. Jericó  ####
# Pregunta data: : P:052

# Creamos totales y subtotales:
TotalesYSubt <- as.data.frame(svytable(~NomMpio+P_052, design=Jerico_Svy)) %>% 
  dplyr::rename(Municipios=NomMpio,Subtotal=Freq) %>% 
  dplyr::filter(.,P_052!="-98",
                 P_052!="-88") 

TotalesYSubt$Columna <- c("Columna")

TotalesYSubt <- TotalesYSubt %>% 
  dplyr::mutate(Columna=ifelse(P_052==1,"Agronomia y afines",Columna),
                Columna=ifelse(P_052==2,"Bellas Artes",Columna),
                Columna=ifelse(P_052==3,"Ciencias de la Educación",Columna),
                Columna=ifelse(P_052==4,"Ciencias de la Salud",Columna),
                Columna=ifelse(P_052==5,"Ciencias Sociales y afines",Columna),
                Columna=ifelse(P_052==6,"Economia y afines",Columna),
                Columna=ifelse(P_052==7,"Humanidades y religiosas",Columna),
                Columna=ifelse(P_052==8,"Ing. Sistemas y afines",Columna),
                Columna=ifelse(P_052==9,"Ing. Industrial y afines",Columna),
                Columna=ifelse(P_052==10,"Ing. Electrónica y afines",Columna),
                Columna=ifelse(P_052==11,"Ing. Mecánica y afines",Columna),
                Columna=ifelse(P_052==12,"Ing. Ambiental y afines",Columna),
                Columna=ifelse(P_052==13,"Ing. Química y afines ",Columna),
                Columna=ifelse(P_052==14,"Ing. Civil y afines",Columna),
                Columna=ifelse(P_052==15,"Matemáticas y C. Naturales",Columna),
                Columna=ifelse(P_052==16,"Otras",Columna),
                Total=sum(Subtotal),
                Porcentaje=round((Subtotal/Total)*100,2)
                )


# Graficamos:
ggplot(TotalesYSubt,aes(x=Porcentaje,y=reorder(Columna,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(x="Porcentaje",y="Jericó: Area de conocimiento")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0.5, hjust=-0.1 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)))+
  scale_x_continuous(limits=c(0,40))

# Paso opcional: exportamos data:
write_xlsx(TotalesYSubt, "TotalesYSubt.xlsx")

# eliminamos:
rm(prueba,TotalesYSubt)

```

```{r Seguridad social}
#### Tema: Afiliaciones Pensiones y ARL. Cartama ####

# Calculamos el total de Ocupados:
# Usamos la metoddología de la ficha de Planeación
Ocupados <- CartamaPersonas %>% 
  dplyr::filter((Zona==1 & P_021>=12) | (Zona==2 & P_021>=10),
                (P_077==1 | P_080==1 | P_081==1 | P_082==1)) 

# Transformamos los ocupados en Svy
Ocupados_Svy <- svydesign(ids=~0,weights=~FexpPer_EQ,
                                  data=Ocupados)

# Calculamos total Ocupados por Municipio
OcupadosMcipio <- svytotal(~NomMpio,design=Ocupados_Svy, na=TRUE)

OcupadosMcipio <- as.data.frame(OcupadosMcipio) %>% 
  dplyr::select(.,-c("SE")) %>% 
  dplyr::rename(OcupadosTotal=total)

Municipios <- c("Caramanta","Concordia","Fredonia","Hispania","Jericó","La Pintada","Pueblorrico","Salgar","Támesis","Tarso","Valparaíso","Venecia")

OcupadosMcipio_v2 <- data.frame(Municipios,OcupadosMcipio)

# Pensiones:
# Pregunta data: "P_075"
Pensiones <- as.data.frame(svytable(~NomMpio+P_075, design=Cartama_Svy)) %>% 
  dplyr::rename(Municipios=NomMpio,PensionesCol=Freq) %>% 
  dplyr::filter(P_075==1)

# ARL:
# Pregunta data: "P_076"
ARL <- as.data.frame(svytable(~NomMpio+P_076, design=Cartama_Svy)) %>% 
  dplyr::rename(Municipios=NomMpio,ARLCol=Freq) %>% 
  dplyr::filter(P_076==1)

# Concatenamos
Afiliaciones <- join_all(list(OcupadosMcipio_v2,Pensiones,ARL), by=c("Municipios"),type = "full") %>% 
  dplyr::mutate(PorcPensiones=round((PensionesCol/OcupadosTotal)*100,2),
                PorcARL=round((ARLCol/OcupadosTotal)*100,2))%>% 
  dplyr::select(.,c("Municipios","PorcPensiones","PorcARL")) %>% 
  dplyr::rename(Pensiones=PorcPensiones,ARL=PorcARL)

# Pasamos a formato largo
Afiliaciones2 <- Afiliaciones %>% 
  gather("Afiliacion", value= "Porcentaje",c("Pensiones","ARL"))

# Graficamos:
ggplot(Afiliaciones2, aes(x=Porcentaje,y=Municipios,fill=Afiliacion))+
  geom_col(position="dodge")+
  labs(x="Porcentaje",y="Municipios",fill="Afiliación:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.5, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top")+
  scale_x_continuous(limits=c(0,45))

# Paso opcional: exportamos data:
write_xlsx(Afiliaciones2, "Afiliaciones2.xlsx")

# eliminamos intermedios:
rm(Ocupados,Ocupados_Svy,OcupadosMcipio,OcupadosMcipio_v2,Pensiones,ARL,Afiliaciones,Afiliaciones2,Municipios)
```

```{r Recreación}
#### Tema: Participación comunitaria. Jericó ####
# Pregunta data: : P:035

# Creamos totales y subtotales:
TotalesYSubt <- as.data.frame(svytable(~NomMpio+P_035,design=Jerico_Svy)) %>% 
  dplyr::rename(Municipios=NomMpio,Subtotal=Freq) %>% 
  dplyr::filter(P_035!=-88)

TotalesYSubt$Columna <- c("Columna")

TotalesYSubt <- TotalesYSubt %>% 
  dplyr::mutate(Columna=ifelse(P_035==1,"Asoc. Padres Familia",Columna),
                Columna=ifelse(P_035==2,"Corporaciones",Columna),
                Columna=ifelse(P_035==3,"Juntas Admon Locales",Columna),
                Columna=ifelse(P_035==4,"Asociaciones de mujeres",Columna),
                Columna=ifelse(P_035==5,"Grupos juveniles",Columna),
                Columna=ifelse(P_035==6,"Veedurías ciudadanas",Columna),
                Columna=ifelse(P_035==7,"Junta acción comunal",Columna),
                Columna=ifelse(P_035==8,"Clubes del adulto mayor",Columna),
                Columna=ifelse(P_035==9,"Asambleas barriales",Columna),
                Columna=ifelse(P_035==10,"Consejos comunales",Columna),
                Columna=ifelse(P_035==11,"Comités comunitarios salud",Columna),
                Columna=ifelse(P_035==12,"Organización de victimas",Columna),
                Columna=ifelse(P_035==13,"Asociación de usuarios",Columna),
                Columna=ifelse(P_035==14,"Sindicatos",Columna),
                Columna=ifelse(P_035==15,"Organización de base",Columna),
                Columna=ifelse(P_035==16,"Partido político",Columna),
                Columna=ifelse(P_035==17,"Asociación cáracter ambiental",Columna),
                Columna=ifelse(P_035==18,"Otro",Columna),
                Columna=ifelse(P_035==19,"Ninguno",Columna),
                Total=sum(Subtotal),
                Porcentaje=round((Subtotal/Total)*100,2)
                )

# Graficamos:

ggplot(TotalesYSubt,aes(x=Porcentaje,y=reorder(Columna,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(x="Porcentaje",y="Jericó: Participación comunitaria")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0.5, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)))+
  scale_x_continuous(limits=c(0,100))

# Paso opcional: exportamos data:
write_xlsx(TotalesYSubt, "TotalesYSubt.xlsx")

# eliminamos intermedios
rm(TotalesYSubt)
```

```{r Movilidad}
#### Tema: Movilidad laboral. Jericó ####
# Pregunta data: : P:094

# Creamos totales y subtotales:
TotalesYSubt <- as.data.frame(svytable(~NomMpio+P_094,design=Jerico_Svy)) %>% 
  dplyr::rename(Municipios=NomMpio,Subtotal=Freq) %>% 
  dplyr::filter(P_094!=-99,P_094!=-88,P_094!=-77)

TotalesYSubt$Columna <- c("Columna")

TotalesYSubt <- TotalesYSubt %>% 
  dplyr::mutate(Columna=ifelse(P_094==1,"Caminando",Columna),
                Columna=ifelse(P_094==2,"Bicicleta",Columna),
                Columna=ifelse(P_094==3,"Moto",Columna),
                Columna=ifelse(P_094==4,"Bus/Buseta",Columna),
                Columna=ifelse(P_094==5,"Transporte informal",Columna),
                Columna=ifelse(P_094==6,"Taxi/Colectivo",Columna),
                Columna=ifelse(P_094==7,"Transporte privado",Columna),
                Columna=ifelse(P_094==8,"Metro/Cable",Columna),
                Columna=ifelse(P_094==9,"Sistema Integrado Transporte",Columna),
                Columna=ifelse(P_094==10,"Caballo",Columna),
                Columna=ifelse(P_094==11,"Lancha",Columna),
                Total=sum(Subtotal),
                Porcentaje=round((Subtotal/Total)*100,2)
                )

# Graficamos:
ggplot(TotalesYSubt,aes(x=Porcentaje,y=reorder(Columna,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(x="Porcentaje",y="Jericó: Medio de transporte al sitio laboral")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.95),
            size=4, vjust=0.5, hjust=-0.4 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)))+
  scale_x_continuous(limits = c(0,75))

# Paso opcional: exportamos data:
write_xlsx(TotalesYSubt, "TotalesYSubt.xlsx")

# eliminamos intermedios
rm(TotalesYSubt)

#### Tema: Movilidad laboral. Cartama ####
# Pregunta data: : P:094

# Creamos totales y subtotales:
TotalesYSubt <- as.data.frame(svytable(~NomMpio+P_094,design=Cartama_Svy)) %>% 
  dplyr::rename(Municipios=NomMpio,Subtotal=Freq) %>% 
  dplyr::filter(P_094!=-98,P_094!=-99,P_094!=-88,P_094!=-77)

TotalesYSubt$Columna <- c("Columna")

TotalesYSubt <- TotalesYSubt %>% 
  dplyr::mutate(Columna=ifelse(P_094==1,"Caminando",Columna),
                Columna=ifelse(P_094==2,"Bicicleta",Columna),
                Columna=ifelse(P_094==3,"Moto",Columna),
                Columna=ifelse(P_094==4,"Bus/Buseta",Columna),
                Columna=ifelse(P_094==5,"Transporte informal",Columna),
                Columna=ifelse(P_094==6,"Taxi/Colectivo",Columna),
                Columna=ifelse(P_094==7,"Transporte privado",Columna),
                Columna=ifelse(P_094==8,"Metro/Cable",Columna),
                Columna=ifelse(P_094==9,"Sistema Integrado Transporte",Columna),
                Columna=ifelse(P_094==10,"Caballo",Columna),
                Columna=ifelse(P_094==11,"Lancha",Columna)
                )

# Hallamos los totales por municipio:
TotalesYSubt_v2 <- TotalesYSubt %>% 
  dplyr::group_by(Municipios) %>% 
  dplyr::summarise(
      Total = sum(Subtotal,na.rm = TRUE))

# Concatenamos:
TotalesYSubt_v3 <- join_all(list(TotalesYSubt_v2,TotalesYSubt), by=c("Municipios"),type = "full")

# Hacemos los cálculos:
TotalesYSubt_v3 <- TotalesYSubt_v3 %>% 
  dplyr::mutate(Porcentaje=round((Subtotal/Total)*100,2)
                )

# hacemos una prueba para validar el caso de Jericó:
Prueba <- TotalesYSubt_v3 %>% 
  dplyr::filter(Municipios=="Jericó")

# Graficamos:
ggplot(Prueba,aes(x=Porcentaje,y=reorder(Columna,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(x="Porcentaje",y="Jericó: Medio de transporte al sitio laboral")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.95),
            size=4, vjust=0.5, hjust=-0.4 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)))+
  scale_x_continuous(limits = c(0,75))

# Paso opcional: exportamos data:
write_xlsx(TotalesYSubt_v3, "TotalesYSubt_v3.xlsx")

# eliminamos intermedios
rm(TotalesYSubt,TotalesYSubt_v2,TotalesYSubt_v3,Prueba)

#### Tema: Movilidad Centro educativo. Jericó ####
# Pregunta data: : P:047

# Creamos totales y subtotales:
TotalesYSubt <- as.data.frame(svytable(~NomMpio+P_047,design=Jerico_Svy)) %>% 
  dplyr::rename(Municipios=NomMpio,Subtotal=Freq) %>% 
  dplyr::filter(P_047!=-99,P_047!=-88,P_047!=-77)

TotalesYSubt$Columna <- c("Columna")

TotalesYSubt <- TotalesYSubt %>% 
  dplyr::mutate(Columna=ifelse(P_047==1,"Caminando",Columna),
                Columna=ifelse(P_047==2,"Bicicleta",Columna),
                Columna=ifelse(P_047==3,"Moto",Columna),
                Columna=ifelse(P_047==4,"Bus/Buseta",Columna),
                Columna=ifelse(P_047==5,"Transporte informal",Columna),
                Columna=ifelse(P_047==6,"Taxi/Colectivo",Columna),
                Columna=ifelse(P_047==7,"Transporte privado",Columna),
                Columna=ifelse(P_047==8,"Metro/Cable",Columna),
                Columna=ifelse(P_047==9,"Sistema Integrado Transporte",Columna),
                Columna=ifelse(P_047==10,"Caballo",Columna),
                Columna=ifelse(P_047==11,"Lancha",Columna),
                Total=sum(Subtotal),
                Porcentaje=round((Subtotal/Total)*100,2)
                )

# Graficamos:
ggplot(TotalesYSubt,aes(x=Porcentaje,y=reorder(Columna,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(x="Porcentaje",y="Jericó: Medio de transporte al centro educativo")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0.5, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)))+
  scale_x_continuous(limits=c(0,100))

# Paso opcional: exportamos data:
write_xlsx(TotalesYSubt, "TotalesYSubt.xlsx")

# eliminamos intermedios
rm(TotalesYSubt)


#### Tema: Tiempo al sitio laboral. Jericó ####
# Pregunta data: : P:095

# Creamos totales y subtotales:
TotalesYSubt <- as.data.frame(svytable(~NomMpio+P_095,design=Jerico_Svy)) %>% 
  dplyr::rename(Municipios=NomMpio,Subtotal=Freq) %>% 
  dplyr::filter(P_095!=-99,P_095!=-88,P_095!=-98)

TotalesYSubt$Columna <- c("Columna")

TotalesYSubt <- TotalesYSubt %>% 
  dplyr::mutate(Columna=ifelse(P_095==1,"Entre 0-20 minutos",Columna),
                Columna=ifelse(P_095==2,"Entre 21-40 minutos",Columna),
                Columna=ifelse(P_095==3,"Entre 41-60 minutos",Columna),
                Columna=ifelse(P_095==4,"Entre 61-80 minutos",Columna),
                Columna=ifelse(P_095==5,"Más de 81 minutos",Columna),
                Total=sum(Subtotal),
                Porcentaje=round((Subtotal/Total)*100,2)
                )
# Paso opcional: poner data en factores para un orden establecido:
TotalesYSubt$Columna <- factor(TotalesYSubt$Columna, levels=c("Entre 0-20 minutos","Entre 21-40 minutos","Entre 41-60 minutos","Entre 61-80 minutos","Más de 81 minutos"))

# Graficamos:
ggplot(TotalesYSubt,aes(x=Porcentaje,y=Columna))+
  geom_col(fill="coral")+
  labs(x="Porcentaje",y="Jericó: Demora al sitio laboral")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0.5, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)))+
  scale_x_continuous(limits=c(0,80))

# Paso opcional: exportamos data:
write_xlsx(TotalesYSubt, "TotalesYSubt.xlsx")

# eliminamos intermedios
rm(TotalesYSubt)

#### Tema: Tiempo al centro educativo. Jericó ####
# Pregunta data: : P_048

# Creamos totales y subtotales:
TotalesYSubt <- as.data.frame(svytable(~NomMpio+P_048,design=Jerico_Svy)) %>% 
  dplyr::rename(Municipios=NomMpio,Subtotal=Freq) %>% 
  dplyr::filter(P_048!=-99,P_048!=-88,P_048!=-98)

TotalesYSubt$Columna <- c("Columna")

TotalesYSubt <- TotalesYSubt %>% 
  dplyr::mutate(Columna=ifelse(P_048==1,"Entre 0-20 minutos",Columna),
                Columna=ifelse(P_048==2,"Entre 21-40 minutos",Columna),
                Columna=ifelse(P_048==3,"Entre 41-60 minutos",Columna),
                Columna=ifelse(P_048==4,"Entre 61-80 minutos",Columna),
                Columna=ifelse(P_048==5,"Más de 81 minutos",Columna),
                Total=sum(Subtotal),
                Porcentaje=round((Subtotal/Total)*100,2)
                )

# Graficamos:
ggplot(TotalesYSubt,aes(x=Porcentaje,y=reorder(Columna,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(x="Porcentaje",y="Jericó: Demora al centro educativo")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0.5, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)))+
  scale_x_continuous(limits=c(0,100))

# Paso opcional: exportamos data:
write_xlsx(TotalesYSubt, "TotalesYSubt.xlsx")

# eliminamos intermedios
rm(TotalesYSubt)
#### Tema: Valoración transporte (Hogares). Jericó ####
# Pregunta data: : P_345

# Creamos totales y subtotales:
TotalesYSubt <- as.data.frame(svytable(~NomMpio+P_345,design=JericoHogar_Svy)) %>% 
  dplyr::rename(Municipios=NomMpio,Subtotal=Freq) %>% 
  dplyr::filter(P_345!=-99,P_345!=-88,P_345!=-98)

TotalesYSubt$Columna <- c("Columna")

TotalesYSubt <- TotalesYSubt %>% 
  dplyr::mutate(Columna=ifelse(P_345==0,"No hay transporte público",Columna),
                Columna=ifelse(P_345==1,"Muy mala",Columna),
                Columna=ifelse(P_345==2,"Mala",Columna),
                Columna=ifelse(P_345==3,"Aceptable",Columna),
                Columna=ifelse(P_345==4,"Buena",Columna),
                Columna=ifelse(P_345==5,"Muy buena",Columna),
                Total=sum(Subtotal),
                Porcentaje=round((Subtotal/Total)*100,2)
                )

# Paso opcional: poner data en factores para un orden establecido:
TotalesYSubt$Columna <- factor(TotalesYSubt$Columna, levels=c("No hay transporte público","Muy mala","Mala","Aceptable","Buena","Muy buena"))

# Graficamos:
ggplot(TotalesYSubt,aes(x=Porcentaje,y=Columna))+
  geom_col(fill="aquamarine3")+
  labs(x="Porcentaje",y="Jericó: Calificación transporte público")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0.5, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)))+
  scale_x_continuous(limits=c(0,100))

# Paso opcional: exportamos data:
write_xlsx(TotalesYSubt, "TotalesYSubt.xlsx")

# eliminamos intermedios
rm(TotalesYSubt)

```

```{r Mercado laboral}
#### Tema: Actividad última semana. Jericó ####
# Pregunta data: : P_077

# Creamos totales y subtotales:
TotalesYSubt <- as.data.frame(svytable(~NomMpio+P_077,design=Jerico_Svy)) %>% 
  dplyr::rename(Municipios=NomMpio,Subtotal=Freq) %>% 
  dplyr::filter(P_077!=-99,P_077!=-88,P_077!=-98)

TotalesYSubt$Columna <- c("Columna")

TotalesYSubt <- TotalesYSubt %>% 
  dplyr::mutate(Columna=ifelse(P_077==1,"Trabajando",Columna),
                Columna=ifelse(P_077==2,"Buscando trabajo",Columna),
                Columna=ifelse(P_077==3,"Estudiando",Columna),
                Columna=ifelse(P_077==4,"Oficios del hogar",Columna),
                Columna=ifelse(P_077==5,"Rentista",Columna),
                Columna=ifelse(P_077==6,"Jubilado",Columna),
                Columna=ifelse(P_077==7,"Otra actividad",Columna),
                Columna=ifelse(P_077==8,"Incapacitado",Columna),
                Total=sum(Subtotal),
                Porcentaje=round((Subtotal/Total)*100,2)
                )

# Graficamos:
ggplot(TotalesYSubt,aes(x=Porcentaje,y=reorder(Columna,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(x="Porcentaje",y="Jericó: Actividad última semana")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0.5, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)))+
  scale_x_continuous(limits=c(0,45))

# Paso opcional: exportamos data:
write_xlsx(TotalesYSubt, "TotalesYSubt.xlsx")

# eliminamos intermedios
rm(TotalesYSubt)

#### Tema: Actividad última semana. Cartama ####
# Pregunta data: : P_077

# Creamos totales y subtotales:
TotalesYSubt <- as.data.frame(svytable(~NomMpio+P_077,design=Cartama_Svy)) %>% 
  dplyr::rename(Municipios=NomMpio,Subtotal=Freq) %>% 
  dplyr::filter(P_077!=-99,P_077!=-88,P_077!=-98)

TotalesYSubt$Columna <- c("Columna")

TotalesYSubt <- TotalesYSubt %>% 
  dplyr::mutate(Columna=ifelse(P_077==1,"Trabajando",Columna),
                Columna=ifelse(P_077==2,"Buscando trabajo",Columna),
                Columna=ifelse(P_077==3,"Estudiando",Columna),
                Columna=ifelse(P_077==4,"Oficios del hogar",Columna),
                Columna=ifelse(P_077==5,"Rentista",Columna),
                Columna=ifelse(P_077==6,"Jubilado",Columna),
                Columna=ifelse(P_077==7,"Otra actividad",Columna),
                Columna=ifelse(P_077==8,"Incapacitado",Columna)
                )

# Hallamos los totales por municipio:
TotalesYSubt_v2 <- TotalesYSubt %>% 
  dplyr::group_by(Municipios) %>% 
  dplyr::summarise(
      Total = sum(Subtotal,na.rm = TRUE))

# Concatenamos:
TotalesYSubt_v3 <- join_all(list(TotalesYSubt_v2,TotalesYSubt), by=c("Municipios"),type = "full")

# Hacemos los cálculos:
TotalesYSubt_v3 <- TotalesYSubt_v3 %>% 
  dplyr::mutate(Porcentaje=round((Subtotal/Total)*100,2)
                )

# hacemos una prueba para validar el caso de Jericó:
Prueba <- TotalesYSubt_v3 %>% 
  dplyr::filter(Municipios=="Jericó")

# Graficamos:
ggplot(Prueba,aes(x=Porcentaje,y=reorder(Columna,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(x="Porcentaje",y="Jericó: Actividad última semana")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0.5, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)))+
  scale_x_continuous(limits=c(0,45))

# Paso opcional: exportamos data:
write_xlsx(TotalesYSubt_v3, "TotalesYSubt_v3.xlsx")

# eliminamos intermedios
rm(TotalesYSubt,TotalesYSubt_v2,TotalesYSubt_v3,Prueba)

#### Tema: Posición ocupacional. Jericó ####
# Pregunta data: : P_099

# Creamos totales y subtotales:
TotalesYSubt <- as.data.frame(svytable(~NomMpio+P_099,design=Jerico_Svy)) %>% 
  dplyr::rename(Municipios=NomMpio,Subtotal=Freq) %>% 
  dplyr::filter(P_099!=-99,P_099!=-88,P_099!=-98)

TotalesYSubt$Columna <- c("Columna")

TotalesYSubt <- TotalesYSubt %>% 
  dplyr::mutate(Columna=ifelse(P_099==-77,"Otro",Columna),
                Columna=ifelse(P_099==1,"Empleado de empresa particular",Columna),
                Columna=ifelse(P_099==2,"Empleado del gobierno",Columna),
                Columna=ifelse(P_099==3,"Empleado doméstico",Columna),
                Columna=ifelse(P_099==4,"Cuenta propia",Columna),
                Columna=ifelse(P_099==5,"Empleador",Columna),
                Columna=ifelse(P_099==6,"Trabajador fliar sin remuneración",Columna),
                Columna=ifelse(P_099==7,"Trabajador sin remuneración",Columna),
                Columna=ifelse(P_099==8,"Jornalero",Columna),
                Total=sum(Subtotal),
                Porcentaje=round((Subtotal/Total)*100,2)
                )

# Graficamos:
ggplot(TotalesYSubt,aes(x=Porcentaje,y=reorder(Columna,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(x="Porcentaje",y="Jericó: Posición ocupacional")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0.5, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)))+
  scale_x_continuous(limits=c(0,50))

# Paso opcional: exportamos data:
write_xlsx(TotalesYSubt, "TotalesYSubt.xlsx")

# eliminamos intermedios
rm(TotalesYSubt)


#### Tema: Posición ocupacional. Cartama ####
# Pregunta data: : P_099

# Creamos totales y subtotales:
TotalesYSubt <- as.data.frame(svytable(~NomMpio+P_099,design=Cartama_Svy)) %>% 
  dplyr::rename(Municipios=NomMpio,Subtotal=Freq) %>% 
  dplyr::filter(P_099!=-99,P_099!=-88,P_099!=-98)

TotalesYSubt$Columna <- c("Columna")

TotalesYSubt <- TotalesYSubt %>% 
  dplyr::mutate(Columna=ifelse(P_099==-77,"Otro",Columna),
                Columna=ifelse(P_099==1,"Empleado de empresa particular",Columna),
                Columna=ifelse(P_099==2,"Empleado del gobierno",Columna),
                Columna=ifelse(P_099==3,"Empleado doméstico",Columna),
                Columna=ifelse(P_099==4,"Cuenta propia",Columna),
                Columna=ifelse(P_099==5,"Empleador",Columna),
                Columna=ifelse(P_099==6,"Trabajador fliar sin remuneración",Columna),
                Columna=ifelse(P_099==7,"Trabajador sin remuneración",Columna),
                Columna=ifelse(P_099==8,"Jornalero",Columna)
                )

# Hallamos los totales por municipio:
TotalesYSubt_v2 <- TotalesYSubt %>% 
  dplyr::group_by(Municipios) %>% 
  dplyr::summarise(
      Total = sum(Subtotal,na.rm = TRUE))

# Concatenamos:
TotalesYSubt_v3 <- join_all(list(TotalesYSubt_v2,TotalesYSubt), by=c("Municipios"),type = "full")

# Hacemos los cálculos:
TotalesYSubt_v3 <- TotalesYSubt_v3 %>% 
  dplyr::mutate(Porcentaje=round((Subtotal/Total)*100,2)
                )

# hacemos una prueba para validar el caso de Jericó:
Prueba <- TotalesYSubt_v3 %>% 
  dplyr::filter(Municipios=="Jericó")

# Graficamos:
ggplot(Prueba,aes(x=Porcentaje,y=reorder(Columna,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(x="Porcentaje",y="Jericó: Posición ocupacional")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0.5, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)))+
  scale_x_continuous(limits=c(0,50))

# Paso opcional: exportamos data:
write_xlsx(TotalesYSubt_v3, "TotalesYSubt_v3.xlsx")

# eliminamos intermedios
rm(TotalesYSubt,TotalesYSubt_v2,TotalesYSubt_v3,Prueba)

#### Tema: Sector económico empresa. Jericó ####
# Pregunta data: : P_096

# Creamos totales y subtotales:
TotalesYSubt <- as.data.frame(svytable(~NomMpio+P_096,design=Jerico_Svy))%>% 
  dplyr::rename(Municipios=NomMpio,Subtotal=Freq) %>% 
  dplyr::filter(P_096!=-99,P_096!=-88,P_096!=-98)

TotalesYSubt$Columna <- c("Columna")

TotalesYSubt <- TotalesYSubt %>% 
  dplyr::mutate(Columna=ifelse(P_096==1,"Agropecuaria, silvicultura y pesca",Columna),
                Columna=ifelse(P_096==2,"Minería",Columna),
                Columna=ifelse(P_096==3,"Electricidad, gas, agua",Columna),
                Columna=ifelse(P_096==4,"Industria",Columna),
                Columna=ifelse(P_096==5,"Construcción",Columna),
                Columna=ifelse(P_096==6,"Comercio, hotel, restaurantes",Columna),
                Columna=ifelse(P_096==7,"Transporte, almacenamiento y comunicaciones",Columna),
                Columna=ifelse(P_096==8,"Estab. Financieros, inmuebles y otros",Columna),
                Columna=ifelse(P_096==9,"Servicios sociales, comunales y personales",Columna),
                Total=sum(Subtotal),
                Porcentaje=round((Subtotal/Total)*100,2)
                )

# Graficamos:
ggplot(TotalesYSubt,aes(x=Porcentaje,y=reorder(Columna,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(x="Porcentaje",y="Jericó: Sector económico laboral")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0.5, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)))+
  scale_x_continuous(limits=c(0,60))

# Paso opcional: exportamos data:
write_xlsx(TotalesYSubt, "TotalesYSubt.xlsx")

# eliminamos intermedios
rm(TotalesYSubt)
#### Tema: Otros ingresos. Jericó ####
# Procedimiento: Se encontrará el valor promedio por cada tipo de ingreso.
# Se concatenará y luego graficará todo junto.

# Ingresos por arriendo:
Arriendo <- JericoPersonas %>% 
  dplyr::filter(.,P_125>0)

Arriendo_Svy <- svydesign(ids=~0,weights=~FexpPer_EQ,
                                  data=Arriendo)

Arriendo_v2 <- as.data.frame(svymean(~P_125, Arriendo_Svy)) %>% 
  dplyr::select(.,c("mean")) %>% 
  dplyr::rename(Ingresos=mean)

Arriendo_v2$TipoIngresos <- c("Arriendos (mes)")

# Ingresos por Pensiones.
Pensiones <- JericoPersonas %>% 
  dplyr::filter(.,P_126>0)

Pensiones_Svy <- svydesign(ids=~0,weights=~FexpPer_EQ,
                                  data=Pensiones)

Pensiones_v2 <- as.data.frame(svymean(~P_126, Pensiones_Svy))%>% 
  dplyr::select(.,c("mean")) %>% 
  dplyr::rename(Ingresos=mean)

Pensiones_v2$TipoIngresos <- c("Pensiones (mes)")

# Ingresos por Giros Exterior
GirosExt <- JericoPersonas %>% 
  dplyr::filter(.,P_128>0)

GirosExt_Svy <- svydesign(ids=~0,weights=~FexpPer_EQ,
                                  data=GirosExt)

GirosExt_v2 <- as.data.frame(svymean(~P_128, GirosExt_Svy))%>% 
  dplyr::select(.,c("mean")) %>% 
  dplyr::rename(Ingresos=mean)

GirosExt_v2$TipoIngresos <- c("Giros Exterior (anual)")

# Ingresos por Subsidios
Subsidios <- JericoPersonas %>% 
  dplyr::filter(.,P_127>0)

Subsidios_Svy <- svydesign(ids=~0,weights=~FexpPer_EQ,
                                  data=Subsidios)

Subsidios_v2 <- as.data.frame(svymean(~P_127, Subsidios_Svy))%>% 
  dplyr::select(.,c("mean")) %>% 
  dplyr::rename(Ingresos=mean)

Subsidios_v2$TipoIngresos <- c("Subsidios (anual)")

# Concatenamos
Ingresos <- join_all(list(Arriendo_v2,Pensiones_v2,GirosExt_v2,Subsidios_v2), by=c("TipoIngresos"),type = "full")

# Corregimos decimales
Ingresos$Ingresos <- round(Ingresos$Ingresos,0)

# Graficamos:
ggplot(Ingresos, aes(x=Ingresos,y=reorder(TipoIngresos,-Ingresos)))+
  geom_col(position="dodge",fill="coral")+
  labs(x="Valor promedio",y="Jericó: Tipo de ingresos")+
  geom_text(aes(label=Ingresos),position = position_dodge(1),
            size=4, vjust=0.5, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.3)),
        legend.text=element_text(size=rel(1.3)))+
  scale_x_continuous(limits=c(0,1500000))

# Paso opcional: exportamos data:
write_xlsx(Ingresos, "Ingresos.xlsx")

# eliminamos intermedios:
rm(Arriendo,Arriendo_Svy,Arriendo_v2,Pensiones,Pensiones_Svy,Pensiones_v2,GirosExt,GirosExt_Svy,GirosExt_v2,Subsidios,Subsidios_Svy,Subsidios_v2,Ingresos)

```

```{r Proyectos productivos}
#### Tema: Tenencia negocio. Cartama ####
# Pregunta data: P_290

# Creamos totales y subtotales:
TotalesYSubt <- as.data.frame(svytable(~NomMpio+P_290, design = CartamaHogar_Svy)) %>% 
  dplyr::rename(Municipios=NomMpio,Subtotal=Freq)

# Conacatenamos
Proporciones <- join_all(list(TotalMcipioHog_v2,TotalesYSubt), by=c("Municipios"),type = "full")

Proporciones$Columna <- c("Columna")

Proporciones <- Proporciones %>% 
  dplyr::mutate(Porcentaje=round((Subtotal/PoblacionTotal)*100,2),
                Columna=ifelse(P_290==1,"Si",Columna),
                Columna=ifelse(P_290==2,"No",Columna),
                )

# Graficamos:
ggplot(Proporciones, aes(x = Porcentaje, y = Municipios, fill=Columna))+
  geom_col()+
  labs(x="Porcentaje",y="Municipios",fill="Tiene negocio:")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.8),
            size=4, vjust=0.5, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.3)),
        legend.text=element_text(size=rel(1.3)),
        legend.position="top")+
  scale_x_continuous(limits=c(0,100))

# Paso opcional: exportamos data:
write_xlsx(Proporciones, "Proporciones.xlsx")

# Eliminamos intermedios:
rm(TotalesYSubt,Proporciones)
#### Tema: Sector económico Negocio. Jericó ####
# Pregunta data: : P_291

# Creamos totales y subtotales:
TotalesYSubt <- as.data.frame(svytable(~NomMpio+P_291,design=JericoHogar_Svy))%>% 
  dplyr::rename(Municipios=NomMpio,Subtotal=Freq) %>% 
  dplyr::filter(P_291!=-99,P_291!=-88,P_291!=-98)

TotalesYSubt$Columna <- c("Columna")

TotalesYSubt <- TotalesYSubt %>% 
  dplyr::mutate(Columna=ifelse(P_291==1,"Agropecuaria, silvicultura y pesca",Columna),
                Columna=ifelse(P_291==2,"Minería",Columna),
                Columna=ifelse(P_291==3,"Electricidad, gas, agua",Columna),
                Columna=ifelse(P_291==4,"Industria",Columna),
                Columna=ifelse(P_291==5,"Construcción",Columna),
                Columna=ifelse(P_291==6,"Comercio, hotel, restaurantes",Columna),
                Columna=ifelse(P_291==7,"Transporte, almacenamiento y comunicaciones",Columna),
                Columna=ifelse(P_291==8,"Estab. Financieros, inmuebles y otros",Columna),
                Columna=ifelse(P_291==9,"Servicios sociales, comunales y personales",Columna),
                Total=sum(Subtotal),
                Porcentaje=round((Subtotal/Total)*100,2)
                )

# Graficamos:
ggplot(TotalesYSubt,aes(x=Porcentaje,y=reorder(Columna,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(x="Porcentaje",y="Jericó: Sector económico Negocio")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0.5, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)))+
  scale_x_continuous(limits=c(0,85))

# Paso opcional: exportamos data:
write_xlsx(TotalesYSubt, "TotalesYSubt.xlsx")

# eliminamos intermedios
rm(TotalesYSubt)

#### Tema: Sector económico Negocio. Cartama ####
# Pregunta data: : P_291

# Creamos totales y subtotales:
TotalesYSubt <- as.data.frame(svytable(~NomMpio+P_291,design=CartamaHogar_Svy))%>% 
  dplyr::rename(Municipios=NomMpio,Subtotal=Freq) %>% 
  dplyr::filter(P_291!=-99,P_291!=-88,P_291!=-98)

TotalesYSubt$Columna <- c("Columna")

TotalesYSubt <- TotalesYSubt %>% 
  dplyr::mutate(Columna=ifelse(P_291==1,"Agropecuaria, silvicultura y pesca",Columna),
                Columna=ifelse(P_291==2,"Minería",Columna),
                Columna=ifelse(P_291==3,"Electricidad, gas, agua",Columna),
                Columna=ifelse(P_291==4,"Industria",Columna),
                Columna=ifelse(P_291==5,"Construcción",Columna),
                Columna=ifelse(P_291==6,"Comercio, hotel, restaurantes",Columna),
                Columna=ifelse(P_291==7,"Transporte, almacenamiento y comunicaciones",Columna),
                Columna=ifelse(P_291==8,"Estab. Financieros, inmuebles y otros",Columna),
                Columna=ifelse(P_291==9,"Servicios sociales, comunales y personales",Columna)
                )

# Hallamos los totales por municipio:
TotalesYSubt_v2 <- TotalesYSubt %>% 
  dplyr::group_by(Municipios) %>% 
  dplyr::summarise(
      Total = sum(Subtotal,na.rm = TRUE))

# Concatenamos:
TotalesYSubt_v3 <- join_all(list(TotalesYSubt_v2,TotalesYSubt), by=c("Municipios"),type = "full")

# Hacemos los cálculos:
TotalesYSubt_v3 <- TotalesYSubt_v3 %>% 
  dplyr::mutate(Porcentaje=round((Subtotal/Total)*100,2)
                )

# hacemos una prueba para validar el caso de Jericó:
Prueba <- TotalesYSubt_v3 %>% 
  dplyr::filter(Municipios=="Jericó")

# Graficamos:
ggplot(Prueba,aes(x=Porcentaje,y=reorder(Columna,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(x="Porcentaje",y="Jericó: Sector económico Negocio")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0.5, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)))+
  scale_x_continuous(limits=c(0,85))

# Paso opcional: exportamos data:
write_xlsx(TotalesYSubt_v3, "TotalesYSubt_v3.xlsx")

# eliminamos intermedios
rm(TotalesYSubt,TotalesYSubt_v2,TotalesYSubt_v3,Prueba)

```

## Caracterización Piloto: sin FExp
```{r Data Piloto}
# Datas piloto:
PilotoIndividuos <- read_excel("/Volumes/Respaldo/Google Drive-Actualizado/Ecsim/2021_CaracterizaciónJericó/1_EntregablesLehyton/3_Piloto/3_DataPiloto_v1.xlsx",sheet="p_039")

PilotoHogares <- read_excel("/Volumes/Respaldo/Google Drive-Actualizado/Ecsim/2021_CaracterizaciónJericó/1_EntregablesLehyton/3_Piloto/3_DataPiloto_v1.xlsx",sheet="Encuesta sociodemográfica Je...")

PilotoProyectos <- read_excel("/Volumes/Respaldo/Google Drive-Actualizado/Ecsim/2021_CaracterizaciónJericó/1_EntregablesLehyton/3_Piloto/3_DataPiloto_v1.xlsx",sheet="p_103_2")

#### Funciones ####
# Función agrupa: toma una data, la agrupa según la columna y calcula los %
Agrupa <- function(Data,Columna){
  Data_v2 <- Data %>%
  dplyr::group_by({{Columna}}) %>%
  dplyr::summarise(
    Subtotal = n())
  
Data_v2$Total <- colSums(Data_v2[,2])

Data_v2 <- Data_v2 %>% 
  dplyr::mutate(Porcentaje=round((Subtotal/Total)*100,2))

return(Data_v2)
}

```

```{r Modulo Características del hogar}
#### Tema: Sexo ####
# Pregunta data: "Sexo de ${p_040}:"
Sexo <- PilotoIndividuos %>%
  dplyr::select(.,"Sexo de ${p_040}:") %>%
  dplyr::rename(SexoCol="Sexo de ${p_040}:")

Sexo_v2 <- Sexo %>%
  dplyr::group_by(SexoCol) %>%
  dplyr::summarise(
    Sexo = n())

Sexo_v2$Total <- colSums(Sexo_v2[,2])

Sexo_v2 <- Sexo_v2 %>% 
  dplyr::mutate(Porcentaje=round((Sexo/Total)*100,2))

# Graficamos:
ggplot(Sexo_v2, aes(x=Porcentaje,y=SexoCol, fill=SexoCol))+
  geom_col()+
  labs(x="Porcentaje",y="Vereda La Estrella",fill="Sexo")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.2),
            size=4, vjust=0.5, hjust=-2.5 ,col="black")
#### Tema: Identidad sexual ####
Identidad <- PilotoIndividuos %>%
  dplyr::select(.,"${p_040} se identifica como:") %>%
  dplyr::rename(IdentidadCol="${p_040} se identifica como:")

Identidad_v2 <- Identidad %>%
  dplyr::group_by(IdentidadCol) %>%
  dplyr::summarise(
    Identidad = n()) %>% 
  drop_na()

Identidad_v2$Total <- colSums(Identidad_v2[,2])

Identidad_v2 <- Identidad_v2 %>% 
  dplyr::mutate(Porcentaje=round((Identidad/Total)*100,2))

# Graficamos:
ggplot(Identidad_v2, aes(x=Porcentaje,y=IdentidadCol, fill=IdentidadCol))+
  geom_col()+
  labs(x="Porcentaje",y="Vereda La Estrella",fill="Identidad sexual")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.2),
            size=4, vjust=1, hjust=-0.5 ,col="black")
#### Tema: Medios de información ####
# Preguntas data: 
#"${p_040}. ¿Qué medios usa principalmente para estar informado?/Computador de escritorio"
# "${p_040}. ¿Qué medios usa principalmente para estar informado?/Computador portátil"
# "${p_040}. ¿Qué medios usa principalmente para estar informado?/Tableta"
# "${p_040}. ¿Qué medios usa principalmente para estar informado?/Telefono celular"
# "${p_040}. ¿Qué medios usa principalmente para estar informado?/Televisor"
# "${p_040}. ¿Qué medios usa principalmente para estar informado?/Periódico"
# "${p_040}. ¿Qué medios usa principalmente para estar informado?/Revistas"
# "${p_040}. ¿Qué medios usa principalmente para estar informado?/Ninguno"

Informacion <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. ¿Qué medios usa principalmente para estar informado?/Computador de escritorio","${p_040}. ¿Qué medios usa principalmente para estar informado?/Computador portátil", "${p_040}. ¿Qué medios usa principalmente para estar informado?/Tableta","${p_040}. ¿Qué medios usa principalmente para estar informado?/Telefono celular","${p_040}. ¿Qué medios usa principalmente para estar informado?/Televisor","${p_040}. ¿Qué medios usa principalmente para estar informado?/Periódico","${p_040}. ¿Qué medios usa principalmente para estar informado?/Revistas","${p_040}. ¿Qué medios usa principalmente para estar informado?/Ninguno")) %>%
  dplyr::rename(Computador="${p_040}. ¿Qué medios usa principalmente para estar informado?/Computador de escritorio",Portatil="${p_040}. ¿Qué medios usa principalmente para estar informado?/Computador portátil",Tablet="${p_040}. ¿Qué medios usa principalmente para estar informado?/Tableta",Celular="${p_040}. ¿Qué medios usa principalmente para estar informado?/Telefono celular",Televisor="${p_040}. ¿Qué medios usa principalmente para estar informado?/Televisor",Periodico="${p_040}. ¿Qué medios usa principalmente para estar informado?/Periódico",Revistas="${p_040}. ¿Qué medios usa principalmente para estar informado?/Revistas",Ninguno="${p_040}. ¿Qué medios usa principalmente para estar informado?/Ninguno")

# Volvemos todas las columnaas en tipo numéricas:
Informacion$Computador <- as.numeric(Informacion$Computador)
Informacion$Portatil <- as.numeric(Informacion$Portatil)
Informacion$Tablet <- as.numeric(Informacion$Tablet)
Informacion$Celular <- as.numeric(Informacion$Celular)
Informacion$Televisor <- as.numeric(Informacion$Televisor)
Informacion$Periodico <- as.numeric(Informacion$Periodico)
Informacion$Revistas <- as.numeric(Informacion$Revistas)
Informacion$Ninguno <- as.numeric(Informacion$Ninguno)

# Creamos el DF acorde:
Informacion_v2 <- data.frame("Medio"=c("Computador","Portatil","Tablet","Celular","Televisor","Periodico","Revistas","Ninguno"),
                        "Subtotal"=colSums(Informacion[,1:8], na.rm=T)
                        )

Informacion_v2$Total <- sum(Informacion_v2$Subtotal)

Informacion_v2 <- Informacion_v2 %>% 
  dplyr::mutate(Porcentaje=round((Subtotal/Total)*100,2)) %>%
  dplyr::filter(Porcentaje!=0)


# Graficamos: 
ggplot(Informacion_v2, aes(y=Porcentaje,x=reorder(Medio,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(y="Porcentaje",x="Medios de información")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.05),
            size=4, vjust=0.5, hjust=0.5 ,col="black")

#### Tema: Frecuencia de Medios de información ####
# Pregunta data: "${p_040}. ¿Con qué frecuencia usa este medio?"

Frecuencia <- PilotoIndividuos %>%
  dplyr::select(.,"${p_040}. ¿Con qué frecuencia usa este medio?") %>%
  dplyr::rename(FrecuenciaCol="${p_040}. ¿Con qué frecuencia usa este medio?") %>%
  drop_na() 

Frecuencia_v2 <- Agrupa(Data=Frecuencia,
                 Columna=FrecuenciaCol)

# Graficamos:
ggplot(Frecuencia_v2, aes(x=Porcentaje,y=reorder(FrecuenciaCol,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(x="Porcentaje",y="Frecuencia en uso de medios de información")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.8),
            size=4, vjust=0, hjust=0 ,col="black")

#### Tema: Productos financieros  ####
# Preguntas data: 
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Cuenta corriente"
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Cuenta de ahorros"
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/CDT"
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Préstamo para compra de vivienda"
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Préstamo para compra de vehículo"
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Préstamo para libre inversión"
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Tarjeta de crédito"
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Ninguno"
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Otro"
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/No sabe"
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/No responde"

Informacion <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Cuenta corriente","${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Cuenta de ahorros","${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/CDT","${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Préstamo para compra de vivienda","${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Préstamo para compra de vehículo","${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Préstamo para libre inversión","${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Tarjeta de crédito","${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Ninguno","${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Otro","${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/No sabe","${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/No responde")) %>%
  dplyr::rename(CtaCorriente="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Cuenta corriente",CtaAhorros="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Cuenta de ahorros",CDT="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/CDT",PrestamoVivienda="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Préstamo para compra de vivienda",PrestamoCarro="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Préstamo para compra de vehículo",PrestamoLibre="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Préstamo para libre inversión",TarjetaCredito="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Tarjeta de crédito",Ninguno="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Ninguno",Otro="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Otro",NoSabe="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/No sabe",NoResponde="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/No responde")

# Volvemos todas las columnaas en tipo numéricas:
Informacion$CtaCorriente <- as.numeric(Informacion$CtaCorriente)
Informacion$CtaAhorros <- as.numeric(Informacion$CtaAhorros)
Informacion$CDT <- as.numeric(Informacion$CDT)
Informacion$PrestamoVivienda <- as.numeric(Informacion$PrestamoVivienda)
Informacion$PrestamoCarro <- as.numeric(Informacion$PrestamoCarro)
Informacion$PrestamoLibre <- as.numeric(Informacion$PrestamoLibre)
Informacion$TarjetaCredito <- as.numeric(Informacion$TarjetaCredito)
Informacion$Ninguno <- as.numeric(Informacion$Ninguno)
Informacion$Otro <- as.numeric(Informacion$Otro)
Informacion$NoSabe <- as.numeric(Informacion$NoSabe)
Informacion$NoResponde <- as.numeric(Informacion$NoResponde)

# Creamos el DF acorde:
Informacion_v2 <- data.frame("Medio"=c("CtaCorriente","CtaAhorros","CDT","PrestamoVivienda","PrestamoCarro","PrestamoLibre","TarjetaCredito","Ninguno","Otro","NoSabe",
                                       "NoResponde"),
                        "Subtotal"=colSums(Informacion[,1:11], na.rm=T)
                        )

Informacion_v2$Total <- sum(Informacion_v2$Subtotal)

Informacion_v2 <- Informacion_v2 %>% 
  dplyr::mutate(Porcentaje=round((Subtotal/Total)*100,2)) %>%
  dplyr::filter(Porcentaje!=0)


# Graficamos: 
ggplot(Informacion_v2, aes(y=Porcentaje,x=reorder(Medio,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(y="Porcentaje",x="Producto financiero")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.05),
            size=4, vjust=0.5, hjust=0.5 ,col="black")


```

```{r Modulo Seguridad Social}
#### Tema: Afiliación al SSS ####

#"${p_040}. Afiliación al Sistema de Seguridad Social en Salud."
AfiliacionSSS <- PilotoIndividuos %>%
  dplyr::select(.,"${p_040}. Afiliación al Sistema de Seguridad Social en Salud.") %>%
  dplyr::rename(AfiliacionCol="${p_040}. Afiliación al Sistema de Seguridad Social en Salud.") %>% 
  drop_na() %>% 
  dplyr::filter(.,AfiliacionCol!="No responde")

AfiliacionSSS_v2 <- AfiliacionSSS %>%
  dplyr::group_by(AfiliacionCol) %>%
  dplyr::summarise(
    Afiliacion = n())
  
AfiliacionSSS_v2$Total <- colSums(AfiliacionSSS_v2[,2])

AfiliacionSSS_v2 <- AfiliacionSSS_v2 %>% 
  dplyr::mutate(Porcentaje=round((Afiliacion/Total)*100,2))

# Graficamos:
ggplot(AfiliacionSSS_v2, aes(x=Porcentaje,y=reorder(AfiliacionCol,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(x="Porcentaje",y="Afiliación a Seguridad Social en Salud")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.2),
            size=4, vjust=1, hjust=-0.8 ,col="black")
#### Tema: Calificación: Servicios Salud  ####
# Pregunta data: "${p_040}. Según su opinión, ¿cómo califica la calidad de los servicios de salud?"

Salud <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. Según su opinión, ¿cómo califica la calidad de los servicios de salud?")) %>%
  dplyr::rename(Calificacion="${p_040}. Según su opinión, ¿cómo califica la calidad de los servicios de salud?") %>% 
  drop_na() %>% 
  dplyr::filter(Calificacion!="No se encuentra en casa")

Salud_v2 <- Agrupa(Data=Salud,
                 Columna=Calificacion)

# Graficamos:
ggplot(Salud_v2, aes(y=Porcentaje,x=reorder(Calificacion,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(y="Porcentaje",x="Calificación servicios de salud")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.05),
            size=4, vjust=1, hjust=0.5 ,col="black")
#### Tema: Cotiza para pensión  ####
# Pregunta data: "${p_040}. ¿Cotiza para pensión?"

Salud <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. ¿Cotiza para pensión?")) %>%
  dplyr::rename(Cotiza="${p_040}. ¿Cotiza para pensión?") %>% 
  drop_na()

Salud_v2 <- Agrupa(Data=Salud,
                 Columna=Cotiza)

# Graficamos:
ggplot(Salud_v2, aes(y=Porcentaje,x=reorder(Cotiza,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(y="Porcentaje",x="Cotización al sistema de pensiones")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.05),
            size=4, vjust=1, hjust=0.5 ,col="black")

#### Tema: Fondo de pensión que cotiza  ####
# Pregunta data: "${p_040}. ¿A cuál de los siguientes fondos de pensiones cotiza?"

Salud <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. ¿A cuál de los siguientes fondos de pensiones cotiza?")) %>%
  dplyr::rename(Cotiza="${p_040}. ¿A cuál de los siguientes fondos de pensiones cotiza?") %>% 
  drop_na() %>% 
  dplyr::filter(Cotiza!="No sabe")

Salud_v2 <- Agrupa(Data=Salud,
                 Columna=Cotiza)

# Graficamos:
ggplot(Salud_v2, aes(y=Porcentaje,x=reorder(Cotiza,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(y="Porcentaje",x="Fondo de pensiones")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.05),
            size=4, vjust=1, hjust=0.5 ,col="black")


#### Tema: Está afiliado a ARL  ####
# Pregunta data: "${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]"
# Pregunta data: "${p_040}. ¿Tiene Afiliación a una Administradora de Riesgos Laborales (ARL)?"

Salud <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]","${p_040}. ¿Tiene Afiliación a una Administradora de Riesgos Laborales (ARL)?")) %>%
  dplyr::rename(Ocupacion="${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]",Cotiza="${p_040}. ¿Tiene Afiliación a una Administradora de Riesgos Laborales (ARL)?") %>% 
  dplyr::filter(Ocupacion=="Trabajando")

Salud_v2 <- Agrupa(Data=Salud,
                 Columna=Cotiza)

# Graficamos:
ggplot(Salud_v2, aes(y=Porcentaje,x=reorder(Cotiza,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(y="Porcentaje",x="Afiliación a ARL")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=1, hjust=0.5 ,col="black")
#### Tema: Está afiliado a Caja compensación  ####
# Pregunta data: "${p_040}. ¿Está afiliado a una caja de compensación?"

Salud <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. ¿Está afiliado a una caja de compensación?")) %>%
  dplyr::rename(Cotiza="${p_040}. ¿Está afiliado a una caja de compensación?") %>% 
  dplyr::filter(Cotiza!="No sabe") %>% 
  drop_na()

Salud_v2 <- Agrupa(Data=Salud,
                 Columna=Cotiza)

# Graficamos:
ggplot(Salud_v2, aes(y=Porcentaje,x=reorder(Cotiza,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(y="Porcentaje",x="Afiliación a caja de compensación")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=1, hjust=0.5 ,col="black")

#### Tema: Caja de compensación donde está  ####
# Pregunta data: "${p_040}. ¿A cuál caja de compensación está afiliado?"

Salud <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. ¿A cuál caja de compensación está afiliado?")) %>%
  dplyr::rename(Cotiza="${p_040}. ¿A cuál caja de compensación está afiliado?") %>% 
  drop_na()

Salud_v2 <- Agrupa(Data=Salud,
                 Columna=Cotiza)

# Graficamos:
ggplot(Salud_v2, aes(y=Porcentaje,x=reorder(Cotiza,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(y="Porcentaje",x="Caja de compensación")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.05),
            size=4, vjust=1, hjust=0.5 ,col="black")



```

```{r Modulo Educación}
#### Tema: Condición educativa actual ####
# Pregunta de data: "${p_040}. ¿Cuál es su condición educativa actualmente?"
Educacion <- PilotoIndividuos %>%
  dplyr::select(.,"${p_040}. ¿Cuál es su condición educativa actualmente?") %>%
  dplyr::rename(CondicionEduca="${p_040}. ¿Cuál es su condición educativa actualmente?") %>% 
  drop_na() %>% 
  dplyr::filter(.,CondicionEduca!="No sabe")

Educacion_v2 <- Educacion %>%
  dplyr::group_by(CondicionEduca) %>%
  dplyr::summarise(
    Condicion = n())
  
Educacion_v2$Total <- colSums(Educacion_v2[,2])

Educacion_v2 <- Educacion_v2 %>% 
  dplyr::mutate(Porcentaje=round((Condicion/Total)*100,2))

# Graficamos:
ggplot(Educacion_v2, aes(x=Porcentaje,y=reorder(CondicionEduca,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(x="Porcentaje",y="Condición educativa actual")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.2),
            size=4, vjust=1, hjust=-0.45 ,col="black")

#### Tema: Causa para no continuar estudios: ####
# Pregunta de data: "${p_040}. ¿Cuál fue la principal causa por la que no pudo continuar sus estudios?"

Educacion <- PilotoIndividuos %>%
  dplyr::select(.,"${p_040}. ¿Cuál fue la principal causa por la que no pudo continuar sus estudios?") %>%
  dplyr::rename(CausaNoEstudio="${p_040}. ¿Cuál fue la principal causa por la que no pudo continuar sus estudios?") %>% 
  drop_na() 

Educacion$CausaCol <- c("Causa")

Educacion <- Educacion %>% 
  dplyr::mutate(CausaCol=ifelse(CausaNoEstudio=="Porque se casó o formó pareja",
                                "Vida en pareja",CausaCol),
                CausaCol=ifelse(CausaNoEstudio=="No le gusta o no le interesa el estudio, aburrición","No le interesa",CausaCol),
                CausaCol=ifelse(CausaNoEstudio=="Costos educativos elevados o falta de dinero","Razones económicas",CausaCol),
                CausaCol=ifelse(CausaNoEstudio=="Debe encargarse de los oficios del hogar (cuidado de los niños, ancianos, personas con discapacidad, etc)","Oficios del hogar",CausaCol),
                CausaCol=ifelse(CausaNoEstudio=="No existe centro educativo cercano, está muy lejano","Lejanía del centro educativo",CausaCol),
                CausaCol=ifelse(CausaNoEstudio=="Por inseguridad en el establecimiento educativo, en el entorno del establecimiento o en el lugar de residencia","Inseguridad",CausaCol),
                CausaCol=ifelse(CausaNoEstudio=="Necesita trabajar","Necesita trabajar",CausaCol),
                CausaCol=ifelse(CausaNoEstudio=="Razones familiares","Razones familiares",CausaCol)
                )

Educacion_v2 <- Agrupa(Data=Educacion,
                 Columna=CausaCol)

# Graficamos:
ggplot(Educacion_v2, aes(x=Porcentaje,y=reorder(CausaCol,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(x="Porcentaje",y="Causas para no estudiar")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.2),
            size=4, vjust=1, hjust=-0.45 ,col="black")

#### Tema: Nivel de estudios que cursa actual ####
# Pregunta data: ${p_040}. ¿Cuál es el nivel de estudio que está estudiando actualmente?"
Educacion <- PilotoIndividuos %>%
  dplyr::select(.,"${p_040}. ¿Cuál es el nivel de estudio que está estudiando actualmente?") %>%
  dplyr::rename(NivelEstudio="${p_040}. ¿Cuál es el nivel de estudio que está estudiando actualmente?") %>% 
  drop_na() 

Educacion_v2 <- Agrupa(Data=Educacion,
                 Columna=NivelEstudio)

# Graficamos:
ggplot(Educacion_v2, aes(x=Porcentaje,y=reorder(NivelEstudio,-Porcentaje)))+
  geom_col(fill="cyan")+
  labs(x="Porcentaje",y="Nivel de estudio que cursa actualmente")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.2),
            size=4, vjust=1, hjust=-0.45 ,col="black")

#### Tema: Area del conocimiento que cursa actualmente ####
# Pregunta de data: "${p_040}. Área de conocimiento de lo que está estudiando actualmente"
Educacion <- PilotoIndividuos %>%
  dplyr::select(.,"${p_040}. Área de conocimiento de lo que está estudiando actualmente") %>%
  dplyr::rename(AreaEstudio="${p_040}. Área de conocimiento de lo que está estudiando actualmente") %>% 
  drop_na() 

Educacion_v2 <- Agrupa(Data=Educacion,
                 Columna=AreaEstudio)

# Graficamos:
ggplot(Educacion_v2, aes(x=Porcentaje,y=reorder(AreaEstudio,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(x="Porcentaje",y="Area del conocimiento que cursa actualmente")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.2),
            size=4, vjust=1, hjust=-0.45 ,col="black")

#### Tema: Ultimo nivel de estudios ####
# Pregunta data: "${p_040}. Último NIVEL de estudio que estudió."
Educacion <- PilotoIndividuos %>%
  dplyr::select(.,"${p_040}. Último NIVEL de estudio que estudió.") %>%
  dplyr::rename(NivelEstudio="${p_040}. Último NIVEL de estudio que estudió.") %>% 
  drop_na() 

Educacion_v2 <- Agrupa(Data=Educacion,
                 Columna=NivelEstudio)

# Graficamos:
ggplot(Educacion_v2, aes(x=Porcentaje,y=reorder(NivelEstudio,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(x="Porcentaje",y="Último nivel de estudio")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.2),
            size=4, vjust=1, hjust=-0.45 ,col="black")

#### Tema: Ultimo título aprobado ####
# Pregunta data: "${p_040}. Último título de estudio aprobado."

Educacion <- PilotoIndividuos %>%
  dplyr::select(.,"${p_040}. Último título de estudio aprobado.") %>%
  dplyr::rename(Titulo="${p_040}. Último título de estudio aprobado.") %>% 
  drop_na() 

Educacion_v2 <- Agrupa(Data=Educacion,
                 Columna=Titulo)

# Graficamos:
ggplot(Educacion_v2, aes(x=Porcentaje,y=reorder(Titulo,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(x="Porcentaje",y="Último título aprobado")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.2),
            size=4, vjust=1, hjust=-0.45 ,col="black")


#### Tema: Año del último título####
# Pregunta data: "anotitulo"
# Pregunta data: "${p_040}. Último título de estudio aprobado."

Educacion <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. Último título de estudio aprobado.","anotitulo")) %>%
  dplyr::rename(Titulo="${p_040}. Último título de estudio aprobado.") %>% 
  drop_na() 

Educacion_v2 <- Agrupa(Data=Educacion,
                 Columna=anotitulo)

# Graficamos:
ggplot(Educacion_v2, aes(y=Porcentaje,x=reorder(anotitulo,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(y="Porcentaje",x="Año título aprobado")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=5, hjust=0.45 ,col="black")
#### Tema: Puede certificarlo####
# Pregunta data: "${p_040}. ¿Puede certificarlo?"
# Pregunta data: "${p_040}. Último título de estudio aprobado."

Educacion <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. Último título de estudio aprobado.","${p_040}. ¿Puede certificarlo?")) %>%
  dplyr::rename(Titulo="${p_040}. Último título de estudio aprobado.", Certificado="${p_040}. ¿Puede certificarlo?") %>% 
  drop_na() 

Educacion_v2 <- Agrupa(Data=Educacion,
                 Columna=Certificado)

# Graficamos:
ggplot(Educacion_v2, aes(y=Porcentaje,x=reorder(Certificado,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(y="Porcentaje",x="Certificado")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.1),
            size=4, vjust=5, hjust=0.45 ,col="black")

#### Tema: Intereses académicos a futuro ####
# Pregunta data: "${p_040}. ¿Cuáles son sus intereses académicos a futuro? (¿Qué le gustaría aprender?)"

Educacion <- PilotoIndividuos %>%
  dplyr::select(.,"${p_040}. ¿Cuáles son sus intereses académicos a futuro? (¿Qué le gustaría aprender?)") %>%
  dplyr::rename(InteresEstudiar="${p_040}. ¿Cuáles son sus intereses académicos a futuro? (¿Qué le gustaría aprender?)") %>% 
  drop_na() 

Educacion_v2 <- Agrupa(Data=Educacion,
                 Columna=InteresEstudiar)

# Graficamos:
ggplot(Educacion_v2, aes(x=Porcentaje,y=reorder(InteresEstudiar,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(x="Porcentaje",y="Intereses académicos a futuro")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.2),
            size=4, vjust=0, hjust=0 ,col="black")


#### Tema: Necesidades Educativas Especiales ####
# Pregunta data: "${p_040}. ¿Posee Necesidades educativas especiales?"

Educacion <- PilotoIndividuos %>%
  dplyr::select(.,"${p_040}. ¿Posee Necesidades educativas especiales?") %>%
  dplyr::rename(Necesidades="${p_040}. ¿Posee Necesidades educativas especiales?") %>% 
  drop_na() 

Educacion_v2 <- Agrupa(Data=Educacion,
                 Columna=Necesidades)

# Graficamos:
ggplot(Educacion_v2, aes(y=Porcentaje,x=reorder(Necesidades,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(y="Porcentaje",x="Necesidades educativas especiales")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0 ,col="black")

#### Tema: Tipo de Necesidades Educativas ####
# Pregunta data: "${p_040}. Necesidad educativa especial asociada a:"

Educacion <- PilotoIndividuos %>%
  dplyr::select(.,"${p_040}. Necesidad educativa especial asociada a:") %>%
  dplyr::rename(Necesidades="${p_040}. Necesidad educativa especial asociada a:") %>%
  drop_na() 

Educacion_v2 <- Agrupa(Data=Educacion,
                 Columna=Necesidades)

# Graficamos:
ggplot(Educacion_v2, aes(y=Porcentaje,x=reorder(Necesidades,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(y="Porcentaje",x="Clasificación de necesidad educativa")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0 ,col="black")
#### Tema: Diagnostic de Necesidades Educativas ####
# Pregunta data: "${p_040}. ¿La enfermedad está diagnosticada?"

Educacion <- PilotoIndividuos %>%
  dplyr::select(.,"${p_040}. ¿La enfermedad está diagnosticada?") %>%
  dplyr::rename(Necesidades="${p_040}. ¿La enfermedad está diagnosticada?") %>%
  drop_na() 

Educacion_v2 <- Agrupa(Data=Educacion,
                 Columna=Necesidades)

# Graficamos:
ggplot(Educacion_v2, aes(y=Porcentaje,x=reorder(Necesidades,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(y="Porcentaje",x="Diagnóstico de necesidad educativa")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")

```

```{r Modulo Recreación}
#### Tema: Participación política ####
# Pregunta data: "${p_040}. ¿Usted participa en alguna de las siguientes organizaciones o instancias de participación?"

Recreacion <- PilotoIndividuos %>%
  dplyr::select(.,"${p_040}. ¿Usted participa en alguna de las siguientes organizaciones o instancias de participación?") %>%
  dplyr::rename(RecreacionCol="${p_040}. ¿Usted participa en alguna de las siguientes organizaciones o instancias de participación?") %>%
  drop_na() %>% 
  dplyr::filter(RecreacionCol!="Ninguno")

Recreacion_v2 <- Agrupa(Data=Recreacion,
                 Columna=RecreacionCol)

# Graficamos:
ggplot(Recreacion_v2, aes(y=Porcentaje,x=reorder(RecreacionCol,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(y="Porcentaje",x="Instancias de participación")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.05),
            size=4, vjust=0, hjust=0.5 ,col="black")
#### Tema: Hobbies ####
# Preguntas data: 
# "${p_040}. ¿Cuáles son sus hobbies?/Cocina"
# "${p_040}. ¿Cuáles son sus hobbies?/Contactar y conversar"
# "${p_040}. ¿Cuáles son sus hobbies?/Escuchar música"
# "${p_040}. ¿Cuáles son sus hobbies?/Hacer deporte"
# "${p_040}. ¿Cuáles son sus hobbies?/Informarse"
# "${p_040}. ¿Cuáles son sus hobbies?/Jardinería"
# "${p_040}. ¿Cuáles son sus hobbies?/Juegos de mesa o azar"
# "${p_040}. ¿Cuáles son sus hobbies?/Leer"
# "${p_040}. ¿Cuáles son sus hobbies?/Manualidades"

Hobbies <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. ¿Cuáles son sus hobbies?/Cocina",
                    "${p_040}. ¿Cuáles son sus hobbies?/Contactar y conversar",
                    "${p_040}. ¿Cuáles son sus hobbies?/Escuchar música",
                    "${p_040}. ¿Cuáles son sus hobbies?/Hacer deporte",
                    "${p_040}. ¿Cuáles son sus hobbies?/Informarse",
                    "${p_040}. ¿Cuáles son sus hobbies?/Jardinería",
                    "${p_040}. ¿Cuáles son sus hobbies?/Juegos de mesa o azar",
                    "${p_040}. ¿Cuáles son sus hobbies?/Leer",
                    "${p_040}. ¿Cuáles son sus hobbies?/Manualidades"
                    )) %>%
  dplyr::rename(Cocina="${p_040}. ¿Cuáles son sus hobbies?/Cocina",
                Conversar="${p_040}. ¿Cuáles son sus hobbies?/Contactar y conversar",
                EscucharMusica="${p_040}. ¿Cuáles son sus hobbies?/Escuchar música",
                Deporte="${p_040}. ¿Cuáles son sus hobbies?/Hacer deporte",
                Informarse="${p_040}. ¿Cuáles son sus hobbies?/Informarse",
                Jardinería="${p_040}. ¿Cuáles son sus hobbies?/Jardinería",
                JuegosAzar="${p_040}. ¿Cuáles son sus hobbies?/Juegos de mesa o azar",
                Leer="${p_040}. ¿Cuáles son sus hobbies?/Leer",
                Manualidades="${p_040}. ¿Cuáles son sus hobbies?/Manualidades")

# Volvemos todas las columnaas en tipo numéricas:
Hobbies$Cocina <- as.numeric(Hobbies$Cocina)
Hobbies$Conversar <- as.numeric(Hobbies$Conversar)
Hobbies$EscucharMusica <- as.numeric(Hobbies$EscucharMusica)
Hobbies$Deporte <- as.numeric(Hobbies$Deporte)
Hobbies$Informarse <- as.numeric(Hobbies$Informarse)
Hobbies$Jardinería <- as.numeric(Hobbies$Jardinería)
Hobbies$JuegosAzar <- as.numeric(Hobbies$JuegosAzar)
Hobbies$Leer <- as.numeric(Hobbies$Leer)
Hobbies$Manualidades <- as.numeric(Hobbies$Manualidades)

# Creamos el DF acorde:
Hobbies_v2 <- data.frame("HobbieCol"=c("Cocinar","Conversar","Escuchar música",
                                           "Deporte","Informarse","Jardinería",
                                           "Juegos de azar","Leer","Manualidades"),
                        "Subtotal"=colSums(Hobbies[,1:9], na.rm=T)
                        )

Hobbies_v2$Total <- sum(Hobbies_v2$Subtotal)

Hobbies_v2 <- Hobbies_v2 %>% 
  dplyr::mutate(Porcentaje=round((Subtotal/Total)*100,2)) %>%
  dplyr::filter(Porcentaje!=0)


# Graficamos: 
ggplot(Hobbies_v2, aes(x=Porcentaje,y=reorder(HobbieCol,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(x="Porcentaje",y="Hobbies")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.7),
            size=4, vjust=0.5, hjust=0.5 ,col="black")


```

```{r Modulo Laboral e ingresos}
#### Tema: Actividad semana pasada ####
# Pregunta data: "${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]"

Actividad <- PilotoIndividuos %>%
  dplyr::select(.,"${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]") %>%
  dplyr::rename(ActividadCol="${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]") %>%
  drop_na() 

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=ActividadCol)

# Graficamos:
ggplot(Actividad_v2, aes(x=Porcentaje,y=reorder(ActividadCol,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(x="Porcentaje",y="Actividad durante la última semana")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.1),
            size=4, vjust=0, hjust=0.5 ,col="black")
#### Tema: Localización empleo ####
# Pregunta data: "${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]"
# Pregunta data: "${p_040}. ¿Municipio donde está ubicado su empleo principal?"

Actividad <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]","${p_040}. ¿Municipio donde está ubicado su empleo principal?")) %>%
  dplyr::rename(ActividadCol="${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]",Localizacion="${p_040}. ¿Municipio donde está ubicado su empleo principal?") %>%
  dplyr::filter(ActividadCol=="Trabajando") 

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=Localizacion)

# Graficamos:
ggplot(Actividad_v2, aes(y=Porcentaje,x=reorder(Localizacion,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(x="Localización empleo principal",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")
#### Tema: Sector económico empresa ####
# Pregunta data: "${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]"
# Pregunta data: "${p_040}. ¿A qué actividad específica se dedica principalmente la empresa o negocio en la que realiza su trabajo?"

Actividad <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]","${p_040}. ¿A qué actividad específica se dedica principalmente la empresa o negocio en la que realiza su trabajo?")) %>%
  dplyr::rename(ActividadCol="${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]",Sector="${p_040}. ¿A qué actividad específica se dedica principalmente la empresa o negocio en la que realiza su trabajo?") %>%
  dplyr::filter(ActividadCol=="Trabajando") 

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=Sector)

Actividad_v2$SectorShort <- c("Sector")

Actividad_v2 <- Actividad_v2 %>% 
  dplyr::mutate(SectorShort=ifelse(Sector=="A-Agricultura, Ganadería, Caza, Silvicultura y Pesca","A-Agricultura",SectorShort),
                SectorShort=ifelse(Sector=="G-Comercio al por mayor y por menor; reparación de vehículos y motos","G-Comercio",SectorShort)
                )
# Graficamos:
ggplot(Actividad_v2, aes(y=Porcentaje,x=reorder(SectorShort,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(x="Sector económico empleo principal",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")

#### Tema: Posición ocupacional ####
# Pregunta data: "${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]"
# Pregunta data: "${p_040}. En este trabajo es:"

Actividad <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]","${p_040}. En este trabajo es:")) %>%
  dplyr::rename(ActividadCol="${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]",Posicion="${p_040}. En este trabajo es:") %>%
  dplyr::filter(ActividadCol=="Trabajando") 

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=Posicion)

# Graficamos:
ggplot(Actividad_v2, aes(x=Porcentaje,y=reorder(Posicion,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(y="Posición ocupacional",x="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.8),
            size=4, vjust=0, hjust=0.5 ,col="black")

#### Tema: Horas en su empleo ####
# Pregunta data: "${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]"
# Pregunta data: "${p_040}. ¿Cuántas horas a la semana trabaja normalmente en ese trabajo principal?"

Actividad <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]","${p_040}. ¿Cuántas horas a la semana trabaja normalmente en ese trabajo principal?")) %>%
  dplyr::rename(ActividadCol="${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]",Horas="${p_040}. ¿Cuántas horas a la semana trabaja normalmente en ese trabajo principal?") %>%
  dplyr::filter(ActividadCol=="Trabajando") 

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=Horas)

Actividad_v2$Horas <- as.numeric(Actividad_v2$Horas)

# Graficamos: ggplot(Actividad_v2, aes(y=Porcentaje,x=reorder(Horas,-Porcentaje)
ggplot(Actividad_v2, aes(y=Porcentaje,x=Horas))+
  geom_point(fill="coral")+
  geom_segment( aes(x=Horas, xend=Horas, y=0, yend=Porcentaje))+
  labs(x="Horas de dedicación en su empleo por semana",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.1),
            size=4, vjust=0, hjust=0.5 ,col="black")+
  scale_x_continuous(breaks=c(0,8,10,20,30,40,45,50,60,70))
#### Tema: Tiene Contrato ####
# Pregunta data: "${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]"
# Pregunta data: "${p_040}. ¿Para realizar este trabajo tiene algún contrato?"

Actividad <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]","${p_040}. ¿Para realizar este trabajo tiene algún contrato?")) %>%
  dplyr::rename(ActividadCol="${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]",Contrato="${p_040}. ¿Para realizar este trabajo tiene algún contrato?") %>%
  dplyr::filter(ActividadCol=="Trabajando") 

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=Contrato)

# Graficamos: 
ggplot(Actividad_v2, aes(y=Porcentaje,x=Contrato))+
  geom_col(fill="aquamarine3")+
  labs(x="Tiene un contrato laboral",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")

#### Tema: Duración Contrato ####
# Pregunta data: "${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]"
# Pregunta data: "${p_040}. ¿Para realizar este trabajo tiene algún contrato?"
# Pregunta data: "${p_040}. ¿Qué término tiene el contrato?"

Actividad <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]","${p_040}. ¿Para realizar este trabajo tiene algún contrato?","${p_040}. ¿Qué término tiene el contrato?")) %>%
  dplyr::rename(ActividadCol="${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]",Contrato="${p_040}. ¿Para realizar este trabajo tiene algún contrato?", Duracion="${p_040}. ¿Qué término tiene el contrato?") %>%
  dplyr::filter(Contrato=="Si") 

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=Duracion)

# Graficamos: 
ggplot(Actividad_v2, aes(y=Porcentaje,x=Duracion))+
  geom_col(fill="cyan4")+
  labs(x="Duración del contrato laboral",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")

#### Tema: Ingresos laborales ####
# Pregunta data: "${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]"
# Pregunta data: "${p_040}. ¿Cuánto ganó el mes pasado en este empleo? o ¿Cuánto recibio el mes pasado por concepto de trabajo?"

Actividad <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]","${p_040}. ¿Cuánto ganó el mes pasado en este empleo? o ¿Cuánto recibio el mes pasado por concepto de trabajo?")) %>%
  dplyr::rename(ActividadCol="${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]",Ingresos="${p_040}. ¿Cuánto ganó el mes pasado en este empleo? o ¿Cuánto recibio el mes pasado por concepto de trabajo?") %>%
  dplyr::filter(ActividadCol=="Trabajando") %>% 
  drop_na()

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=Ingresos)

Actividad_v2$IngresosNum <- as.numeric(Actividad_v2$Ingresos)

# Media de ingresos
mean(Actividad_v2$IngresosNum)

# Graficamos: 
ggplot(Actividad_v2, aes(x=Porcentaje,y=reorder(Ingresos,IngresosNum)))+
  geom_col(fill="coral")+
  labs(x="Porcentaje",y="Ingreso laboral")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.1),
            size=4, vjust=0, hjust=0.5 ,col="black")
#### Tema: Oficios ####
# Preguntas data: 
#"${p_040}. En general, ¿qué oficio sabe hacer?/Agricultor"
# "${p_040}. En general, ¿qué oficio sabe hacer?/Chofer o conductor"
# "${p_040}. En general, ¿qué oficio sabe hacer?/Cocinero"
# "${p_040}. En general, ¿qué oficio sabe hacer?/Mecánico"
# "${p_040}. En general, ¿qué oficio sabe hacer?/Peluquero"
# "${p_040}. En general, ¿qué oficio sabe hacer?/Vendedor"
# "${p_040}. En general, ¿qué oficio sabe hacer?/Vigilante"
# "${p_040}. En general, ¿qué oficio sabe hacer?/Ninguno"
# "${p_040}. En general, ¿qué oficio sabe hacer?/Otro"
# "${p_040}. ¿Cuál?...164"

Oficio <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. En general, ¿qué oficio sabe hacer?/Agricultor","${p_040}. En general, ¿qué oficio sabe hacer?/Chofer o conductor","${p_040}. En general, ¿qué oficio sabe hacer?/Cocinero","${p_040}. En general, ¿qué oficio sabe hacer?/Mecánico","${p_040}. En general, ¿qué oficio sabe hacer?/Peluquero","${p_040}. En general, ¿qué oficio sabe hacer?/Vendedor","${p_040}. En general, ¿qué oficio sabe hacer?/Vigilante","${p_040}. En general, ¿qué oficio sabe hacer?/Ninguno","${p_040}. En general, ¿qué oficio sabe hacer?/Otro","${p_040}. ¿Cuál?...164")) %>%
  dplyr::rename(Agricultor="${p_040}. En general, ¿qué oficio sabe hacer?/Agricultor",
                Conductor="${p_040}. En general, ¿qué oficio sabe hacer?/Chofer o conductor",
                Cocinero="${p_040}. En general, ¿qué oficio sabe hacer?/Cocinero",
                Mecanico="${p_040}. En general, ¿qué oficio sabe hacer?/Mecánico",
                Peluquero="${p_040}. En general, ¿qué oficio sabe hacer?/Peluquero",
                Vendedor="${p_040}. En general, ¿qué oficio sabe hacer?/Vendedor",
                Vigilante="${p_040}. En general, ¿qué oficio sabe hacer?/Vigilante",
                Ninguno="${p_040}. En general, ¿qué oficio sabe hacer?/Ninguno",
                Otro="${p_040}. En general, ¿qué oficio sabe hacer?/Otro",
                Cual="${p_040}. ¿Cuál?...164")

# Volvemos todas las columnaas en tipo numéricas:
Oficio$Agricultor <- as.numeric(Oficio$Agricultor)
Oficio$Conductor <- as.numeric(Oficio$Conductor)
Oficio$Cocinero <- as.numeric(Oficio$Cocinero)
Oficio$Mecanico <- as.numeric(Oficio$Mecanico)
Oficio$Peluquero <- as.numeric(Oficio$Peluquero)
Oficio$Vendedor <- as.numeric(Oficio$Vendedor)
Oficio$Vigilante <- as.numeric(Oficio$Vigilante)
Oficio$Ninguno <- as.numeric(Oficio$Ninguno)
Oficio$Otro <- as.numeric(Oficio$Otro)

# Creamos el DF acorde:
Oficio_v2 <- data.frame("OficioCol"=c("Agricultor","Conductor","Cocinero","Mecanico","Peluquero","Vendedor","Vigilante","Ninguno","Otro"),
                        "Subtotal"=colSums(Oficio[,1:9], na.rm=T)
                        )

Oficio_v2$Total <- sum(Oficio_v2$Subtotal)

Oficio_v2 <- Oficio_v2 %>% 
  dplyr::mutate(Porcentaje=round((Subtotal/Total)*100,2))


# Graficamos: 
ggplot(Oficio_v2, aes(x=Porcentaje,y=reorder(OficioCol,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(x="Porcentaje",y="Oficio")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.1),
            size=4, vjust=0.5, hjust=0.5 ,col="black")
#### Tema: Recibio Otros ingresos ####
# Preguntas data: 
# "${p_040}. ¿Recibió el mes pasado ingresos por concepto de ARRIENDOS?"
# "${p_040}. ¿Recibió el mes pasado ingresos por concepto de PENSIONES O JUBULACIONES?"
# "${p_040}. ¿Recibió durante los últimos 12 meses ingresos por GIROS DE PERSONAS EN EL EXTERIOR?"
# "${p_040}. ¿Recibió durante los últimos 12 meses ingresos por INTERESES O DIVIDENDOS?"
# "${p_040}. ¿Recibió durante los últimos 12 meses ingresos por SUBSIDIOS DEL ESTADO?"

Ingresos <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. ¿Recibió el mes pasado ingresos por concepto de ARRIENDOS?","${p_040}. ¿Recibió el mes pasado ingresos por concepto de PENSIONES O JUBULACIONES?","${p_040}. ¿Recibió durante los últimos 12 meses ingresos por GIROS DE PERSONAS EN EL EXTERIOR?","${p_040}. ¿Recibió durante los últimos 12 meses ingresos por INTERESES O DIVIDENDOS?","${p_040}. ¿Recibió durante los últimos 12 meses ingresos por SUBSIDIOS DEL ESTADO?")) %>%
  dplyr::rename(Arriendos="${p_040}. ¿Recibió el mes pasado ingresos por concepto de ARRIENDOS?",
                Pensiones="${p_040}. ¿Recibió el mes pasado ingresos por concepto de PENSIONES O JUBULACIONES?",
                Remesas="${p_040}. ¿Recibió durante los últimos 12 meses ingresos por GIROS DE PERSONAS EN EL EXTERIOR?",
                Intereses="${p_040}. ¿Recibió durante los últimos 12 meses ingresos por INTERESES O DIVIDENDOS?",
                Subsidios="${p_040}. ¿Recibió durante los últimos 12 meses ingresos por SUBSIDIOS DEL ESTADO?") %>% 
  drop_na()

# Creamos las datas que necesitamos
Arriendos <- Agrupa(Data=Ingresos,
                 Columna=Arriendos)%>% 
  dplyr::rename(Ingreso=Arriendos)
Arriendos$TipoIngreso <- c("Arriendos")


Pensiones <- Agrupa(Data=Ingresos,
                 Columna=Pensiones)%>% 
  dplyr::rename(Ingreso=Pensiones)
Pensiones$TipoIngreso <- c("Pensiones")

Remesas <- Agrupa(Data=Ingresos,
                 Columna=Remesas)%>% 
  dplyr::rename(Ingreso=Remesas)
Remesas$TipoIngreso <- c("Remesas")

Intereses <- Agrupa(Data=Ingresos,
                 Columna=Intereses)%>% 
  dplyr::rename(Ingreso=Intereses)
Intereses$TipoIngreso <- c("Intereses")

Subsidios <- Agrupa(Data=Ingresos,
                 Columna=Subsidios)%>% 
  dplyr::rename(Ingreso=Subsidios)
Subsidios$TipoIngreso <- c("Subsidios")

# Concatenamos:
Ingresos_v2 <- join_all(list(Arriendos,Pensiones,Remesas,Intereses,Subsidios), by=c("TipoIngreso"),type = "full")


# Graficamos: 
ggplot(Ingresos_v2, aes(x=Porcentaje, y=TipoIngreso, fill=Ingreso))+
  geom_col()+
  labs(x="Porcentaje",y="Tipo de Ingreso",fill="Recibe ingreso")+
  geom_text(aes(label=Porcentaje),position = position_stack(0.4),
            size=4, vjust=0.5, hjust=-0.3 ,col="black")
#### Tema: Cuantia de Otros ingresos ####
# Preguntas data: 
# "${p_040}. ¿Cuánto recibió el mes pasado por concepto de ARRIENDOS?"
# "${p_040}. ¿Cuánto recibió el mes pasado por concepto de PENSIONES O JUBILACIONES?"
# "${p_040}. ¿Cuánto EN TOTAL recibió durante los últimos 12 meses por Giros de personas del exterior?"
# "${p_040}. ¿Cuánto EN TOTAL recibió durante los últimos 12 meses por Intereses o dividendos?"
# "${p_040}. ¿Cuánto EN TOTAL recibió durante los últimos 12 meses por Subsidios del estado?"

Ingresos <- PilotoIndividuos %>%
  dplyr::select("${p_040}. ¿Cuánto EN TOTAL recibió durante los últimos 12 meses por Subsidios del estado?") %>%
  dplyr::rename(Subsidios="${p_040}. ¿Cuánto EN TOTAL recibió durante los últimos 12 meses por Subsidios del estado?") %>% 
  drop_na()

Ingresos$Subsidios <- as.numeric(Ingresos$Subsidios)

Ingresos$PromedioSubs <- mean(Ingresos$Subsidios)
Ingresos$TipoIngreso <- c("Subsidio")


# Graficamos: Este gráfico no se aplicó
ggplot(Ingresos, aes(y=PromedioSubs, x=TipoIngreso))+
  geom_col()+
  labs(x="Porcentaje",y="Tipo de Ingreso",fill="Recibe ingreso")+
  geom_text(aes(label=PromedioSubs),position = position_stack(0.4),
            size=4, vjust=0.5, hjust=-0.3 ,col="black")
#### Tema: Tuvo empleo anteriormente ####
# Pregunta data: "${p_040}. Anteriormente, ¿tuvo un empleo?"

Empleo <- PilotoIndividuos %>%
  dplyr::select(.,"${p_040}. Anteriormente, ¿tuvo un empleo?") %>%
  dplyr::rename(EmpleoAnterior="${p_040}. Anteriormente, ¿tuvo un empleo?") %>% 
  drop_na() 

Empleo_v2 <- Agrupa(Data=Empleo,
                 Columna=EmpleoAnterior)

# Graficamos:
ggplot(Empleo_v2, aes(y=Porcentaje,x=reorder(EmpleoAnterior,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(y="Porcentaje",x="Anteriormente, ¿tuvo otro empleo?")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")

#### Tema: Sector económico Empleo anterior ####
# Pregunta data: "${p_040}. Anteriormente, ¿tuvo un empleo?"
# Pregunta data: "${p_040}. En su anterior empleo, ¿a qué actividad específica se dedicaba la empresa o negocio?"

Actividad <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. Anteriormente, ¿tuvo un empleo?","${p_040}. En su anterior empleo, ¿a qué actividad específica se dedicaba la empresa o negocio?")) %>%
  dplyr::rename(Empleo="${p_040}. Anteriormente, ¿tuvo un empleo?",Sector="${p_040}. En su anterior empleo, ¿a qué actividad específica se dedicaba la empresa o negocio?") %>%
  dplyr::filter(Empleo=="Si") 

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=Sector)

Actividad_v2$SectorShort <- c("Sector")

Actividad_v2 <- Actividad_v2 %>% 
  dplyr::mutate(SectorShort=ifelse(Sector=="A-Agricultura, Ganadería, Caza, Silvicultura y Pesca","A-Agricultura",SectorShort),
                SectorShort=ifelse(Sector=="B-Explotación de Minas y canteras","B-Explotación de Minas",SectorShort),
                SectorShort=ifelse(Sector=="F-Construcción","F-Construcción",SectorShort),
                SectorShort=ifelse(Sector=="G-Comercio al por mayor y por menor; reparación de vehículos y motos","G-Comercio",SectorShort),
                SectorShort=ifelse(Sector=="N-Actividades de servicio administrativo y de apoyo","N-Servicio administrativo",SectorShort),
                SectorShort=ifelse(Sector=="T-Actividades de hogares individuales.","T-Hogares",SectorShort)
                )
# Graficamos:
ggplot(Actividad_v2, aes(x=Porcentaje,y=reorder(SectorShort,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(y="Sector económico empleo anterior",x="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.8),
            size=4, vjust=0.5, hjust=0.5 ,col="black")
#### Tema: Posición ocupacional Empleo anterior ####
# Pregunta data: "${p_040}. Anteriormente, ¿tuvo un empleo?"
# Pregunta data: "${p_040}. En su anterior empleo, usted era:"

Actividad <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. Anteriormente, ¿tuvo un empleo?","${p_040}. En su anterior empleo, usted era:")) %>%
  dplyr::rename(Empleo="${p_040}. Anteriormente, ¿tuvo un empleo?",Posicion="${p_040}. En su anterior empleo, usted era:") %>%
  dplyr::filter(Empleo=="Si") 

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=Posicion)

# Graficamos:
ggplot(Actividad_v2, aes(x=Porcentaje,y=reorder(Posicion,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(y="Posición ocupacional en empleo anterior",x="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.8),
            size=4, vjust=0.5, hjust=0.5 ,col="black")
#### Tema: Intereses laborales a futuro ####
# Pregunta data: "${p_040}. ¿Cuáles son sus intereses laborales a futuro? (¿Qué le gustaría hacer?)"

Actividad <- PilotoIndividuos %>%
  dplyr::select(.,"${p_040}. ¿Cuáles son sus intereses laborales a futuro? (¿Qué le gustaría hacer?)") %>%
  dplyr::rename(InteresLaboral="${p_040}. ¿Cuáles son sus intereses laborales a futuro? (¿Qué le gustaría hacer?)") %>% 
  drop_na() 

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=InteresLaboral)

# Graficamos:
ggplot(Actividad_v2, aes(x=Porcentaje,y=reorder(InteresLaboral,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(x="Porcentaje",y="Intereses laborales a futuro")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.2),
            size=4, vjust=0.5, hjust=0 ,col="black")
#### Tema: Prioridad de inversión ####
# Pregunta data: "${p_040}. En su opinión: ¿cuál debería ser la prioridad de inversión en el municipio?"

Actividad <- PilotoIndividuos %>%
  dplyr::select(.,"${p_040}. En su opinión: ¿cuál debería ser la prioridad de inversión en el municipio?") %>%
  dplyr::rename(Inversion="${p_040}. En su opinión: ¿cuál debería ser la prioridad de inversión en el municipio?") %>%
  drop_na() %>% 
  dplyr::filter(Inversion!="No responde",
                Inversion!="No sabe")

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=Inversion)

# Graficamos:
ggplot(Actividad_v2, aes(x=Porcentaje,y=reorder(Inversion,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(x="Porcentaje",y="Prioridad de inversión")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.5),
            size=4, vjust=0.5, hjust=0.5 ,col="black")
```

```{r Modulo Movilidad}
#### Tema: Medio de transporte al centro educativo ####
# Pregunta data: "${p_040}. ¿Qué medio de transporte utiliza predominantemente para dirigirse a su centro educativo?"

Movilidad <- PilotoIndividuos %>%
  dplyr::select(.,"${p_040}. ¿Qué medio de transporte utiliza predominantemente para dirigirse a su centro educativo?") %>%
  dplyr::rename(MovilEduca="${p_040}. ¿Qué medio de transporte utiliza predominantemente para dirigirse a su centro educativo?") %>%
  drop_na() 

Movilidad_v2 <- Agrupa(Data=Movilidad,
                 Columna=MovilEduca)

# Graficamos:
ggplot(Movilidad_v2, aes(y=Porcentaje,x=reorder(MovilEduca,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(y="Porcentaje",x="Medio de transporte al C. Educativo")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.05),
            size=4, vjust=1, hjust=0.5 ,col="black")
#### Tema: Medio de transporte a Recreación ####
# Pregunta data: ${p_040}. ¿Qué medio de transporte utiliza predominantemente para dirigirse a su centro de recreación (para realizar hobbies)?

Movilidad <- PilotoIndividuos %>%
  dplyr::select(.,"${p_040}. ¿Qué medio de transporte utiliza predominantemente para dirigirse a su centro de recreación (para realizar hobbies)?") %>%
  dplyr::rename(Movil="${p_040}. ¿Qué medio de transporte utiliza predominantemente para dirigirse a su centro de recreación (para realizar hobbies)?") %>%
  drop_na() 

Movilidad_v2 <- Agrupa(Data=Movilidad,
                 Columna=Movil)

# Graficamos:
ggplot(Movilidad_v2, aes(y=Porcentaje,x=reorder(Movil,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(y="Porcentaje",x="Medio de transporte al C. Recreativo")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.05),
            size=4, vjust=1, hjust=0.5 ,col="black")

#### Tema: Medio de transporte al trabajo ####
# Pregunta data: "${p_040}. ¿Qué medio de transporte utiliza predominantemente para dirigirse al sitio de su empleo principal?"

Movilidad <- PilotoIndividuos %>%
  dplyr::select(.,"${p_040}. ¿Qué medio de transporte utiliza predominantemente para dirigirse al sitio de su empleo principal?") %>%
  dplyr::rename(Movil="${p_040}. ¿Qué medio de transporte utiliza predominantemente para dirigirse al sitio de su empleo principal?") %>%
  drop_na() 

Movilidad_v2 <- Agrupa(Data=Movilidad,
                 Columna=Movil)

# Graficamos:
ggplot(Movilidad_v2, aes(y=Porcentaje,x=reorder(Movil,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(y="Porcentaje",x="Medio de transporte al Trabajo")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.05),
            size=4, vjust=1, hjust=0.5 ,col="black")


#### Tema: Tiempo en transportarse ####
# Pregunta data: "${p_040}. ¿Cuánto tiempo tarda en llegar a su centro educativo? (minutos)"
# Pregunta data: "${p_040}. ¿Cuánto tiempo tarda en llegar a su centro de recreación (para realizar hobbies)? (minutos)"
# Pregunta data: "${p_040}. ¿Cuánto tiempo tarda en llegar al sitio de su empleo principal? (minutos)"

Movilidad <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. ¿Cuánto tiempo tarda en llegar a su centro educativo? (minutos)","${p_040}. ¿Cuánto tiempo tarda en llegar a su centro de recreación (para realizar hobbies)? (minutos)","${p_040}. ¿Cuánto tiempo tarda en llegar al sitio de su empleo principal? (minutos)")) %>%
  dplyr::rename(MovilEduca="${p_040}. ¿Cuánto tiempo tarda en llegar a su centro educativo? (minutos)",MovilRecrea="${p_040}. ¿Cuánto tiempo tarda en llegar a su centro de recreación (para realizar hobbies)? (minutos)",MovilTrabajo="${p_040}. ¿Cuánto tiempo tarda en llegar al sitio de su empleo principal? (minutos)") 

# Transformamos data a tipo numérico
Movilidad$MovilEduca <- as.numeric(Movilidad$MovilEduca)
Movilidad$MovilRecrea <- as.numeric(Movilidad$MovilRecrea)
Movilidad$MovilTrabajo <- as.numeric(Movilidad$MovilTrabajo)

# Creamos DFs:
Movilidad_v2 <- data.frame(
  "Educa"=mean(Movilidad$MovilEduca, na.rm=T),
  "Recrea"=mean(Movilidad$MovilRecrea, na.rm=T),
  "Trabajo"=mean(Movilidad$MovilTrabajo, na.rm=T)
)

Movilidad_v3 <- data.frame(
  "TipoMovilidad"=c("Educación","Recreación","Trabajo"),
  "Tiempo"=t(Movilidad_v2)
)

# Graficamos:
ggplot(Movilidad_v3, aes(y=Tiempo,x=reorder(TipoMovilidad,-Tiempo)))+
  geom_col(fill="cyan4")+
  labs(y="Tiempo promedio de movilidad (minutos)",x="Destino del desplazamiento")+
  geom_text(aes(label = Tiempo),position = position_stack(1.05),
            size=4, vjust=1, hjust=0.5 ,col="black")
#### Tema: Calificación vías: Educación  ####
# Pregunta data: "${p_040}. En su opinión: ¿cuál es el estado de las vías que utiliza para dirigirse a su centro educativo?"

Movilidad <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. En su opinión: ¿cuál es el estado de las vías que utiliza para dirigirse a su centro educativo?")) %>%
  dplyr::rename(MovilEduca="${p_040}. En su opinión: ¿cuál es el estado de las vías que utiliza para dirigirse a su centro educativo?") %>% 
  drop_na()

Movilidad_v2 <- Agrupa(Data=Movilidad,
                 Columna=MovilEduca)

# Graficamos:
ggplot(Movilidad_v2, aes(y=Porcentaje,x=reorder(MovilEduca,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(y="Porcentaje",x="Calificación vías hacía C. Educativo")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.05),
            size=4, vjust=1, hjust=0.5 ,col="black")

#### Tema: Calificación vías: Recreación ####
# Pregunta data: "${p_040}. En su opinión: ¿cuál es el estado de las vías que utiliza para dirigirse a su centro de recreación"
Movilidad <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. En su opinión: ¿cuál es el estado de las vías que utiliza para dirigirse a su centro de recreación (para realizar hobbies)?")) %>%
  dplyr::rename(MovilRecrea="${p_040}. En su opinión: ¿cuál es el estado de las vías que utiliza para dirigirse a su centro de recreación (para realizar hobbies)?") %>% 
  drop_na()

Movilidad_v2 <- Agrupa(Data=Movilidad,
                 Columna=MovilRecrea)

# Graficamos:
ggplot(Movilidad_v2, aes(y=Porcentaje,x=reorder(MovilRecrea,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(y="Porcentaje",x="Calificación vías hacía C. Recreativo")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.05),
            size=4, vjust=1, hjust=0.5 ,col="black")


#### Tema: Calificación vías: Trabajo ####
# Pregunta data: "${p_040}. En su opinión: ¿cuál es el estado de las vías que utiliza para dirigirse al sitio de su empleo principal?"

Movilidad <- PilotoIndividuos %>%
  dplyr::select(.,c("${p_040}. En su opinión: ¿cuál es el estado de las vías que utiliza para dirigirse al sitio de su empleo principal?")) %>%
  dplyr::rename(MovilTrabajo="${p_040}. En su opinión: ¿cuál es el estado de las vías que utiliza para dirigirse al sitio de su empleo principal?") %>% 
  dplyr::filter(MovilTrabajo!="No se encuentra en casa") %>% 
  drop_na()

Movilidad_v2 <- Agrupa(Data=Movilidad,
                 Columna=MovilTrabajo)

# Graficamos:
ggplot(Movilidad_v2, aes(y=Porcentaje,x=reorder(MovilTrabajo,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(y="Porcentaje",x="Calificación vías hacía el Trabajo")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.05),
            size=4, vjust=1, hjust=0.5 ,col="black")
```

```{r Modulo Proyectos productivos}
#### Tema: Tiene proyecto productivo ####
# Pregunta data: "¿Tiene este hogar algún tipo de negocio?"

Proyecto <- PilotoHogares %>%
  dplyr::select(.,"¿Tiene este hogar algún tipo de negocio?") %>%
  dplyr::rename(ProyectoCol="¿Tiene este hogar algún tipo de negocio?") %>% 
  drop_na() 

Proyecto_v2 <- Agrupa(Data=Proyecto,
                 Columna=ProyectoCol)

# Graficamos:
ggplot(Proyecto_v2, aes(y=Porcentaje,x=reorder(ProyectoCol,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(y="Porcentaje",x="Proyectos productivos en el hogar")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")


#### Tema: Localización del proyecto productivo ####
# Pregunta data: "¿Dónde está ubicado el negocio?"

Proyecto <- PilotoProyectos %>%
  dplyr::select(.,"¿Dónde está ubicado el negocio?") %>%
  dplyr::rename(ProyectoCol="¿Dónde está ubicado el negocio?") %>% 
  drop_na() 

Proyecto_v2 <- Agrupa(Data=Proyecto,
                 Columna=ProyectoCol)

# Graficamos:
ggplot(Proyecto_v2, aes(y=Porcentaje,x=reorder(ProyectoCol,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(y="Porcentaje",x="Localización del Proyecto productivo")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")
#### Tema: Sector económico del proyecto ####
# Pregunta data: "¿Cuál es la actividad económica del negocio?"

Actividad <- PilotoProyectos %>%
  dplyr::select(.,c("¿Cuál es la actividad económica del negocio?")) %>%
  dplyr::rename(Sector="¿Cuál es la actividad económica del negocio?")

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=Sector)

Actividad_v2$SectorShort <- c("Sector")

Actividad_v2 <- Actividad_v2 %>% 
  dplyr::mutate(SectorShort=ifelse(Sector=="G-Comercio al por mayor y por menor; reparación de vehículos y motos","G-Comercio",SectorShort)
                )
# Graficamos:
ggplot(Actividad_v2, aes(y=Porcentaje,x=reorder(SectorShort,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(x="Sector económico proyecto del productivo",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.05),
            size=4, vjust=0.5, hjust=0.5 ,col="black")
#### Tema: Inscrito en CC ####
# Pregunta data: "¿Está inscrito en Cámara de Comercio?"

Actividad <- PilotoProyectos %>%
  dplyr::select(.,c("¿Está inscrito en Cámara de Comercio?")) %>%
  dplyr::rename(Inscripcion="¿Está inscrito en Cámara de Comercio?")

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=Inscripcion)

# Graficamos:
ggplot(Actividad_v2, aes(y=Porcentaje,x=reorder(Inscripcion,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(x="Inscripción en Cámara de Comercio",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.05),
            size=4, vjust=0.5, hjust=0.5 ,col="black")

#### Tema: Tiene RUT ####
# Pregunta data: "¿Tiene Rut?"

Actividad <- PilotoProyectos %>%
  dplyr::select(.,c("¿Tiene Rut?")) %>%
  dplyr::rename(Inscripcion="¿Tiene Rut?")

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=Inscripcion)

# Graficamos:
ggplot(Actividad_v2, aes(y=Porcentaje,x=reorder(Inscripcion,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(x="Inscripción en Registro Único Tributario",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.05),
            size=4, vjust=0.5, hjust=0.5 ,col="black")


#### Tema: Oferta de sus productos ####
# Pregunta data: "Ofrece sus servicios o productos a:"

Actividad <- PilotoProyectos %>%
  dplyr::select(.,c("Ofrece sus servicios o productos a:")) %>%
  dplyr::rename(Oferta="Ofrece sus servicios o productos a:")

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=Oferta)

# Graficamos:
ggplot(Actividad_v2, aes(y=Porcentaje,x=reorder(Oferta,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(x="Tipo de ventas",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1.05),
            size=4, vjust=0.5, hjust=0.5 ,col="black")



#### Tema: Promedio de ingresos ####
# Pregunta data: "¿Cuál fue la ganancia neta en esta actividad el mes pasado?"

Proyectos <- PilotoProyectos %>%
  dplyr::select(.,c("¿Cuál fue la ganancia neta en esta actividad el mes pasado?")) %>%
  dplyr::rename(Ingresos="¿Cuál fue la ganancia neta en esta actividad el mes pasado?") 

# Transformamos data a tipo numérico
Proyectos$Ingresos <- as.numeric(Proyectos$Ingresos)


# Creamos DFs:
Proyectos_v2 <- data.frame(
  "Ingresos"=mean(Proyectos$Ingresos, na.rm=T)
)

Proyectos_v3 <- data.frame(
  "Tipo"=c("Ganancia"),
  "GananciaCol"=t(Proyectos_v2)
)

# Graficamos:
ggplot(Proyectos_v3, aes(y=GananciaCol,x=Tipo))+
  geom_col(fill="aquamarine3")+
  labs(y="Ganancia neta del proyecto",x="Vereda La Estrella")+
  geom_text(aes(label = GananciaCol),position = position_stack(1.05),
            size=4, vjust=1, hjust=0.5 ,col="black")+
  theme(axis.text.x = element_blank())

```

```{r Modulo Vivienda Infraestructura}
#### Tema: Tipo de vivienda ####
# Pregunta data: "Tipo de vivienda"

Vivienda <- PilotoHogares %>%
  dplyr::select(.,c("Tipo de vivienda")) %>%
  dplyr::rename(Columna="Tipo de vivienda")

Vivienda_v2 <- Agrupa(Data=Vivienda,
                 Columna=Columna)

# Graficamos:
ggplot(Vivienda_v2, aes(y=Porcentaje,x=reorder(Columna,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(x="Tipo de vivienda",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")
#### Tema: Material de paredes ####
# Pregunta data: "¿Cuál es el Material predominante de las paredes exteriores?"

Vivienda <- PilotoHogares %>%
  dplyr::select(.,c("¿Cuál es el Material predominante de las paredes exteriores?")) %>%
  dplyr::rename(Columna="¿Cuál es el Material predominante de las paredes exteriores?")

Vivienda_v2 <- Agrupa(Data=Vivienda,
                 Columna=Columna)

Vivienda_v2$ColumnaShort <- c("Columna")

Vivienda_v2 <- Vivienda_v2 %>% 
  dplyr::mutate(ColumnaShort=ifelse(Columna=="Ladrillo ranurado o revitado","Ladrillo ranurado",ColumnaShort),
                ColumnaShort=ifelse(Columna=="Ladrillo-bloque-adobe revocado o pintado","Ladrillo revocado",ColumnaShort),
                ColumnaShort=ifelse(Columna=="Ladrillo-bloque-adobe sin ranurar, sin revocar o sin revitar","Ladrillo sin revocar",ColumnaShort))
                
                
# Graficamos:
ggplot(Vivienda_v2, aes(y=Porcentaje,x=reorder(ColumnaShort,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(x="Material de paredes",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")

#### Tema: Material de pisos ####
# Pregunta data: "¿Cuál es el Material predominante de los pisos?"

Vivienda <- PilotoHogares %>%
  dplyr::select(.,c("¿Cuál es el Material predominante de los pisos?")) %>%
  dplyr::rename(Columna="¿Cuál es el Material predominante de los pisos?")

Vivienda_v2 <- Agrupa(Data=Vivienda,
                 Columna=Columna)

Vivienda_v2$ColumnaShort <- c("Columna")

Vivienda_v2 <- Vivienda_v2 %>% 
  dplyr::mutate(ColumnaShort=ifelse(Columna=="Baldosa, vinilo, tableta o ladrillo","Baldosa",ColumnaShort),
                ColumnaShort=ifelse(Columna=="Cemento o gravilla","Cemento",ColumnaShort),
                ColumnaShort=ifelse(Columna=="Madera burda, tabla, tablón u otro vegetal","Madera",ColumnaShort))
                
# Graficamos:
ggplot(Vivienda_v2, aes(y=Porcentaje,x=reorder(ColumnaShort,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(x="Material de piso",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")


#### Tema: De donde viene el agua ####
# Pregunta data: "¿De dónde obtiene principalmente esta vivienda el agua para consumo humano?"

Vivienda <- PilotoHogares %>%
  dplyr::select(.,c("¿De dónde obtiene principalmente esta vivienda el agua para consumo humano?")) %>%
  dplyr::rename(Columna="¿De dónde obtiene principalmente esta vivienda el agua para consumo humano?")

Vivienda_v2 <- Agrupa(Data=Vivienda,
                 Columna=Columna)

Vivienda_v2$ColumnaShort <- c("Columna")

Vivienda_v2 <- Vivienda_v2 %>% 
  dplyr::mutate(ColumnaShort=ifelse(Columna=="Acueducto veredal o comunal","Acueducto",ColumnaShort),
                ColumnaShort=ifelse(Columna=="Río, quebrada, manantial o nacimiento","Río o quebrada",ColumnaShort))
                
# Graficamos:
ggplot(Vivienda_v2, aes(y=Porcentaje,x=reorder(ColumnaShort,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(x="Fuente de agua",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")



#### Tema: Calificación Energía ####
# Pregunta data: "¿Cómo califica este servicio (Energía)?"

Vivienda <- PilotoHogares %>%
  dplyr::select(.,c("¿Cómo califica este servicio (Energía)?")) %>%
  dplyr::rename(Columna="¿Cómo califica este servicio (Energía)?")

Vivienda_v2 <- Agrupa(Data=Vivienda,
                 Columna=Columna)
                
# Graficamos:
ggplot(Vivienda_v2, aes(y=Porcentaje,x=reorder(Columna,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(x="Calificacion: servicio de energía",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")

#### Tema: Calificación Acueducto ####
# Pregunta data: "¿Cómo califica este servicio (Acueducto)?"

Vivienda <- PilotoHogares %>%
  dplyr::select(.,c("¿Cómo califica este servicio (Acueducto)?")) %>%
  dplyr::rename(Columna="¿Cómo califica este servicio (Acueducto)?") %>% 
  drop_na()


Vivienda_v2 <- Agrupa(Data=Vivienda,
                 Columna=Columna)
                
# Graficamos:
ggplot(Vivienda_v2, aes(y=Porcentaje,x=reorder(Columna,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(x="Calificacion: servicio de acueducto",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")


#### Tema: Cuenta con alcantarillado ####
# Pregunta data: "¿La vivienda cuenta con servicio de ALCANTARILLADO?"

Vivienda <- PilotoHogares %>%
  dplyr::select(.,c("¿La vivienda cuenta con servicio de ALCANTARILLADO?")) %>%
  dplyr::rename(Columna="¿La vivienda cuenta con servicio de ALCANTARILLADO?") %>% 
  drop_na()


Vivienda_v2 <- Agrupa(Data=Vivienda,
                 Columna=Columna)
                
# Graficamos:
ggplot(Vivienda_v2, aes(y=Porcentaje,x=reorder(Columna,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(x="Servicio de alcantarillado",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")



#### Tema: Cuenta con telefonía ####
# Pregunta data: "¿La vivienda cuenta con servicio de TELÉFONO FIJO?"

Vivienda <- PilotoHogares %>%
  dplyr::select(.,c("¿La vivienda cuenta con servicio de TELÉFONO FIJO?")) %>%
  dplyr::rename(Columna="¿La vivienda cuenta con servicio de TELÉFONO FIJO?") %>% 
  drop_na()


Vivienda_v2 <- Agrupa(Data=Vivienda,
                 Columna=Columna)
                
# Graficamos:
ggplot(Vivienda_v2, aes(y=Porcentaje,x=reorder(Columna,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(x="Servicio de telefonía",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")

#### Tema: Cocina ####
# Pregunta data: "¿Con qué cocinan en este hogar?"

Vivienda <- PilotoHogares %>%
  dplyr::select(.,c("¿Con qué cocinan en este hogar?")) %>%
  dplyr::rename(Columna="¿Con qué cocinan en este hogar?") %>% 
  drop_na()


Vivienda_v2 <- Agrupa(Data=Vivienda,
                 Columna=Columna)
                
# Graficamos:
ggplot(Vivienda_v2, aes(y=Porcentaje,x=reorder(Columna,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(x="Fuente de energía para cocinar",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")


#### Tema: Calificación Cocina ####
# Pregunta data: "¿Cómo califica este servicio?"

Vivienda <- PilotoHogares %>%
  dplyr::select(.,c("¿Cómo califica este servicio?")) %>%
  dplyr::rename(Columna="¿Cómo califica este servicio?") %>% 
  drop_na()


Vivienda_v2 <- Agrupa(Data=Vivienda,
                 Columna=Columna)
                
# Graficamos:
ggplot(Vivienda_v2, aes(y=Porcentaje,x=reorder(Columna,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(x="Calificacion: servicio de gas",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")



#### Tema: Cuenta con Aseo y recolección ####
# Pregunta data: "¿La vivienda cuenta con servicio de ASEO RECOLECCIÓN?"

Vivienda <- PilotoHogares %>%
  dplyr::select(.,c("¿La vivienda cuenta con servicio de ASEO RECOLECCIÓN?")) %>%
  dplyr::rename(Columna="¿La vivienda cuenta con servicio de ASEO RECOLECCIÓN?") %>% 
  drop_na()


Vivienda_v2 <- Agrupa(Data=Vivienda,
                 Columna=Columna)
                
# Graficamos:
ggplot(Vivienda_v2, aes(y=Porcentaje,x=reorder(Columna,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(x="Servicio de recolección de basuras y aseo",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")


#### Tema: Cuenta con Internet ####
# Pregunta data: "¿La vivienda cuenta con servicio de CONEXIÓN A INTERNET?"

Vivienda <- PilotoHogares %>%
  dplyr::select(.,c("¿La vivienda cuenta con servicio de CONEXIÓN A INTERNET?")) %>%
  dplyr::rename(Columna="¿La vivienda cuenta con servicio de CONEXIÓN A INTERNET?") %>% 
  drop_na()


Vivienda_v2 <- Agrupa(Data=Vivienda,
                 Columna=Columna)
                
# Graficamos:
ggplot(Vivienda_v2, aes(x=Porcentaje,y=reorder(Columna,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(y="Servicio de internet",x="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0 ,col="black")



#### Tema: Calificación Internet ####
# Pregunta data: "¿Cómo califica este servicio (CONEXIÓN A INTERNET)?"

Vivienda <- PilotoHogares %>%
  dplyr::select(.,c("¿Cómo califica este servicio (CONEXIÓN A INTERNET)?")) %>%
  dplyr::rename(Columna="¿Cómo califica este servicio (CONEXIÓN A INTERNET)?") %>% 
  drop_na()


Vivienda_v2 <- Agrupa(Data=Vivienda,
                 Columna=Columna)
                
# Graficamos:
ggplot(Vivienda_v2, aes(y=Porcentaje,x=reorder(Columna,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(x="Calificacion: servicio de internet",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")
#### Tema: Tipo de conexión Internet ####
# Pregunta data: "Tipo de conexión a internet."

Vivienda <- PilotoHogares %>%
  dplyr::select(.,c("Tipo de conexión a internet.")) %>%
  dplyr::rename(Columna="Tipo de conexión a internet.") %>% 
  drop_na()


Vivienda_v2 <- Agrupa(Data=Vivienda,
                 Columna=Columna)
                
# Graficamos:
ggplot(Vivienda_v2, aes(y=Porcentaje,x=reorder(Columna,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(x="Tipo de conexión a internet",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")

#### Tema: Razones de No Internet ####
# Pregunta data: "¿Por qué razón no posee conexión a internet?"

Vivienda <- PilotoHogares %>%
  dplyr::select(.,c("¿Por qué razón no posee conexión a internet?")) %>%
  dplyr::rename(Columna="¿Por qué razón no posee conexión a internet?") %>% 
  drop_na()


Vivienda_v2 <- Agrupa(Data=Vivienda,
                 Columna=Columna)
                
# Graficamos:
ggplot(Vivienda_v2, aes(y=Porcentaje,x=reorder(Columna,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(x="Razones de no conexión a internet",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")


#### Tema: Cuenta con TV ####
# Pregunta data: "¿La vivienda cuenta con servicio de TELEVISIÓN?"

Vivienda <- PilotoHogares %>%
  dplyr::select(.,c("¿La vivienda cuenta con servicio de TELEVISIÓN?")) %>%
  dplyr::rename(Columna="¿La vivienda cuenta con servicio de TELEVISIÓN?") %>% 
  drop_na()


Vivienda_v2 <- Agrupa(Data=Vivienda,
                 Columna=Columna)
                
# Graficamos:
ggplot(Vivienda_v2, aes(x=Porcentaje,y=reorder(Columna,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(y="Servicio de televisión",x="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=1 ,col="black")




#### Tema: Calificación TV ####
# Pregunta data: "¿Cómo califica este servicio (TELEVISIÓN)?"

Vivienda <- PilotoHogares %>%
  dplyr::select(.,c("¿Cómo califica este servicio (TELEVISIÓN)?")) %>%
  dplyr::rename(Columna="¿Cómo califica este servicio (TELEVISIÓN)?") %>% 
  drop_na()


Vivienda_v2 <- Agrupa(Data=Vivienda,
                 Columna=Columna)
                
# Graficamos:
ggplot(Vivienda_v2, aes(y=Porcentaje,x=reorder(Columna,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(x="Calificacion: servicio de televisión",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")

#### Tema: Separación de residuos ####
# Pregunta data: "¿En este hogar hacen separación de residuos sólidos?"

Vivienda <- PilotoHogares %>%
  dplyr::select(.,c("¿En este hogar hacen separación de residuos sólidos?")) %>%
  dplyr::rename(Columna="¿En este hogar hacen separación de residuos sólidos?") %>% 
  drop_na()


Vivienda_v2 <- Agrupa(Data=Vivienda,
                 Columna=Columna)
                
# Graficamos:
ggplot(Vivienda_v2, aes(y=Porcentaje,x=reorder(Columna,-Porcentaje)))+
  geom_col(fill="coral")+
  labs(x="Separación de residuos",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")


#### Tema: Método de separación de residuos ####
# Pregunta data: "¿Cómo disponen principalmente los residuos en esta unidad de vivienda?"

Vivienda <- PilotoHogares %>%
  dplyr::select(.,c("¿Cómo disponen principalmente los residuos en esta unidad de vivienda?")) %>%
  dplyr::rename(Columna="¿Cómo disponen principalmente los residuos en esta unidad de vivienda?") %>% 
  drop_na()


Vivienda_v2 <- Agrupa(Data=Vivienda,
                 Columna=Columna)

Vivienda_v2$ColumnaShort <- c("Columna")

Vivienda_v2 <- Vivienda_v2 %>% 
  dplyr::mutate(ColumnaShort=ifelse(Columna=="La queman","La queman",ColumnaShort),
                ColumnaShort=ifelse(Columna=="La entierran","La entierran",ColumnaShort),
                ColumnaShort=ifelse(Columna=="La llevan a contenedor, basurero público","La llevan al basurero público",ColumnaShort),
                ColumnaShort=ifelse(Columna=="La recoge un servicio informal (Zorra, carreta, etc)","La recoge un servicio informal",ColumnaShort),
                ColumnaShort=ifelse(Columna=="La tiran al patio, lote, zanja, baldío o vía pública","La tiran al patio",ColumnaShort)
                )

          
# Graficamos:
ggplot(Vivienda_v2, aes(x=Porcentaje,y=reorder(ColumnaShort,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(y="Tratamiento de residuos",x="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=1 ,col="black")



#### Tema: Servicio sanitario ####
# Pregunta data: "¿Con qué tipo de servicio sanitario cuenta el hogar?"

Vivienda <- PilotoHogares %>%
  dplyr::select(.,c("¿Con qué tipo de servicio sanitario cuenta el hogar?")) %>%
  dplyr::rename(Columna="¿Con qué tipo de servicio sanitario cuenta el hogar?") %>% 
  drop_na()


Vivienda_v2 <- Agrupa(Data=Vivienda,
                 Columna=Columna)
          
# Graficamos:
ggplot(Vivienda_v2, aes(y=Porcentaje,x=reorder(Columna,-Porcentaje)))+
  geom_col(fill="cyan4")+
  labs(x="Servicio sanitario",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")


#### Tema: Centro de salud más cercano ####
# Pregunta data: "El hospital o centro de salud más cercano se encuentra en:"

Vivienda <- PilotoHogares %>%
  dplyr::select(.,c("El hospital o centro de salud más cercano se encuentra en:")) %>%
  dplyr::rename(Columna="El hospital o centro de salud más cercano se encuentra en:") %>% 
  drop_na()


Vivienda_v2 <- Agrupa(Data=Vivienda,
                 Columna=Columna)
          
# Graficamos:
ggplot(Vivienda_v2, aes(y=Porcentaje,x=reorder(Columna,-Porcentaje)))+
  geom_col(fill="aquamarine3")+
  labs(x="Cercanía del centro de salud",y="Porcentaje")+
  geom_text(aes(label = Porcentaje),position = position_stack(1),
            size=4, vjust=0, hjust=0.5 ,col="black")



```


## Caracterización Data Primaria: sin FExp
```{r Data Primaria}
# Datas primarias:
# Por un error la convención de la data aparece como "Piloto...", pero no pasa nada
PilotoIndividuos <- read_excel("/Volumes/Respaldo/Google Drive-Actualizado/Ecsim/2021_CaracterizaciónJericó/2_EntregablesOtros/9_Arbey_DataExportada/20210617_Data.xlsx",sheet="p_039")

PilotoHogares <- read_excel("/Volumes/Respaldo/Google Drive-Actualizado/Ecsim/2021_CaracterizaciónJericó/2_EntregablesOtros/9_Arbey_DataExportada/20210617_Data.xlsx",sheet="Encuesta definitiva Jericó -...")

PilotoProyectos <- read_excel("/Volumes/Respaldo/Google Drive-Actualizado/Ecsim/2021_CaracterizaciónJericó/2_EntregablesOtros/9_Arbey_DataExportada/20210617_Data.xlsx",sheet="p_103_2")

#### Algunos cálculos propios ####

# Mejoramos la columna de localización en PilotoIndividuos:
PilotoIndividuos <- PilotoIndividuos %>% 
  dplyr::rename(Vereda="Corregimiento o vereda")

PilotoIndividuos$Localizacion <- c("Localización")

PilotoIndividuos <- PilotoIndividuos %>%
  dplyr::mutate(Localizacion=ifelse(is.na(Vereda)==T,"Cabecera Urbana",Vereda))

# Mejoramos la columna de localización en PilotoHogares:
PilotoHogares <- PilotoHogares %>% 
  dplyr::rename(Vereda="Corregimiento o vereda")

PilotoHogares$Localizacion <- c("Localización")

PilotoHogares <- PilotoHogares %>%
  dplyr::mutate(Localizacion=ifelse(is.na(Vereda)==T,"Cabecera Urbana",Vereda))

# Mejoramos la columna de localización en PilotoHogares:
PilotoProyectos <- PilotoProyectos %>% 
  dplyr::rename(Vereda="Corregimiento o vereda")

PilotoProyectos$Localizacion <- c("Localización")

PilotoProyectos <- PilotoProyectos %>%
  dplyr::mutate(Localizacion=ifelse(is.na(Vereda)==T,"Cabecera Urbana",Vereda))

#### Funciones ####
# Función para: Piloto Individuos
# Función agrupa: toma una data, la agrupa según la columna y calcula los %
Agrupa <- function(Data,Columna){
  
  Data_v2 <- Data %>%
  dplyr::group_by(Localizacion) %>%
  dplyr::summarise(
    TotalLocalizacion = n())
  
  Data_v3 <- Data %>%
  dplyr::group_by(Localizacion,{{Columna}}) %>%
  dplyr::summarise(
    Subtotal = n())

  Data_v4 <- join_all(list(Data_v2,Data_v3), by=c("Localizacion"),type = "full")

  Data_v4 <- Data_v4 %>% 
  dplyr::mutate(Porcentaje=round((Subtotal/TotalLocalizacion)*100,2))

return(Data_v4)
}
```

```{r Modulo Características del hogar}
#### Tema: Sexo ####
# Pregunta data: "Sexo de ${p_040}:"

Sexo <- PilotoIndividuos %>%
  dplyr::select(.,"Vereda","Localizacion","Sexo de ${p_040}:") %>%
  dplyr::rename(SexoCol="Sexo de ${p_040}:")

Sexo_v2 <- Agrupa(Data=Sexo,Columna=SexoCol)
  
# Graficamos:
ggplot(Sexo_v2, aes(x=Porcentaje,y=Localizacion,fill=SexoCol))+
  geom_col()+
  labs(x="Porcentaje",y="Localización",fill="Sexo:")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.5),
            size=4, vjust=0.5, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top")+
  scale_x_continuous(limits=c(0,100))

# Paso opcional: exportamos data:
write_xlsx(Sexo_v5, "Sexo.xlsx")

# Eliminamos intermedios:
rm(Sexo,Sexo_v2)

#### Tema: Identidad sexual ####
# Pregunta data: "${p_040} se identifica como:"
Identidad <- PilotoIndividuos %>%
  dplyr::select(.,"Vereda","Localizacion","${p_040} se identifica como:") %>%
  dplyr::rename(IdentidadCol="${p_040} se identifica como:") %>% 
  dplyr::filter(is.na(IdentidadCol)==F)

Identidad_v2 <- Agrupa(Data=Identidad,Columna=IdentidadCol)

# Graficamos:
ggplot(Identidad_v2, aes(x=Porcentaje,y=Localizacion,fill=IdentidadCol))+
  geom_col()+
  labs(x="Porcentaje",y="Localización",fill="Identidad sexual:")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.4),
            size=4, vjust=0.5, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(0.7)),
        legend.position="top")+
  scale_x_continuous(limits=c(0,107))

# Paso opcional: exportamos data:
write_xlsx(Identidad_v2, "Identidad.xlsx")

# Eliminamos intermedios:
rm(Identidad,Identidad_v2)

#### Tema: Medios de información####
# Preguntas data: 
#"${p_040}. ¿Qué medios usa principalmente para estar informado?/Computador de escritorio"
# "${p_040}. ¿Qué medios usa principalmente para estar informado?/Computador portátil"
# "${p_040}. ¿Qué medios usa principalmente para estar informado?/Tableta"
# "${p_040}. ¿Qué medios usa principalmente para estar informado?/Telefono celular"
# "${p_040}. ¿Qué medios usa principalmente para estar informado?/Televisor"
# "${p_040}. ¿Qué medios usa principalmente para estar informado?/Reproductor de radio"
# "${p_040}. ¿Qué medios usa principalmente para estar informado?/Periódico"
# "${p_040}. ¿Qué medios usa principalmente para estar informado?/Revistas"
# "${p_040}. ¿Qué medios usa principalmente para estar informado?/Ninguno"
# "${p_040}. ¿Qué medios usa principalmente para estar informado?/Otro"

Informacion <- PilotoIndividuos %>%
  dplyr::select(.,c("Vereda","Localizacion","${p_040}. ¿Qué medios usa principalmente para estar informado?/Computador de escritorio","${p_040}. ¿Qué medios usa principalmente para estar informado?/Computador portátil", "${p_040}. ¿Qué medios usa principalmente para estar informado?/Tableta","${p_040}. ¿Qué medios usa principalmente para estar informado?/Telefono celular","${p_040}. ¿Qué medios usa principalmente para estar informado?/Televisor","${p_040}. ¿Qué medios usa principalmente para estar informado?/Reproductor de radio","${p_040}. ¿Qué medios usa principalmente para estar informado?/Periódico","${p_040}. ¿Qué medios usa principalmente para estar informado?/Revistas","${p_040}. ¿Qué medios usa principalmente para estar informado?/Ninguno","${p_040}. ¿Qué medios usa principalmente para estar informado?/Otro")) %>%
  dplyr::rename(Computador="${p_040}. ¿Qué medios usa principalmente para estar informado?/Computador de escritorio",Portatil="${p_040}. ¿Qué medios usa principalmente para estar informado?/Computador portátil",Tablet="${p_040}. ¿Qué medios usa principalmente para estar informado?/Tableta",Celular="${p_040}. ¿Qué medios usa principalmente para estar informado?/Telefono celular",Televisor="${p_040}. ¿Qué medios usa principalmente para estar informado?/Televisor",Radio="${p_040}. ¿Qué medios usa principalmente para estar informado?/Reproductor de radio",Periodico="${p_040}. ¿Qué medios usa principalmente para estar informado?/Periódico",Revistas="${p_040}. ¿Qué medios usa principalmente para estar informado?/Revistas",Ninguno="${p_040}. ¿Qué medios usa principalmente para estar informado?/Ninguno",Otro="${p_040}. ¿Qué medios usa principalmente para estar informado?/Otro")

# Volvemos todas las columnaas en tipo numéricas:
Informacion$Computador <- as.numeric(Informacion$Computador)
Informacion$Portatil <- as.numeric(Informacion$Portatil)
Informacion$Tablet <- as.numeric(Informacion$Tablet)
Informacion$Celular <- as.numeric(Informacion$Celular)
Informacion$Televisor <- as.numeric(Informacion$Televisor)
Informacion$Radio <- as.numeric(Informacion$Radio)
Informacion$Periodico <- as.numeric(Informacion$Periodico)
Informacion$Revistas <- as.numeric(Informacion$Revistas)
Informacion$Ninguno <- as.numeric(Informacion$Ninguno)
Informacion$Otro <- as.numeric(Informacion$Otro)

# vamos a crear subgrupos por localidad y luego se concatenan. Para esto creamos una función:
# Funcion:
# Esta función usa la data inicial y la localización que queremos usar:
AgrupaInforma <- function(Data,LocalizacionStr){
  
  DataLocaliza <- Data %>% 
  dplyr::filter(Localizacion==LocalizacionStr)

  DataLocaliza_v2 <- data.frame("Localizacion"=c(LocalizacionStr),
                      "Medio"=c("Computador","Portátil","Tablet","Celular","Televisor","Radio","Periódico","Revistas","Ninguno","Otro"),
                        "Subtotal"=colSums(DataLocaliza[,3:12], na.rm=T)
                        )

  DataLocaliza_v2$Total <- sum(DataLocaliza_v2$Subtotal)

  DataLocaliza_v2 <- DataLocaliza_v2 %>% 
  dplyr::mutate(Porcentaje=round((Subtotal/Total)*100,2))

return(DataLocaliza_v2)
}

# Aplicamos la función en cada localización:
Cabecera <- AgrupaInforma(Data=Informacion,LocalizacionStr="Cabecera Urbana")

VdaVinia <- AgrupaInforma(Data=Informacion,LocalizacionStr="Vereda La Viña")

VdaPalenque <- AgrupaInforma(Data=Informacion,LocalizacionStr="Vereda Palenque")

VdaGuacamayal <- AgrupaInforma(Data=Informacion,LocalizacionStr="Vereda Guacamayal")

# Concatenamos la data:
Informacion_v2 <- join_all(list(Cabecera,VdaVinia,VdaPalenque,VdaGuacamayal), by=c("Localizacion"),type = "full")

# Graficamos:
# Aunque este tipo de gráfico no es recomendabe por la cantidad de categorias:
ggplot(Informacion_v2, aes(x = Porcentaje, y = Localizacion, fill = Medio))+
  geom_bar(stat="identity",position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Medio información:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4.4, vjust=0.4, hjust=-0.05 ,col="black")+
  theme(axis.title=element_text(size=rel(1.5)),
        axis.text.x=element_text(size=rel(1.5)),
        axis.text.y=element_text(size=rel(1.5)),
        legend.title=element_text(size=rel(1.3)),
        legend.text=element_text(size=rel(1)),
        legend.position="top"
        )+
  scale_x_continuous(limits=c(0,55))+
  scale_fill_brewer(palette=1)

# Paso opcional: exportamos data:
write_xlsx(Informacion_v2, "MediosInfo.xlsx")

# Eliminamos intermedios:
rm(Informacion,Cabecera,VdaVinia,VdaPalenque,VdaGuacamayal,Informacion_v2)

#### Tema: Frecuencia de Medios de información ####
# Pregunta data: "${p_040}. ¿Con qué frecuencia usa este medio?"

Frecuencia <- PilotoIndividuos %>%
  dplyr::select(.,"Localizacion","${p_040}. ¿Con qué frecuencia usa este medio?") %>%
  dplyr::rename(FrecuenciaCol="${p_040}. ¿Con qué frecuencia usa este medio?") %>%
  dplyr::filter(is.na(FrecuenciaCol)==F)

Frecuencia_v2 <- Agrupa(Data=Frecuencia,Columna=FrecuenciaCol)
  
# Graficamos:
ggplot(Frecuencia_v2, aes(x=Porcentaje,y=Localizacion,fill=FrecuenciaCol))+
  geom_col()+
  labs(x="Porcentaje",y="Localización",fill="Frecuencia uso:")+
  geom_text(aes(label = Porcentaje),position = position_stack(0.5),
            size=4, vjust=0.5, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,100))

# Paso opcional: exportamos data:
write_xlsx(Frecuencia_v2, "FrecuenciaUso.xlsx")

# Eliminamos intermedios:
rm(Frecuencia,Frecuencia_v2)


#### Tema: Productos financieros ####
# Preguntas data: 
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Cuenta corriente"
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Cuenta de ahorros"
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/CDT"
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Préstamo para compra de vivienda"
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Préstamo para compra de vehículo"
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Préstamo para libre inversión"
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Tarjeta de crédito"
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Ninguno"
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Otro"
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/No sabe"
# "${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/No responde"

Informacion <- PilotoIndividuos %>%
  dplyr::select(.,c("Localizacion","${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Cuenta corriente","${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Cuenta de ahorros","${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/CDT","${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Préstamo para compra de vivienda","${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Préstamo para compra de vehículo","${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Préstamo para libre inversión","${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Tarjeta de crédito","${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Ninguno","${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Otro","${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/No sabe","${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/No responde")) %>%
  dplyr::rename(CtaCorriente="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Cuenta corriente",CtaAhorros="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Cuenta de ahorros",CDT="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/CDT",PrestamoVivienda="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Préstamo para compra de vivienda",PrestamoCarro="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Préstamo para compra de vehículo",PrestamoLibre="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Préstamo para libre inversión",TarjetaCredito="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Tarjeta de crédito",Ninguno="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Ninguno",Otro="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/Otro",NoSabe="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/No sabe",NoResponde="${p_040}. ¿Cuáles de los siguientes productos financieros usa principalmente?/No responde")

# Volvemos todas las columnaas en tipo numéricas:
Informacion$CtaCorriente <- as.numeric(Informacion$CtaCorriente)
Informacion$CtaAhorros <- as.numeric(Informacion$CtaAhorros)
Informacion$CDT <- as.numeric(Informacion$CDT)
Informacion$PrestamoVivienda <- as.numeric(Informacion$PrestamoVivienda)
Informacion$PrestamoCarro <- as.numeric(Informacion$PrestamoCarro)
Informacion$PrestamoLibre <- as.numeric(Informacion$PrestamoLibre)
Informacion$TarjetaCredito <- as.numeric(Informacion$TarjetaCredito)
Informacion$Ninguno <- as.numeric(Informacion$Ninguno)
Informacion$Otro <- as.numeric(Informacion$Otro)
Informacion$NoSabe <- as.numeric(Informacion$NoSabe)
Informacion$NoResponde <- as.numeric(Informacion$NoResponde)

# vamos a crear subgrupos por localidad y luego se concatenan. Para esto creamos una función:
# Funcion:
# Esta función usa la data inicial y la localización que queremos usar:
AgrupaInforma_v2 <- function(Data,LocalizacionStr){
  
  DataLocaliza <- Data %>% 
  dplyr::filter(Localizacion==LocalizacionStr)

  DataLocaliza_v2 <- data.frame("Localizacion"=c(LocalizacionStr),
                      "Medio"=c("Cta Corriente","Cta Ahorros","CDT","Prestamo Vivienda","Prestamo Carro","Prestamo Libre","Tarjeta Crédito","Ninguno","Otro","No Sabe",
                                       "No Responde"),
                        "Subtotal"=colSums(DataLocaliza[,2:12], na.rm=T)
                        )

  DataLocaliza_v2$Total <- sum(DataLocaliza_v2$Subtotal)

  DataLocaliza_v2 <- DataLocaliza_v2 %>% 
  dplyr::mutate(Porcentaje=round((Subtotal/Total)*100,2))

return(DataLocaliza_v2)
}

# Aplicamos la función en cada localización:
Cabecera <- AgrupaInforma_v2(Data=Informacion,LocalizacionStr="Cabecera Urbana")

VdaVinia <- AgrupaInforma_v2(Data=Informacion,LocalizacionStr="Vereda La Viña")

VdaPalenque <- AgrupaInforma_v2(Data=Informacion,LocalizacionStr="Vereda Palenque")

VdaGuacamayal <- AgrupaInforma_v2(Data=Informacion,LocalizacionStr="Vereda Guacamayal")

# Concatenamos la data:
Informacion_v2 <- join_all(list(Cabecera,VdaVinia,VdaPalenque,VdaGuacamayal), by=c("Localizacion"),type = "full")

Informacion_v2 <- Informacion_v2 %>% 
  dplyr::filter(Porcentaje!=0)

# Graficamos:
# Aunque este tipo de gráfico no es recomendabe por la cantidad de categorias:
ggplot(Informacion_v2, aes(x = Porcentaje, y = Localizacion, fill = Medio))+
  geom_bar(stat="identity",position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Producto Financiero:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4.4, vjust=0.4, hjust=-0.05 ,col="black")+
  theme(axis.title=element_text(size=rel(1.5)),
        axis.text.x=element_text(size=rel(1.5)),
        axis.text.y=element_text(size=rel(1.5)),
        legend.title=element_text(size=rel(1.3)),
        legend.text=element_text(size=rel(1)),
        legend.position="right"
        )+
  scale_x_continuous(limits=c(0,113))

# Paso opcional: exportamos data:
write_xlsx(Informacion_v2, "PdctoFinanciero.xlsx")

# Eliminamos intermedios:
rm(Informacion,Cabecera,VdaVinia,VdaPalenque,VdaGuacamayal,Informacion_v2,AgrupaInforma_v2)
```

```{r Modulo Educación}
#### Tema: Condición educativa actual ####
# Pregunta de data: "${p_040}. ¿Cuál es su condición educativa actualmente?"
Educacion <- PilotoIndividuos %>%
  dplyr::select(.,"Localizacion","${p_040}. ¿Cuál es su condición educativa actualmente?") %>%
  dplyr::rename(CondicionEduca="${p_040}. ¿Cuál es su condición educativa actualmente?") %>% 
  dplyr::filter(.,CondicionEduca!="No responde",
                CondicionEduca!="No sabe",
                is.na(CondicionEduca)==F)

Educacion_v2 <- Agrupa(Data=Educacion,Columna=CondicionEduca)

# Graficamos:
ggplot(Educacion_v2, aes(x=Porcentaje,y=Localizacion,fill=CondicionEduca))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Condición educativa:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.5, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,70))+
  scale_fill_brewer(palette=1)

# Paso opcional: exportamos data:
write_xlsx(Educacion_v2, "CondicionEduca.xlsx")

# Eliminamos intermedios:
rm(Educacion,Educacion_v2)

#### Tema: Causa para no continuar estudios ####
# Pregunta de data: "${p_040}. ¿Cuál fue la principal causa por la que no pudo continuar sus estudios?"

Educacion <- PilotoIndividuos %>%
  dplyr::select(.,Localizacion,"${p_040}. ¿Cuál fue la principal causa por la que no pudo continuar sus estudios?") %>%
  dplyr::rename(CausaNoEstudio="${p_040}. ¿Cuál fue la principal causa por la que no pudo continuar sus estudios?") %>% 
  dplyr::filter(.,CausaNoEstudio!="No responde",
                CausaNoEstudio!="No sabe",
                is.na(CausaNoEstudio)==F) 

# Recodificamos categorias: 
Educacion$CausaCol <- c("Causa")

Educacion <- Educacion %>% 
  dplyr::mutate(CausaCol=ifelse(CausaNoEstudio=="Considera que ya terminó sus estudios","Ya terminó",CausaCol),
                CausaCol=ifelse(CausaNoEstudio=="No le gusta o no le interesa el estudio, aburrición","No le interesa",CausaCol),
                CausaCol=ifelse(CausaNoEstudio=="Costos educativos elevados o falta de dinero","Costos educativos",CausaCol),
                CausaCol=ifelse(CausaNoEstudio=="Necesita trabajar","Necesita trabajar",CausaCol),
                CausaCol=ifelse(CausaNoEstudio=="No existe centro educativo cercano, está muy lejano","Lejanía del centro educativo",CausaCol),
                CausaCol=ifelse(CausaNoEstudio=="Por embarazo","Por embarazo",CausaCol),
                CausaCol=ifelse(CausaNoEstudio=="Falta de tiempo","Falta de tiempo",CausaCol),
                CausaCol=ifelse(CausaNoEstudio=="Recibe malos tratos en el colegio","Recibe malos tratos",CausaCol),
                CausaCol=ifelse(CausaNoEstudio=="Considera que no está en edad escolar","No está en edad escolar",CausaCol),
                CausaCol=ifelse(CausaNoEstudio=="Razones familiares","Razones familiares",CausaCol),
                CausaCol=ifelse(CausaNoEstudio=="Por enfermedad o incapacidad médica","Enfermedad o incapacidad",CausaCol),
                CausaCol=ifelse(CausaNoEstudio=="Porque se casó o formó pareja","Vida en pareja",CausaCol),
                CausaCol=ifelse(CausaNoEstudio=="Debe encargarse de los oficios del hogar (cuidado de los niños, ancianos, personas con discapacidad, etc)","Oficios del hogar",CausaCol),
                CausaCol=ifelse(CausaNoEstudio=="Necesita educación especial","Necesita educación especial",CausaCol),
                CausaCol=ifelse(CausaNoEstudio=="Por inseguridad en el establecimiento educativo, en el entorno del establecimiento o en el lugar de residencia","Inseguridad",CausaCol)  
                )

Educacion_v2 <- Agrupa(Data=Educacion,
                 Columna=CausaCol)

# Graficamos:
ggplot(Educacion_v2, aes(x=Porcentaje,y=Localizacion,fill=CausaCol))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Causa para no estudiar:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=3, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="right",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,70))

# Paso opcional: exportamos data:
write_xlsx(Educacion_v2, "CausasEduca.xlsx")

# Eliminamos intermedios:
rm(Educacion,Educacion_v2)

#### Tema: Nivel de estudios que cursa actual ####
# Pregunta data: ${p_040}. ¿Cuál es el nivel actual de estudio?"
Educacion <- PilotoIndividuos %>%
  dplyr::select(.,Localizacion,"${p_040}. ¿Cuál es el nivel actual de estudio?") %>%
  dplyr::rename(NivelEstudio="${p_040}. ¿Cuál es el nivel actual de estudio?") %>% 
  dplyr::filter(.,is.na(NivelEstudio)==F)

Educacion_v2 <- Agrupa(Data=Educacion,
                 Columna=NivelEstudio)

# Data en factores con orden predeterminado
Educacion_v2$NivelEstudio <- factor(Educacion_v2$NivelEstudio, levels=c("Primaria (1º a 5º)","Secundaria (6º a 9º)", "Media (10º a 11º)","Técnico","Tecnológico","Universidad"))

# Graficamos:
ggplot(Educacion_v2, aes(x=Porcentaje,y=Localizacion,fill=NivelEstudio))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Nivel de estudio:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="right",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,90))+
  scale_fill_brewer(palette=1)

# Paso opcional: exportamos data:
write_xlsx(Educacion_v2, "NivelEduca.xlsx")

# Eliminamos intermedios:
rm(Educacion,Educacion_v2)

#### Tema: Area del conocimiento que cursa actualmente ####
# Pregunta de data: "${p_040}. Área de conocimiento de lo que está estudiando actualmente"
Educacion <- PilotoIndividuos %>%
  dplyr::select(.,Localizacion,"${p_040}. Área de conocimiento de lo que está estudiando actualmente") %>%
  dplyr::rename(AreaEstudio="${p_040}. Área de conocimiento de lo que está estudiando actualmente") %>% 
  dplyr::filter(.,AreaEstudio!="No responde",
                is.na(AreaEstudio)==F)

Educacion_v2 <- Agrupa(Data=Educacion,
                 Columna=AreaEstudio)

# Graficamos:
ggplot(Educacion_v2, aes(x=Porcentaje,y=Localizacion,fill=AreaEstudio))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Area del conocimiento:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,105))

# Paso opcional: exportamos data:
write_xlsx(Educacion_v2, "AreaEduca.xlsx")

# Eliminamos intermedios:
rm(Educacion,Educacion_v2)

#### Tema: Ultimo título aprobado ####
# Pregunta data: "${p_040}. Último título de estudio aprobado."

Educacion <- PilotoIndividuos %>%
  dplyr::select(.,Localizacion,"${p_040}. Último título de estudio aprobado.") %>%
  dplyr::rename(Titulo="${p_040}. Último título de estudio aprobado.")%>% 
  dplyr::filter(.,Titulo!="No sabe",
                is.na(Titulo)==F)

# Data en factores con orden predeterminado
Educacion$Titulo <- factor(Educacion$Titulo, levels=c("Ninguno","Prescolar","Primaria (1º a 5º)","Secundaria (6º a 9º)", "Media (10º a 11º)","Técnico","Tecnológico","Pregrado","Maestría"))

Educacion_v2 <- Agrupa(Data=Educacion,
                 Columna=Titulo)

# Graficamos:
ggplot(Educacion_v2, aes(x=Porcentaje,y=Localizacion,fill=Titulo))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Último título:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=3.5, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="right",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,75))

# Paso opcional: exportamos data:
write_xlsx(Educacion_v2, "Tiitulo.xlsx")

# Eliminamos intermedios:
rm(Educacion,Educacion_v2)


#### Tema: Area del conocimiento Ultimo título ####
# Pregunta de data: "${p_040}. Área de conocimiento en la que obtuvo el título."
Educacion <- PilotoIndividuos %>%
  dplyr::select(.,Localizacion,"${p_040}. Área de conocimiento en la que obtuvo el título.") %>%
  dplyr::rename(AreaEstudio="${p_040}. Área de conocimiento en la que obtuvo el título.") %>% 
  dplyr::filter(.,AreaEstudio!="No responde",
                is.na(AreaEstudio)==F)

Educacion_v2 <- Agrupa(Data=Educacion,
                 Columna=AreaEstudio)

# Graficamos:
ggplot(Educacion_v2, aes(x=Porcentaje,y=Localizacion,fill=AreaEstudio))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Área del conocimiento del título:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,105))

# Paso opcional: exportamos data:
write_xlsx(Educacion_v2, "AreaEduca.xlsx")

# Eliminamos intermedios:
rm(Educacion,Educacion_v2)


#### Tema: Intereses académicos a futuro ####
# Pregunta data: "${p_040}. ¿Cuáles son sus intereses académicos a futuro? (¿Qué le gustaría aprender?)"

# Se debe mejorar el filtro en esta data
Educacion <- PilotoIndividuos %>%
  dplyr::select(.,Localizacion,"${p_040}. ¿Cuáles son sus intereses académicos a futuro? (¿Qué le gustaría aprender?)") %>%
  dplyr::rename(InteresEstudiar="${p_040}. ¿Cuáles son sus intereses académicos a futuro? (¿Qué le gustaría aprender?)") %>% 
  dplyr::filter(.,is.na(InteresEstudiar)==F,
                InteresEstudiar!="No responde",
                InteresEstudiar!="No sabe",
                InteresEstudiar!="Retomar estudios en lo que estaba estudiando",
                InteresEstudiar!="Terminar estudios actuales (solo para quien estudia)",
                InteresEstudiar!="Retomar estudios diferente a lo que estaba estudiando",
                ) 

# Data en factores con orden predeterminado
Educacion$InteresEstudiar <- factor(Educacion$InteresEstudiar, levels=c("No tiene intereses académicos","Estudiar la primaria","Estudiar la secundaria","Estudiar la media","Estudiar una técnica","Estudiar una tecnología","Estudiar un pregrado","Estudiar un posgrado"))

Educacion_v2 <- Agrupa(Data=Educacion,
                 Columna=InteresEstudiar)

# Graficamos:
ggplot(Educacion_v2, aes(x=Porcentaje,y=Localizacion,fill=InteresEstudiar))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Interés académico:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="right",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,80))

# Paso opcional: exportamos data:
write_xlsx(Educacion_v2, "InteresEduca.xlsx")

# Eliminamos intermedios:
rm(Educacion,Educacion_v2)


```

```{r Modulo Seguridad Social}
#### Tema: Afiliación al SSS ####

#"${p_040}. Afiliación al Sistema de Seguridad Social en Salud."
AfiliacionSSS <- PilotoIndividuos %>%
  dplyr::select(.,Localizacion,"${p_040}. Afiliación al Sistema de Seguridad Social en Salud.") %>%
  dplyr::rename(AfiliacionCol="${p_040}. Afiliación al Sistema de Seguridad Social en Salud.")  %>% 
  dplyr::filter(.,AfiliacionCol!="No responde",
                is.na(AfiliacionCol)==F)

Afiliacion_v2 <- Agrupa(Data=AfiliacionSSS,
                 Columna=AfiliacionCol)

# Graficamos:
ggplot(Afiliacion_v2, aes(x=Porcentaje,y=Localizacion,fill=AfiliacionCol))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Afiliación al sistema de salud:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=3.5, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,100))

# Paso opcional: exportamos data:
write_xlsx(Afiliacion_v2, "AfiliacionSalud.xlsx")

# Eliminamos intermedios:
rm(AfiliacionSSS,Afiliacion_v2)

#### Tema: Calificación: Servicios Salud  ####
# Pregunta data: "${p_040}. Según su opinión, ¿cómo califica la calidad de los servicios de salud?"

Salud <- PilotoIndividuos %>%
  dplyr::select(.,c(Localizacion,"${p_040}. Según su opinión, ¿cómo califica la calidad de los servicios de salud?")) %>%
  dplyr::rename(Calificacion="${p_040}. Según su opinión, ¿cómo califica la calidad de los servicios de salud?") %>% 
  dplyr::filter(Calificacion!="No se encuentra en casa",
                Calificacion!="No responde",
                is.na(Calificacion)==F)

# Data en factores con orden predeterminado
Salud$Calificacion <- factor(Salud$Calificacion, levels=c("Malo","Regular","Bueno"))

Salud_v2 <- Agrupa(Data=Salud,
                 Columna=Calificacion)

# Graficamos:

ggplot(Salud_v2, aes(x=Porcentaje,y=Localizacion,fill=Calificacion))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Calificación de servicios de salud:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,100))+
  scale_fill_brewer(palette=1)

# Paso opcional: exportamos data:
write_xlsx(Salud_v2, "CalificaSalud.xlsx")

# Eliminamos intermedios:
rm(Salud,Salud_v2)

#### Tema: Cotiza para pensión  ####
# Pregunta data: "${p_040}. ¿Cotiza para pensión?"

Salud <- PilotoIndividuos %>%
  dplyr::select(.,c(Localizacion,"${p_040}. ¿Cotiza para pensión?")) %>%
  dplyr::rename(Cotiza="${p_040}. ¿Cotiza para pensión?") %>% 
  dplyr::filter(Cotiza!="No sabe",
                is.na(Cotiza)==F)

Salud_v2 <- Agrupa(Data=Salud,
                 Columna=Cotiza)

# Graficamos:

ggplot(Salud_v2, aes(x=Porcentaje,y=Localizacion,fill=Cotiza))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Cotización al sistema de pensión:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,105))

# Paso opcional: exportamos data:
write_xlsx(Salud_v2, "CotizaPensión.xlsx")

# Eliminamos intermedios:
rm(Salud,Salud_v2)

#### Tema: Está afiliado a ARL  ####
# Pregunta data: "${p_040}. ¿Tiene Afiliación a una Administradora de Riesgos Laborales (ARL)?"

Salud <- PilotoIndividuos %>%
  dplyr::select(.,c(Localizacion,"${p_040}. ¿Tiene Afiliación a una Administradora de Riesgos Laborales (ARL)?")) %>%
  dplyr::rename(Cotiza="${p_040}. ¿Tiene Afiliación a una Administradora de Riesgos Laborales (ARL)?") %>% 
  dplyr::filter(Cotiza!="No sabe",
                is.na(Cotiza)==F)
          
Salud_v2 <- Agrupa(Data=Salud,
                 Columna=Cotiza)

# Graficamos:

ggplot(Salud_v2, aes(x=Porcentaje,y=Localizacion,fill=Cotiza))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Afiliación a ARL:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="right",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,105))

# Paso opcional: exportamos data:
write_xlsx(Salud_v2, "AfiliaciónARL.xlsx")

# Eliminamos intermedios:
rm(Salud,Salud_v2)


```

```{r Modulo Recreación}
#### Tema: Participación política ####
# Pregunta data: "${p_040}. ¿Usted participa en alguna de las siguientes organizaciones o instancias de participación?"

Recreacion <- PilotoIndividuos %>%
  dplyr::select(.,Localizacion,"${p_040}. ¿Usted participa en alguna de las siguientes organizaciones o instancias de participación?") %>%
  dplyr::rename(RecreacionCol="${p_040}. ¿Usted participa en alguna de las siguientes organizaciones o instancias de participación?") %>%
  dplyr::filter(RecreacionCol!="Ninguno",
                RecreacionCol!="No responde",
                is.na(RecreacionCol)==F)

# Recodificamos categorias: 
Recreacion$RecreacionCol2 <- c("Recreación")

Recreacion <- Recreacion %>% 
  dplyr::mutate(RecreacionCol2=ifelse(RecreacionCol=="Juntas administradoras locales - JAL","Juntas administradoras locales",RecreacionCol2),
                RecreacionCol2=ifelse(RecreacionCol=="Junta de acción comunal - JAC","Junta de acción comunal",RecreacionCol2),
                RecreacionCol2=ifelse(RecreacionCol=="Veedurías ciudadanas","Veedurías ciudadanas",RecreacionCol2),
                RecreacionCol2=ifelse(RecreacionCol=="Clubes del adulto mayor","Clubes del adulto mayor",RecreacionCol2),
                RecreacionCol2=ifelse(RecreacionCol=="Asociaciones de mujeres","Asociaciones de mujeres",RecreacionCol2),
                RecreacionCol2=ifelse(RecreacionCol=="sindicatos","Sindicatos",RecreacionCol2),
                RecreacionCol2=ifelse(RecreacionCol=="COPACOS - Comités de participación comunitaria en salud","COPACOS",RecreacionCol2),
                RecreacionCol2=ifelse(RecreacionCol=="Grupos juveniles","Grupos juveniles",RecreacionCol2),
                RecreacionCol2=ifelse(RecreacionCol=="Asociación de usuarios","Asociación de usuarios",RecreacionCol2)
                )


Recreacion_v2 <- Agrupa(Data=Recreacion,
                 Columna=RecreacionCol2)

# Graficamos:

ggplot(Recreacion_v2, aes(x=Porcentaje,y=Localizacion,fill=RecreacionCol2))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Instancias de participación:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,105))

# Paso opcional: exportamos data:
write_xlsx(Recreacion_v2, "Participación.xlsx")

# Eliminamos intermedios:
rm(Recreacion,Recreacion_v2)


#### Tema: Hobbies ####
# Preguntas data: 
# "${p_040}. ¿Cuáles son sus hobbies?/Bailar"
# "${p_040}. ¿Cuáles son sus hobbies?/Cantar"
# "${p_040}. ¿Cuáles son sus hobbies?/Cocina"
# "${p_040}. ¿Cuáles son sus hobbies?/Contactar y conversar"
# "${p_040}. ¿Cuáles son sus hobbies?/Coser"
# "${p_040}. ¿Cuáles son sus hobbies?/Escribir"
# "${p_040}. ¿Cuáles son sus hobbies?/Escuchar música"
# "${p_040}. ¿Cuáles son sus hobbies?/Fotografía"
# "${p_040}. ¿Cuáles son sus hobbies?/Hacer deporte"
# "${p_040}. ¿Cuáles son sus hobbies?/Informarse"
# "${p_040}. ¿Cuáles son sus hobbies?/Jardinería"
# "${p_040}. ¿Cuáles son sus hobbies?/Juegos de mesa o azar"
# "${p_040}. ¿Cuáles son sus hobbies?/Leer"
# "${p_040}. ¿Cuáles son sus hobbies?/Manualidades"
# "${p_040}. ¿Cuáles son sus hobbies?/Pintar"
# "${p_040}. ¿Cuáles son sus hobbies?/Series o cine"
# "${p_040}. ¿Cuáles son sus hobbies?/Tocar un instrumento"
# "${p_040}. ¿Cuáles son sus hobbies?/Viajar"
# "${p_040}. ¿Cuáles son sus hobbies?/Montar a caballo"
# "${p_040}. ¿Cuáles son sus hobbies?/Juegos infantiles"
# "${p_040}. ¿Cuáles son sus hobbies?/Reparación de motos"

Hobbies <- PilotoIndividuos %>%
  dplyr::select(.,c(Localizacion,"${p_040}. ¿Cuáles son sus hobbies?/Bailar",
                    "${p_040}. ¿Cuáles son sus hobbies?/Cantar",
                    "${p_040}. ¿Cuáles son sus hobbies?/Cocina",
                    "${p_040}. ¿Cuáles son sus hobbies?/Contactar y conversar",
                    "${p_040}. ¿Cuáles son sus hobbies?/Coser",
                    "${p_040}. ¿Cuáles son sus hobbies?/Escribir",
                    "${p_040}. ¿Cuáles son sus hobbies?/Escuchar música",
                    "${p_040}. ¿Cuáles son sus hobbies?/Fotografía",
                    "${p_040}. ¿Cuáles son sus hobbies?/Hacer deporte",
                    "${p_040}. ¿Cuáles son sus hobbies?/Informarse",
                    "${p_040}. ¿Cuáles son sus hobbies?/Jardinería",
                    "${p_040}. ¿Cuáles son sus hobbies?/Juegos de mesa o azar",
                    "${p_040}. ¿Cuáles son sus hobbies?/Leer",
                    "${p_040}. ¿Cuáles son sus hobbies?/Manualidades",
                    "${p_040}. ¿Cuáles son sus hobbies?/Pintar",
                    "${p_040}. ¿Cuáles son sus hobbies?/Series o cine",
                    "${p_040}. ¿Cuáles son sus hobbies?/Tocar un instrumento",
                    "${p_040}. ¿Cuáles son sus hobbies?/Viajar",
                    "${p_040}. ¿Cuáles son sus hobbies?/Montar a caballo",
                    "${p_040}. ¿Cuáles son sus hobbies?/Juegos infantiles",
                    "${p_040}. ¿Cuáles son sus hobbies?/Reparación de motos"
                    )
                ) %>%
  dplyr::rename(Bailar="${p_040}. ¿Cuáles son sus hobbies?/Bailar",
                Cantar="${p_040}. ¿Cuáles son sus hobbies?/Cantar",
                Cocina="${p_040}. ¿Cuáles son sus hobbies?/Cocina",
                Conversar="${p_040}. ¿Cuáles son sus hobbies?/Contactar y conversar",
                Coser="${p_040}. ¿Cuáles son sus hobbies?/Coser",
                Escribir="${p_040}. ¿Cuáles son sus hobbies?/Escribir",
                "Escuchar Musica"="${p_040}. ¿Cuáles son sus hobbies?/Escuchar música",
                Fotografía="${p_040}. ¿Cuáles son sus hobbies?/Fotografía",
                "Practicar deporte"="${p_040}. ¿Cuáles son sus hobbies?/Hacer deporte",
                Informarse="${p_040}. ¿Cuáles son sus hobbies?/Informarse",
                Jardinería="${p_040}. ¿Cuáles son sus hobbies?/Jardinería",
                "Juegos de azar"="${p_040}. ¿Cuáles son sus hobbies?/Juegos de mesa o azar",
                Leer="${p_040}. ¿Cuáles son sus hobbies?/Leer",
                Manualidades="${p_040}. ¿Cuáles son sus hobbies?/Manualidades",
                Pintar="${p_040}. ¿Cuáles son sus hobbies?/Pintar",
                Series="${p_040}. ¿Cuáles son sus hobbies?/Series o cine",
                "Tocar instrumento"="${p_040}. ¿Cuáles son sus hobbies?/Tocar un instrumento",
                Viajar="${p_040}. ¿Cuáles son sus hobbies?/Viajar",
                "Montar caballo"="${p_040}. ¿Cuáles son sus hobbies?/Montar a caballo",
                "Juegos infantiles"="${p_040}. ¿Cuáles son sus hobbies?/Juegos infantiles",
                "Reparación de motos"="${p_040}. ¿Cuáles son sus hobbies?/Reparación de motos"
                )

# Volvemos todas las columnaas en tipo numéricas:
Hobbies$Bailar <- as.numeric(Hobbies$Bailar)
Hobbies$Cantar <- as.numeric(Hobbies$Cantar)
Hobbies$Cocina <- as.numeric(Hobbies$Cocina)
Hobbies$Conversar <- as.numeric(Hobbies$Conversar)
Hobbies$Coser <- as.numeric(Hobbies$Coser)
Hobbies$Escribir <- as.numeric(Hobbies$Escribir)
Hobbies$`Escuchar Musica`<- as.numeric(Hobbies$`Escuchar Musica`)
Hobbies$Fotografía <- as.numeric(Hobbies$Fotografía)
Hobbies$`Practicar deporte` <- as.numeric(Hobbies$`Practicar deporte`)
Hobbies$Informarse <- as.numeric(Hobbies$Informarse)
Hobbies$Jardinería <- as.numeric(Hobbies$Jardinería)
Hobbies$`Juegos de azar` <- as.numeric(Hobbies$`Juegos de azar`)
Hobbies$Leer <- as.numeric(Hobbies$Leer)
Hobbies$Manualidades <- as.numeric(Hobbies$Manualidades)
Hobbies$Pintar <- as.numeric(Hobbies$Pintar)
Hobbies$Series <- as.numeric(Hobbies$Series)
Hobbies$`Tocar instrumento` <- as.numeric(Hobbies$`Tocar instrumento`)
Hobbies$Viajar <- as.numeric(Hobbies$Viajar)
Hobbies$`Montar caballo` <- as.numeric(Hobbies$`Montar caballo`)
Hobbies$`Juegos infantiles` <- as.numeric(Hobbies$`Juegos infantiles`)
Hobbies$`Reparación de motos` <- as.numeric(Hobbies$`Reparación de motos`)


# vamos a crear subgrupos por localidad y luego se concatenan. Para esto creamos una función:
# Funcion:
# Esta función usa la data inicial y la localización que queremos usar:
AgrupaInforma <- function(Data,LocalizacionStr){
  
  DataLocaliza <- Data %>% 
  dplyr::filter(Localizacion==LocalizacionStr)

  DataLocaliza_v2 <- data.frame("Localizacion"=c(LocalizacionStr),
                      "Hobbie"=c("Bailar","Cantar","Cocina","Conversar","Coser","Escribir","Escuchar Musica","Fotografía","Practicar deporte","Informarse","Jardinería","Juegos de azar","Leer","Manualidades","Pintar","Series","Tocar instrumento","Viajar","Montar caballo","Juegos infantiles","Reparación de motos"),
                      "Subtotal"=colSums(DataLocaliza[,2:22], na.rm=T)
                        )

  DataLocaliza_v2$Total <- sum(DataLocaliza_v2$Subtotal)

  DataLocaliza_v2 <- DataLocaliza_v2 %>% 
  dplyr::mutate(Porcentaje=round((Subtotal/Total)*100,2))

return(DataLocaliza_v2)
}

# Aplicamos la función en cada localización:
Cabecera <- AgrupaInforma(Data=Hobbies,LocalizacionStr="Cabecera Urbana")

VdaVinia <- AgrupaInforma(Data=Hobbies,LocalizacionStr="Vereda La Viña")

VdaPalenque <- AgrupaInforma(Data=Hobbies,LocalizacionStr="Vereda Palenque")

VdaGuacamayal <- AgrupaInforma(Data=Hobbies,LocalizacionStr="Vereda Guacamayal")

# Concatenamos la data:
Hobbies_v2 <- join_all(list(Cabecera,VdaVinia,VdaPalenque,VdaGuacamayal), by=c("Localizacion"),type = "full")

Hobbies_v2 <- Hobbies_v2 %>% 
  dplyr::filter(Porcentaje!=0)

# Graficamos:
# Aunque este tipo de gráfico no es recomendabe por la cantidad de categorias:
ggplot(Hobbies_v2, aes(x = Porcentaje, y = Localizacion, fill = Hobbie))+
  geom_bar(stat="identity",position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Hobbie:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=3, vjust=0.4, hjust=-0.05 ,col="black")+
  theme(axis.title=element_text(size=rel(1.5)),
        axis.text.x=element_text(size=rel(1.5)),
        axis.text.y=element_text(size=rel(1.5)),
        legend.title=element_text(size=rel(1.3)),
        legend.text=element_text(size=rel(1)),
        legend.position="right",
        legend.direction = "vertical"
        )+
  scale_x_continuous(limits=c(0,45))

# Paso opcional: exportamos data:
write_xlsx(Hobbies_v2, "Hobbies.xlsx")

# Eliminamos intermedios:
rm(Hobbies,AgrupaInforma,Cabecera,VdaVinia,VdaPalenque,VdaGuacamayal,Hobbies_v2)

```

```{r Modulo Movilidad}
#### Tema: Medio de transporte al centro educativo ####
# Pregunta data: "${p_040}. ¿Qué medio de transporte utiliza predominantemente para dirigirse a su centro educativo?"

Movilidad <- PilotoIndividuos %>%
  dplyr::select(.,Localizacion,"${p_040}. ¿Qué medio de transporte utiliza predominantemente para dirigirse a su centro educativo?") %>%
  dplyr::rename(MovilEduca="${p_040}. ¿Qué medio de transporte utiliza predominantemente para dirigirse a su centro educativo?") %>%
  dplyr::filter(is.na(MovilEduca)==F) 

Movilidad_v2 <- Agrupa(Data=Movilidad,
                 Columna=MovilEduca)

# Graficamos:

ggplot(Movilidad_v2, aes(x=Porcentaje,y=Localizacion,fill=MovilEduca))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Medio de transporte al centro educativo:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,105))+
  scale_fill_brewer(palette=1)

# Paso opcional: exportamos data:
write_xlsx(Movilidad_v2, "MovilEduca.xlsx")

# Eliminamos intermedios:
rm(Movilidad,Movilidad_v2)

#### Tema: Medio de transporte a Recreación ####
# Pregunta data: ${p_040}. ¿Qué medio de transporte utiliza predominantemente para dirigirse a su centro de recreación (para realizar hobbies)?

Movilidad <- PilotoIndividuos %>%
  dplyr::select(.,Localizacion,"${p_040}. ¿Qué medio de transporte utiliza predominantemente para dirigirse a su centro de recreación (para realizar hobbies)?") %>%
  dplyr::rename(Movil="${p_040}. ¿Qué medio de transporte utiliza predominantemente para dirigirse a su centro de recreación (para realizar hobbies)?")%>%
  dplyr::filter(Movil!="No responde",
                Movil!="No sabe",
                is.na(Movil)==F)

Movilidad_v2 <- Agrupa(Data=Movilidad,
                 Columna=Movil)

# Graficamos:

ggplot(Movilidad_v2, aes(x=Porcentaje,y=Localizacion,fill=Movil))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Medio de transporte al centro recreativo:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,105))+
  scale_fill_brewer(palette=1)

# Paso opcional: exportamos data:
write_xlsx(Movilidad_v2, "MovilRecrea.xlsx")

# Eliminamos intermedios:
rm(Movilidad,Movilidad_v2)

#### Tema: Medio de transporte al trabajo ####
# Pregunta data: "${p_040}. ¿Qué medio de transporte utiliza predominantemente para dirigirse al sitio de su empleo principal?"

Movilidad <- PilotoIndividuos %>%
  dplyr::select(.,Localizacion,"${p_040}. ¿Qué medio de transporte utiliza predominantemente para dirigirse al sitio de su empleo principal?") %>%
  dplyr::rename(Movil="${p_040}. ¿Qué medio de transporte utiliza predominantemente para dirigirse al sitio de su empleo principal?")%>%
  dplyr::filter(Movil!="No responde",
                Movil!="No sabe",
                is.na(Movil)==F)

Movilidad_v2 <- Agrupa(Data=Movilidad,
                 Columna=Movil)

# Graficamos:

ggplot(Movilidad_v2, aes(x=Porcentaje,y=Localizacion,fill=Movil))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Medio de transporte al sitio laboral:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,105))+
  scale_fill_brewer(palette=1)

# Paso opcional: exportamos data:
write_xlsx(Movilidad_v2, "MovilTrabajo.xlsx")

# Eliminamos intermedios:
rm(Movilidad,Movilidad_v2)

#### Tema: Tiempo en transportarse ####
# Pregunta data: "${p_040}. ¿Cuánto tiempo tarda en llegar a su centro educativo? (minutos)"
# Pregunta data: "${p_040}. ¿Cuánto tiempo tarda en llegar a su centro de recreación (para realizar hobbies)? (minutos)"
# Pregunta data: "${p_040}. ¿Cuánto tiempo tarda en llegar al sitio de su empleo principal? (minutos)"

Movilidad <- PilotoIndividuos %>%
  dplyr::select(.,c(Localizacion,"${p_040}. ¿Cuánto tiempo tarda en llegar a su centro educativo? (minutos)","${p_040}. ¿Cuánto tiempo tarda en llegar a su centro de recreación (para realizar hobbies)? (minutos)","${p_040}. ¿Cuánto tiempo tarda en llegar al sitio de su empleo principal? (minutos)")) %>%
  dplyr::rename(MovilEduca="${p_040}. ¿Cuánto tiempo tarda en llegar a su centro educativo? (minutos)",MovilRecrea="${p_040}. ¿Cuánto tiempo tarda en llegar a su centro de recreación (para realizar hobbies)? (minutos)",MovilTrabajo="${p_040}. ¿Cuánto tiempo tarda en llegar al sitio de su empleo principal? (minutos)") 

# Transformamos data a tipo numérico
Movilidad$MovilEduca <- as.numeric(Movilidad$MovilEduca)
Movilidad$MovilRecrea <- as.numeric(Movilidad$MovilRecrea)
Movilidad$MovilTrabajo <- as.numeric(Movilidad$MovilTrabajo)

# Creamos DFs: con promedios de tiempo por localización:

TiempoEduca <- Movilidad %>% 
  dplyr::group_by(Localizacion)%>%
    dplyr::summarise(
      Tiempo = round(mean(MovilEduca,na.rm = TRUE),2)
      )

TiempoEduca$Destino <- c("Centro educativo")


TiempoRecrea <- Movilidad %>% 
  dplyr::group_by(Localizacion)%>%
    dplyr::summarise(
      Tiempo = round(mean(MovilRecrea,na.rm = TRUE),2)
      )

TiempoRecrea$Destino <- c("Centro recreativo")

TiempoLabora <- Movilidad %>% 
  dplyr::group_by(Localizacion)%>%
    dplyr::summarise(
      Tiempo = round(mean(MovilTrabajo,na.rm = TRUE),2)
      )

TiempoLabora$Destino <- c("Sitio laboral")

# Concatenamos la data:
Tiempos <- join_all(list(TiempoEduca,TiempoRecrea,TiempoLabora), by=c("Destino"),type = "full")

# Graficamos:
ggplot(Tiempos, aes(x=Tiempo,y=Localizacion,fill=Destino))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Tiempo promedio",y="Localización",fill="Destino:")+
  geom_text(aes(label = Tiempo),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,100))+
  scale_fill_brewer(palette=1)

# Paso opcional: exportamos data:
write_xlsx(Tiempos, "TiemposMovilidad.xlsx")

# Eliminamos intermedios:
rm(Movilidad,TiempoEduca,TiempoRecrea,TiempoLabora,Tiempos)

#### Tema: Calificación vías: Educación  ####
# Pregunta data: "${p_040}. En su opinión: ¿cuál es el estado de las vías que utiliza para dirigirse a su centro educativo?"

Movilidad <- PilotoIndividuos %>%
  dplyr::select(.,c(Localizacion,"${p_040}. En su opinión: ¿cuál es el estado de las vías que utiliza para dirigirse a su centro educativo?")) %>%
  dplyr::rename(MovilEduca="${p_040}. En su opinión: ¿cuál es el estado de las vías que utiliza para dirigirse a su centro educativo?") %>%
  dplyr::filter(MovilEduca!="No se encuentra en casa",
                is.na(MovilEduca)==F)

# Data en factores con orden predeterminado
Movilidad$MovilEduca <- factor(Movilidad$MovilEduca, levels=c("Malo","Regular","Bueno"))


Movilidad_v2 <- Agrupa(Data=Movilidad,
                 Columna=MovilEduca)

# Graficamos:

ggplot(Movilidad_v2, aes(x=Porcentaje,y=Localizacion,fill=MovilEduca))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Calificación vías al centro educativo:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,105))+
  scale_fill_brewer(palette=1)

# Paso opcional: exportamos data:
write_xlsx(Movilidad_v2, "CalifiMovilEduca.xlsx")

# Eliminamos intermedios:
rm(Movilidad,Movilidad_v2)


#### Tema: Calificación vías: Recreación ####
# Pregunta data: "${p_040}. En su opinión: ¿cuál es el estado de las vías que utiliza para dirigirse a su centro de recreación"
Movilidad <- PilotoIndividuos %>%
  dplyr::select(.,c(Localizacion,"${p_040}. En su opinión: ¿cuál es el estado de las vías que utiliza para dirigirse a su centro de recreación (para realizar hobbies)?")) %>%
  dplyr::rename(MovilRecrea="${p_040}. En su opinión: ¿cuál es el estado de las vías que utiliza para dirigirse a su centro de recreación (para realizar hobbies)?") %>%
  dplyr::filter(MovilRecrea!="No se encuentra en casa",
                is.na(MovilRecrea)==F)

# Data en factores con orden predeterminado
Movilidad$MovilRecrea <- factor(Movilidad$MovilRecrea, levels=c("Malo","Regular","Bueno"))

Movilidad_v2 <- Agrupa(Data=Movilidad,
                 Columna=MovilRecrea)

# Graficamos:

ggplot(Movilidad_v2, aes(x=Porcentaje,y=Localizacion,fill=MovilRecrea))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Calificación vías al centro recreativo:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,105))+
  scale_fill_brewer(palette=1)

# Paso opcional: exportamos data:
write_xlsx(Movilidad_v2, "CalifiMovilRecrea.xlsx")

# Eliminamos intermedios:
rm(Movilidad,Movilidad_v2)

#### Tema: Calificación vías: Trabajo ####
# Pregunta data: "${p_040}. En su opinión: ¿cuál es el estado de las vías que utiliza para dirigirse al sitio de su empleo principal?"

Movilidad <- PilotoIndividuos %>%
  dplyr::select(.,c(Localizacion,"${p_040}. En su opinión: ¿cuál es el estado de las vías que utiliza para dirigirse al sitio de su empleo principal?")) %>%
  dplyr::rename(MovilTrabajo="${p_040}. En su opinión: ¿cuál es el estado de las vías que utiliza para dirigirse al sitio de su empleo principal?") %>%  dplyr::filter(MovilTrabajo!="No se encuentra en casa",
                is.na(MovilTrabajo)==F)

# Data en factores con orden predeterminado
Movilidad$MovilTrabajo <- factor(Movilidad$MovilTrabajo, levels=c("Malo","Regular","Bueno"))

Movilidad_v2 <- Agrupa(Data=Movilidad,
                 Columna=MovilTrabajo)

# Graficamos:

ggplot(Movilidad_v2, aes(x=Porcentaje,y=Localizacion,fill=MovilTrabajo))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Calificación vías al sitio laboral:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,105))+
  scale_fill_brewer(palette=1)

# Paso opcional: exportamos data:
write_xlsx(Movilidad_v2, "CalifiMovilLaboral.xlsx")

# Eliminamos intermedios:
rm(Movilidad,Movilidad_v2)
```

```{r Modulo Laboral e ingresos}
#### Tema: Actividad semana pasada ####
# Pregunta data: "${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]"

Actividad <- PilotoIndividuos %>%
  dplyr::select(.,Localizacion,"${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]") %>%
  dplyr::rename(ActividadCol="${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]") %>%  dplyr::filter(ActividadCol!="No responde",
                is.na(ActividadCol)==F) 

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=ActividadCol)

# Graficamos:

ggplot(Actividad_v2, aes(x=Porcentaje,y=Localizacion,fill=ActividadCol))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Actividad última semana:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,105))+
  scale_fill_brewer(palette=1)

# Paso opcional: exportamos data:
write_xlsx(Actividad_v2, "Actividad.xlsx")

# Eliminamos intermedios:
rm(Actividad,Actividad_v2)


#### Tema: Localización empleo ####
# Pregunta data: "${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]"
# Pregunta data: "${p_040}. ¿Municipio donde está ubicado su empleo principal?"

Actividad <- PilotoIndividuos %>%
  dplyr::select(.,c(Localizacion,"${p_040}. ¿Municipio donde está ubicado su empleo principal?")) %>%
  dplyr::rename(LocalizaTrabajo="${p_040}. ¿Municipio donde está ubicado su empleo principal?") %>% 
  dplyr::filter(is.na(LocalizaTrabajo)==F) 

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=LocalizaTrabajo)

# Graficamos:

ggplot(Actividad_v2, aes(x=Porcentaje,y=Localizacion,fill=LocalizaTrabajo))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Localización del empleo:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,105))

# Paso opcional: exportamos data:
write_xlsx(Actividad_v2, "LocalizaEmpleo.xlsx")

# Eliminamos intermedios:
rm(Actividad,Actividad_v2)

#### Tema: Sector económico empresa ####
# Pregunta data: "${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]"
# Pregunta data: "${p_040}. ¿A qué actividad específica se dedica principalmente la empresa o negocio en la que realiza su trabajo?"

Actividad <- PilotoIndividuos %>%
  dplyr::select(.,c(Localizacion,"${p_040}. ¿A qué actividad específica se dedica principalmente la empresa o negocio en la que realiza su trabajo?")) %>%
  dplyr::rename(Sector="${p_040}. ¿A qué actividad específica se dedica principalmente la empresa o negocio en la que realiza su trabajo?") %>% 
  dplyr::filter(is.na(Sector)==F) 

# Recodificamos variables:
Actividad$SectorShort <- c("Sector")

Actividad <- Actividad %>% 
  dplyr::mutate(SectorShort=ifelse(Sector=="A-Agricultura, Ganadería, Caza, Silvicultura y Pesca","A-Agricultura",SectorShort),
                SectorShort=ifelse(Sector=="C-Industrias manufactureras","C-Industrias manufactureras",SectorShort),
                SectorShort=ifelse(Sector=="H-Transporte y almacenamiento","H-Transporte y almacenamiento",SectorShort),
                SectorShort=ifelse(Sector=="G-Comercio al por mayor y por menor; reparación de vehículos y motos","G-Comercio",SectorShort),
                SectorShort=ifelse(Sector=="T-Actividades de hogares individuales.","T-Actividades de hogares",SectorShort),
                SectorShort=ifelse(Sector=="F-Construcción","F-Construcción",SectorShort),
                SectorShort=ifelse(Sector=="P-Educación","P-Educación",SectorShort),
                SectorShort=ifelse(Sector=="Q-Actividades de atención de la salud humana y asistencia social","Q-Salud humana y asistencia social",SectorShort),
                SectorShort=ifelse(Sector=="S-Otras actividades de servicios","S-Otros servicios",SectorShort),
                SectorShort=ifelse(Sector=="J-Información y comunicaciones","J-Información y comunicaciones",SectorShort),
                SectorShort=ifelse(Sector=="N-Actividades de servicio administrativo y de apoyo","N-Actividades administrativas y de apoyo",SectorShort),
                SectorShort=ifelse(Sector=="I-Alojamiento y servicios de comida","I-Alojamiento y comida",SectorShort),
                )
# Agrupamos como corresponde:
Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=SectorShort)

# Graficamos:

ggplot(Actividad_v2, aes(x=Porcentaje,y=Localizacion,fill=SectorShort))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Sector económico del empleo:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=3, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,105))

# Paso opcional: exportamos data:
write_xlsx(Actividad_v2, "SectorEmpleo.xlsx")

# Eliminamos intermedios:
rm(Actividad,Actividad_v2)


#### Tema: Posición ocupacional ####
# Pregunta data: "${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]"
# Pregunta data: "${p_040}. En este trabajo es:"

Actividad <- PilotoIndividuos %>%
  dplyr::select(.,c(Localizacion,"${p_040}. En este trabajo es:")) %>%
  dplyr::rename(Posicion="${p_040}. En este trabajo es:")%>% 
  dplyr::filter(is.na(Posicion)==F)  

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=Posicion)

# Graficamos:

ggplot(Actividad_v2, aes(x=Porcentaje,y=Localizacion,fill=Posicion))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Posición ocupacional:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=3.5, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,90))

# Paso opcional: exportamos data:
write_xlsx(Actividad_v2, "PosicionOcupacional.xlsx")

# Eliminamos intermedios:
rm(Actividad,Actividad_v2)

#### Tema: Horas en su empleo ####
# Pregunta data: "${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]"
# Pregunta data: "${p_040}. ¿Cuántas horas a la semana trabaja normalmente en ese trabajo principal?"

Actividad <- PilotoIndividuos %>%
  dplyr::select(.,c(Localizacion,"${p_040}. ¿Cuántas horas a la semana trabaja normalmente en ese trabajo principal?")) %>%
  dplyr::rename(Horas="${p_040}. ¿Cuántas horas a la semana trabaja normalmente en ese trabajo principal?")%>% 
  dplyr::filter(is.na(Horas)==F,
                Horas>0) # eliminamos valores negativos

# Transformamos data a tipo numérico
Actividad$Horas <- as.numeric(Actividad$Horas)

# Creamos DF: con promedios de tiempo por localización:

Tiempos <- Actividad %>% 
  dplyr::group_by(Localizacion)%>%
    dplyr::summarise(
      Tiempo = round(mean(Horas,na.rm = TRUE),2)
      )

# Graficamos:
ggplot(Tiempos, aes(x=Tiempo,y=Localizacion))+
  geom_bar(stat="identity", position="dodge",fill="cyan4")+
  labs(x="Horas (promedio) por semana",y="Localización")+
  geom_text(aes(label = Tiempo),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,50))+
  scale_fill_brewer(palette=1)

# Paso opcional: exportamos data:
write_xlsx(Tiempos, "HorasTrabajo.xlsx")

# Eliminamos intermedios:
rm(Actividad,Tiempos)

#### Tema: Tiene Contrato ####
# Pregunta data: "${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]"
# Pregunta data: "${p_040}. ¿Para realizar este trabajo tiene algún contrato?"

Actividad <- PilotoIndividuos %>%
  dplyr::select(.,c(Localizacion,"${p_040}. ¿Para realizar este trabajo tiene algún contrato?")) %>%
  dplyr::rename(Contrato="${p_040}. ¿Para realizar este trabajo tiene algún contrato?")%>% 
  dplyr::filter(Contrato!="No sabe",
                is.na(Contrato)==F)  

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=Contrato)

# Graficamos:

ggplot(Actividad_v2, aes(x=Porcentaje,y=Localizacion,fill=Contrato))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Tiene contrato laboral:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,90))

# Paso opcional: exportamos data:
write_xlsx(Actividad_v2, "Contrato.xlsx")

# Eliminamos intermedios:
rm(Actividad,Actividad_v2)

#### Tema: Duración Contrato ####
# Pregunta data: "${p_040}. ¿En qué actividad ocupó la mayor parte del tiempo la semana pasada? [la predominante]"
# Pregunta data: "${p_040}. ¿Para realizar este trabajo tiene algún contrato?"
# Pregunta data: "${p_040}. ¿Qué término tiene el contrato?"

Actividad <- PilotoIndividuos %>%
  dplyr::select(.,c(Localizacion,"${p_040}. ¿Qué término tiene el contrato?")) %>%
  dplyr::rename(Duracion="${p_040}. ¿Qué término tiene el contrato?")%>% 
  dplyr::filter(is.na(Duracion)==F)   

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=Duracion)

# Graficamos:

ggplot(Actividad_v2, aes(x=Porcentaje,y=Localizacion,fill=Duracion))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Duración contrato laboral:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,105))

# Paso opcional: exportamos data:
write_xlsx(Actividad_v2, "DuracionContrato.xlsx")

# Eliminamos intermedios:
rm(Actividad,Actividad_v2)


#### Tema: Ingresos laborales ####
# Pregunta data: "${p_040}. ¿Cuánto ganó el mes pasado en este empleo? o ¿Cuánto recibio el mes pasado por concepto de trabajo?"
# Atención a esta variable: es suceptible a errores de tipeo

Actividad <- PilotoIndividuos %>%
  dplyr::select(.,c(Localizacion,"${p_040}. ¿Cuánto ganó el mes pasado en este empleo? o ¿Cuánto recibio el mes pasado por concepto de trabajo?")) %>%
  dplyr::rename(Ingresos="${p_040}. ¿Cuánto ganó el mes pasado en este empleo? o ¿Cuánto recibio el mes pasado por concepto de trabajo?")%>% 
  dplyr::filter(is.na(Ingresos)==F,
                Ingresos>0) # eliminamos valores negativos 

# Transformamos data a tipo numérico
Actividad$Ingresos <- as.numeric(Actividad$Ingresos)

# Creamos DF: con promedios de tiempo por localización:

Ingresos <- Actividad %>% 
  dplyr::group_by(Localizacion)%>%
    dplyr::summarise(
      "ingreso salarial" = round(mean(Ingresos,na.rm = TRUE),0)
      )

# Graficamos:
ggplot(Ingresos, aes(x=`ingreso salarial`,y=Localizacion))+
  geom_bar(stat="identity", position="dodge",fill="cyan4")+
  labs(x="Ingreso laboral (promedio) ",y="Localización")+
  geom_text(aes(label = `ingreso salarial`),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_fill_brewer(palette=1)+
  scale_x_continuous(limits=c(0,1300000))


# Paso opcional: exportamos data:
write_xlsx(Ingresos, "IngresoLaboral.xlsx")

# Eliminamos intermedios:
rm(Actividad,Ingresos)

#### Tema: Cuantia de Otros ingresos ####
# Atención a estas variables: suceptibles a errores de tipeo
# Preguntas data: 
# "${p_040}. ¿Cuánto recibió el mes pasado por concepto de ARRIENDOS?"
# "${p_040}. ¿Cuánto recibió el mes pasado por concepto de PENSIONES O JUBILACIONES?"
# "${p_040}. ¿Cuánto EN TOTAL recibió durante los últimos 12 meses por Giros de personas del exterior?"
# "${p_040}. ¿Cuánto EN TOTAL recibió durante los últimos 12 meses por Intereses o dividendos?"
# "${p_040}. ¿Cuánto EN TOTAL recibió durante los últimos 12 meses por Subsidios del estado?"

Ingresos <- PilotoIndividuos %>%
  dplyr::select(Localizacion,"${p_040}. ¿Cuánto recibió el mes pasado por concepto de ARRIENDOS?","${p_040}. ¿Cuánto recibió el mes pasado por concepto de PENSIONES O JUBILACIONES?","${p_040}. ¿Cuánto EN TOTAL recibió durante los últimos 12 meses por Giros de personas del exterior?","${p_040}. ¿Cuánto EN TOTAL recibió durante los últimos 12 meses por Intereses o dividendos?","${p_040}. ¿Cuánto EN TOTAL recibió durante los últimos 12 meses por Subsidios del estado?") %>%
  dplyr::rename("Arriendos (mes)"="${p_040}. ¿Cuánto recibió el mes pasado por concepto de ARRIENDOS?","Pensiones (mes)"="${p_040}. ¿Cuánto recibió el mes pasado por concepto de PENSIONES O JUBILACIONES?","Giros Exterior (anual)"="${p_040}. ¿Cuánto EN TOTAL recibió durante los últimos 12 meses por Giros de personas del exterior?", "Intereses (anual)"="${p_040}. ¿Cuánto EN TOTAL recibió durante los últimos 12 meses por Intereses o dividendos?","Subsidios (anual)"="${p_040}. ¿Cuánto EN TOTAL recibió durante los últimos 12 meses por Subsidios del estado?") 

# Transformamos data a tipo numérico
Ingresos$`Arriendos (mes)` <- as.numeric(Ingresos$`Arriendos (mes)`)
Ingresos$`Pensiones (mes)` <- as.numeric(Ingresos$`Pensiones (mes)`)
Ingresos$`Giros Exterior (anual)` <- as.numeric(Ingresos$`Giros Exterior (anual)`)
Ingresos$`Intereses (anual)` <- as.numeric(Ingresos$`Intereses (anual)`)
Ingresos$`Subsidios (anual)` <- as.numeric(Ingresos$`Subsidios (anual)`)


# Creamos DFs: con promedios de tiempo por localización:
# Creamos una función para simplifcar el proceso:
# La variable es el tipo de ingresos, y VariableStr es como quiero llamar esos ingresos

TipoIngresos <- function(Variable,VariableStr){
  Data <- Ingresos %>% 
    dplyr::filter({{Variable}}>0,
                  is.na({{Variable}})==F) %>%
    dplyr::group_by(Localizacion)%>%
    dplyr::summarise(
      "Promedio Ingreso" = round(mean({{Variable}},na.rm = TRUE),0)
      )
  Data$`Tipo Ingreso` <- c(VariableStr)

  return(Data)
}

Arriendos <- TipoIngresos(Variable=`Arriendos (mes)`,
                               VariableStr="Arriendos (mes)")

Pensiones <- TipoIngresos(Variable=`Pensiones (mes)`,
                               VariableStr="Pensión (mes)")

Giros <- TipoIngresos(Variable=`Giros Exterior (anual)`,
                      VariableStr="Giros Exterior (anual)")

Intereses <- TipoIngresos(Variable=`Intereses (anual)`,
                      VariableStr="Intereses (anual)")

Subsidios <- TipoIngresos(Variable=`Subsidios (anual)`,
                      VariableStr="Subsidios (anual)")

# Concatenamos la data:
Ingresos_v2 <- join_all(list(Arriendos,Pensiones,Giros,Intereses,Subsidios), by=c("Tipo Ingreso"),type = "full")

# Graficamos:
ggplot(Ingresos_v2, aes(x=`Promedio Ingreso`,y=Localizacion,fill=`Tipo Ingreso`))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Tiempo promedio",y="Localización",fill="Tipo de ingresos:")+
  geom_text(aes(label = `Promedio Ingreso`),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_fill_brewer(palette=1)#+
  #scale_x_continuous(limits=c(0,100))


# Paso opcional: exportamos data:
write_xlsx(Ingresos_v2, "OtrosIngresos.xlsx")

# Eliminamos intermedios:
rm(Ingresos,TipoIngresos,Arriendos,Pensiones,Giros,Intereses,Subsidios,Ingresos_v2)



#### Tema: Sector económico Empleo anterior ####
# Pregunta data: "${p_040}. Anteriormente, ¿tuvo un empleo?"
# Pregunta data: "${p_040}. En su anterior empleo, ¿a qué actividad específica se dedicaba la empresa o negocio?"

Actividad <- PilotoIndividuos %>%
  dplyr::select(.,c(Localizacion,"${p_040}. En su anterior empleo, ¿a qué actividad específica se dedicaba la empresa o negocio?")) %>%
  dplyr::rename(Sector="${p_040}. En su anterior empleo, ¿a qué actividad específica se dedicaba la empresa o negocio?")%>% 
  dplyr::filter(is.na(Sector)==F) 

# Recodificamos variables:
Actividad$SectorShort <- c("Sector")

Actividad <- Actividad %>% 
  dplyr::mutate(SectorShort=ifelse(Sector=="A-Agricultura, Ganadería, Caza, Silvicultura y Pesca","A-Agricultura",SectorShort),
                SectorShort=ifelse(Sector=="B-Explotación de Minas y canteras","B-Explotación de Minas",SectorShort),
                SectorShort=ifelse(Sector=="C-Industrias manufactureras","C-Industrias manufactureras",SectorShort),
                SectorShort=ifelse(Sector=="H-Transporte y almacenamiento","H-Transporte y almacenamiento",SectorShort),
                SectorShort=ifelse(Sector=="G-Comercio al por mayor y por menor; reparación de vehículos y motos","G-Comercio",SectorShort),
                SectorShort=ifelse(Sector=="T-Actividades de hogares individuales.","T-Actividades de hogares",SectorShort),
                SectorShort=ifelse(Sector=="F-Construcción","F-Construcción",SectorShort),
                SectorShort=ifelse(Sector=="P-Educación","P-Educación",SectorShort),
                SectorShort=ifelse(Sector=="Q-Actividades de atención de la salud humana y asistencia social","Q-Salud humana y asistencia social",SectorShort),
                SectorShort=ifelse(Sector=="S-Otras actividades de servicios","S-Otros servicios",SectorShort),
                SectorShort=ifelse(Sector=="J-Información y comunicaciones","J-Información y comunicaciones",SectorShort),
                SectorShort=ifelse(Sector=="N-Actividades de servicio administrativo y de apoyo","N-Actividades administrativas y de apoyo",SectorShort),
                SectorShort=ifelse(Sector=="I-Alojamiento y servicios de comida","I-Alojamiento y comida",SectorShort),
                SectorShort=ifelse(Sector=="M-Actividades profesionales, científicas y técnicas","M-Actividades profesionales",SectorShort),
                SectorShort=ifelse(Sector=="R-Actividades Artisticas, de entretenimiento y recreación.","R-Actividades Artisticas",SectorShort)
                )
# Agrupamos como corresponde:
Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=SectorShort)

# Graficamos:

ggplot(Actividad_v2, aes(x=Porcentaje,y=Localizacion,fill=SectorShort))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Sector económico del empleo anterior:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=3, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1)),
        legend.text=element_text(size=rel(0.8)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,105))

# Paso opcional: exportamos data:
write_xlsx(Actividad_v2, "SectorEmpleoAntes.xlsx")

# Eliminamos intermedios:
rm(Actividad,Actividad_v2)


#### Tema: Intereses laborales a futuro ####
# Pregunta data: "${p_040}. ¿Cuáles son sus intereses laborales a futuro? (¿Qué le gustaría hacer?)"

Actividad <- PilotoIndividuos %>%
  dplyr::select(Localizacion,"${p_040}. ¿Cuáles son sus intereses laborales a futuro? (¿Qué le gustaría hacer?)") %>%
  dplyr::rename(InteresLaboral="${p_040}. ¿Cuáles son sus intereses laborales a futuro? (¿Qué le gustaría hacer?)")%>% 
  dplyr::filter(is.na(InteresLaboral)==F,
                InteresLaboral!="No responde",
                InteresLaboral!="No sabe",
                InteresLaboral!="Otro")

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=InteresLaboral)

# Graficamos:

ggplot(Actividad_v2, aes(x=Porcentaje,y=Localizacion,fill=InteresLaboral))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Intereses laborales a futuro:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=3.5, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,90))

# Paso opcional: exportamos data:
write_xlsx(Actividad_v2, "InteresLaboral.xlsx")

# Eliminamos intermedios:
rm(Actividad,Actividad_v2)

#### Tema: Prioridad de inversión ####
# Pregunta data: "${p_040}. En su opinión: ¿cuál debería ser la prioridad de inversión en el municipio?"

Actividad <- PilotoIndividuos %>%
  dplyr::select(Localizacion,"${p_040}. En su opinión: ¿cuál debería ser la prioridad de inversión en el municipio?") %>%
  dplyr::rename(Inversion="${p_040}. En su opinión: ¿cuál debería ser la prioridad de inversión en el municipio?") %>% 
  dplyr::filter(Inversion!="No responde",
                Inversion!="No sabe",
                Inversion!="No se encuentra en casa",
                Inversion!="Otro",
                is.na(Inversion)==F)

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=Inversion)

# Graficamos:

ggplot(Actividad_v2, aes(x=Porcentaje,y=Localizacion,fill=Inversion))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Prioridad de inversión:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=3.5, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,60))

# Paso opcional: exportamos data:
write_xlsx(Actividad_v2, "PrioridadInversion.xlsx")

# Eliminamos intermedios:
rm(Actividad,Actividad_v2)
```

```{r Modulo Proyectos productivos}
#### Tema: Tiene proyecto productivo ####
# Pregunta data: "¿Tiene este hogar algún tipo de negocio?"

Proyecto <- PilotoHogares %>%
  dplyr::select(Localizacion,"¿Tiene este hogar algún tipo de negocio?") %>%
  dplyr::rename(ProyectoCol="¿Tiene este hogar algún tipo de negocio?")%>%  dplyr::filter(is.na(ProyectoCol)==F) 

Proyecto_v2 <- Agrupa(Data=Proyecto,
                 Columna=ProyectoCol)

# Graficamos:

ggplot(Proyecto_v2, aes(x=Porcentaje,y=Localizacion,fill=ProyectoCol))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Proyectos productivos en el hogar:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,105))

# Paso opcional: exportamos data:
write_xlsx(Proyecto_v2, "Negocio.xlsx")

# Eliminamos intermedios:
rm(Proyecto,Proyecto_v2)


#### Tema: Sector económico del proyecto ####
# Pregunta data: "¿Cuál es la actividad económica del negocio?"

Actividad <- PilotoProyectos %>%
  dplyr::select(Localizacion,"¿Cuál es la actividad económica del negocio?") %>%
  dplyr::rename(Sector="¿Cuál es la actividad económica del negocio?")

# Recodificamos variables:
Actividad$SectorShort <- c("Sector")

Actividad <- Actividad %>% 
  dplyr::mutate(SectorShort=ifelse(Sector=="A-Agricultura, Ganadería, Caza, Silvicultura y Pesca","A-Agricultura",SectorShort),
                SectorShort=ifelse(Sector=="B-Explotación de Minas y canteras","B-Explotación de Minas",SectorShort),
                SectorShort=ifelse(Sector=="C-Industrias manufactureras","C-Industrias manufactureras",SectorShort),
                SectorShort=ifelse(Sector=="H-Transporte y almacenamiento","H-Transporte y almacenamiento",SectorShort),
                SectorShort=ifelse(Sector=="G-Comercio al por mayor y por menor; reparación de vehículos y motos","G-Comercio",SectorShort),
                SectorShort=ifelse(Sector=="T-Actividades de hogares individuales.","T-Actividades de hogares",SectorShort),
                SectorShort=ifelse(Sector=="F-Construcción","F-Construcción",SectorShort),
                SectorShort=ifelse(Sector=="P-Educación","P-Educación",SectorShort),
                SectorShort=ifelse(Sector=="Q-Actividades de atención de la salud humana y asistencia social","Q-Salud humana y asistencia social",SectorShort),
                SectorShort=ifelse(Sector=="S-Otras actividades de servicios","S-Otros servicios",SectorShort),
                SectorShort=ifelse(Sector=="J-Información y comunicaciones","J-Información y comunicaciones",SectorShort),
                SectorShort=ifelse(Sector=="N-Actividades de servicio administrativo y de apoyo","N-Actividades administrativas y de apoyo",SectorShort),
                SectorShort=ifelse(Sector=="I-Alojamiento y servicios de comida","I-Alojamiento y comida",SectorShort),
                SectorShort=ifelse(Sector=="M-Actividades profesionales, científicas y técnicas","M-Actividades profesionales",SectorShort),
                SectorShort=ifelse(Sector=="R-Actividades Artisticas, de entretenimiento y recreación.","R-Actividades Artisticas",SectorShort)
                )

# Agrupamos como corresponde:
Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=SectorShort)

# Graficamos:

ggplot(Actividad_v2, aes(x=Porcentaje,y=Localizacion,fill=SectorShort))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Sector económico del negocio:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,105))

# Paso opcional: exportamos data:
write_xlsx(Actividad_v2, "SectorNegocio.xlsx")

# Eliminamos intermedios:
rm(Actividad,Actividad_v2)

#### Tema: Inscrito en CC ####
# Pregunta data: "¿Está inscrito en Cámara de Comercio?"

Actividad <- PilotoProyectos %>%
  dplyr::select(Localizacion,"¿Está inscrito en Cámara de Comercio?") %>%
  dplyr::rename(Inscripcion="¿Está inscrito en Cámara de Comercio?")

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=Inscripcion)

# Graficamos:

ggplot(Actividad_v2, aes(x=Porcentaje,y=Localizacion,fill=Inscripcion))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Inscripción en Cámara de Comercio:")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,105))

# Paso opcional: exportamos data:
write_xlsx(Actividad_v2, "CCNegocio.xlsx")

# Eliminamos intermedios:
rm(Actividad,Actividad_v2)

#### Tema: Tiene RUT ####
# Pregunta data: "¿Tiene Rut?"

Actividad <- PilotoProyectos %>%
  dplyr::select(Localizacion,"¿Tiene Rut?") %>%
  dplyr::rename(Inscripcion="¿Tiene Rut?")

Actividad_v2 <- Agrupa(Data=Actividad,
                 Columna=Inscripcion)

# Graficamos:

ggplot(Actividad_v2, aes(x=Porcentaje,y=Localizacion,fill=Inscripcion))+
  geom_bar(stat="identity", position="dodge")+
  labs(x="Porcentaje",y="Localización",fill="Inscripción en Registro Único Tributario (RUT):")+
  geom_text(aes(label = Porcentaje),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_x_continuous(limits=c(0,105))

# Paso opcional: exportamos data:
write_xlsx(Actividad_v2, "RUTNegocio.xlsx")

# Eliminamos intermedios:
rm(Actividad,Actividad_v2)


#### Tema: Promedio de ingresos ####
# Pregunta data: "¿Cuál fue la ganancia neta en esta actividad el mes pasado?"

Proyectos <- PilotoProyectos %>%
  dplyr::select(Localizacion,"¿Cuál fue la ganancia neta en esta actividad el mes pasado?") %>%
  dplyr::rename(Ingresos="¿Cuál fue la ganancia neta en esta actividad el mes pasado?") %>% 
  dplyr::filter(Ingresos>0)

# Transformamos data a tipo numérico
Proyectos$Ingresos <- as.numeric(Proyectos$Ingresos)

# Creamos DF: con promedios de ganancia por localización:

Ganancia <- Proyectos %>% 
  dplyr::group_by(Localizacion)%>%
    dplyr::summarise(
      "Ganancia del negocio" = round(mean(Ingresos,na.rm = TRUE),0)
      )

# Graficamos:
ggplot(Ganancia, aes(x=`Ganancia del negocio`,y=Localizacion))+
  geom_bar(stat="identity", position="dodge",fill="cyan4")+
  labs(x="Ganancia del negocio (promedio) ",y="Localización")+
  geom_text(aes(label = `Ganancia del negocio`),position = position_dodge(1),
            size=4, vjust=0.6, hjust=0 ,col="black")+
  theme(axis.title=element_text(size=rel(1.3)),
        axis.text.x=element_text(size=rel(1.3)),
        axis.text.y=element_text(size=rel(1.3)),
        legend.title=element_text(size=rel(1.1)),
        legend.text=element_text(size=rel(1)),
        legend.position="top",
        legend.direction = "vertical")+
  scale_fill_brewer(palette=1)+
  scale_x_continuous(limits=c(0,1300000))


# Paso opcional: exportamos data:
write_xlsx(Ganancia, "GananciaNegocio.xlsx")

# Eliminamos intermedios:
rm(Proyectos,Ganancia)

```


## Eliminación de intermedios
```{r pruebas, include=FALSE}
rm(Vivienda,Vivienda_v2)
# Evitemos la notación científica:
 options(scipen=999)
# Para volver a notación cientifica:
# options(scipen=0)
urbano <-IngresosJerico %>% 
  dplyr::filter(.,Zona==1 & P_021>=12)
rural <-  IngresosJerico %>% 
  dplyr::filter(.,Zona==2 & P_021>=10)

 
```









