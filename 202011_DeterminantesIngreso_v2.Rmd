---
title: "Determinantes del Ingreso"
author: "Lehyton Arenas"
date: "12/21/2020"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Inicial: Librerías y Datas, include=FALSE}
# Librerías y data a usar:
library(tidyverse)
library(plyr); library(dplyr)
library(writexl) 
library(readxl)
library(survey)
library(jtools)

DataAnio_2017 <- read_excel("/Users/lehyton/Google Drive/Ecsim/Proyecto Agosto/3_Entregables Lehyton/Data/DataAnio_2017_v3.xlsx")
DataAnio_2018 <- read_excel("/Users/lehyton/Google Drive/Ecsim/Proyecto Agosto/3_Entregables Lehyton/Data/DataAnio_2018_v3.xlsx")
DataAnio_2019 <- read_excel("/Users/lehyton/Google Drive/Ecsim/Proyecto Agosto/3_Entregables Lehyton/Data/DataAnio_2019_v3.xlsx")

# Evitemos la notación científica:
options(scipen=999)

# Debido a que se decidió tabajar con la población mayor de edad. 
# Procedemos a filtrar y eliminar.
Adultos_2017 <- DataAnio_2017 %>% 
  filter(Edad>=18)
Adultos_2018 <- DataAnio_2018 %>% 
  filter(Edad>=18)
Adultos_2019 <- DataAnio_2019 %>% 
  filter(Edad>=18)

rm(DataAnio_2017,DataAnio_2018,DataAnio_2019)
```

## Resumen de estadísticos descriptivos
```{r Descriptivos con Survey Package, include=FALSE}

# Primero debemos dividir el Fex en 12:
Adultos_2017 <- Adultos_2017 %>% 
  mutate(FExp=fex_c_2011/12) %>% 
  select(.,-c(fex_c_2011))

# Aplicamos el Survey:
AdutosSvy_2017 <- svydesign(ids=~0,weights=~FExp,
                                  data=Adultos_2017)

# Medias: Aplicamos svymean a cada variable.
# Se hace una a una, de lo contrario los valores cambiarán debido a la eliminación causada por na.rm=T
# Haremos tres vbles a modo de prueba para 2017, en caso de más se puede intentar un FOR.
# Se apilan en un DF y se eliminan Means individuales
MeanSexo <- data.frame(svymean(~Sexo, AdutosSvy_2017, na.rm=T)) %>% 
  select(.,c("mean"))
MeanEdad <- data.frame(svymean(~Edad, AdutosSvy_2017, na.rm=T)) %>% 
  select(.,c("mean"))
MeanNivelEducativo <- data.frame(svymean(~NivelEducativo, AdutosSvy_2017,
                                         na.rm=T)) %>% 
  select(.,c("mean"))

Means_2017 <- rbind(MeanSexo,MeanEdad,MeanNivelEducativo) %>% 
  dplyr::rename(.,Mean=mean)
rm(MeanSexo,MeanEdad,MeanNivelEducativo)

# SD: Se aplica Svysd a cada variable.
# Se aplica el mismo procedimiento que en Means explicado anteriormente
SD_Sexo <- svysd(~Sexo,design = AdutosSvy_2017, na.rm = TRUE)
SD_Edad <- svysd(~Edad,design = AdutosSvy_2017, na.rm = TRUE)
SD_NivelEducativo <- svysd(~NivelEducativo,design = AdutosSvy_2017, 
                           na.rm = TRUE)
SD_2017 <- data.frame(rbind(SD_Sexo,SD_Edad,SD_NivelEducativo)) %>% 
  dplyr::rename(.,SD = "Sexo")
rm(SD_Sexo,SD_Edad,SD_NivelEducativo)

# Cuartiles: Se encuentran con svyquantile
# Se aplica el mismo procedimiento que en Means explicado anteriormente
Q_Sexo <- data.frame(svyquantile(~Sexo, design =AdutosSvy_2017, na = TRUE,
                                 c(.25,.5,.75))) %>% 
  dplyr::rename(.,Q25="X0.25",Median="X0.5",Q75="X0.75")
Q_Edad <- data.frame(svyquantile(~Edad, design =AdutosSvy_2017, na = TRUE,
                                 c(.25,.5,.75))) %>% 
  dplyr::rename(.,Q25="X0.25",Median="X0.5",Q75="X0.75")
Q_NivelEducativo <- data.frame(svyquantile(~NivelEducativo, 
                                           design =AdutosSvy_2017, na = TRUE,
                                 c(.25,.5,.75))) %>% 
  dplyr::rename(.,Q25="X0.25",Median="X0.5",Q75="X0.75")
Q_2017 <- data.frame(rbind(Q_Sexo,Q_Edad,Q_NivelEducativo))
rm(Q_Sexo,Q_Edad,Q_NivelEducativo)

# Se apila todo en un solo DF y se eliminan los anteriores pasos
Descriptivos_2017 <- cbind(Q_2017,Means_2017,SD_2017)
rm(Q_2017,Means_2017,SD_2017)
```
En la siguiente tabla se encuentra el resúmen estadístico para el año 2017. La tabla contiene en las columnas los estadísticos de: cuantil al 25%, mediana, cuantil al 75%, media y desviación estandar; mientras que en cada fila se encuentra cada una de las variables disponibles en la data construida. Evidentemente todas estas variables son cuantitativas, algunas de orden dummy y otras de orden continuo. Tal y como se puede evidenciar a continuación.

```{r Tabla Descriptivos 2017, echo=FALSE}

knitr::kable(
  Descriptivos_2017,
  caption = "Resumen estadístico Año 2017"
)
```

## Estadísticas por ciudad
La data recopilada se ha agrupado por ciudad y se han encontrado algunos resultados que vale la pena exponer. Es interesante observar como el ingreso medio de la población denominada Autoempleada es sustancialmente inferior a los ingresos medios de la ciudad; mientras que la población denominada Generadores de empleo exponen ingresos medios sustancialmente superiores.
```{r Estadísticas por Ciudad con Survey, include=FALSE}
# Solo se hace para Medellin en 2017.
# En caso de mas se puede crear una función.

# Primero debemos filtrar por ciudad: Población Gral, Autoempleados y Generadores.
# Aplicamos el survey correspondiente
Medellin_2017 <- Adultos_2017 %>% 
  dplyr::filter(AREA=="Medellin")
MedellinSvy_2017 <- svydesign(ids=~0,weights=~FExp,
                                  data=Medellin_2017)

MedellinAutoem_2017 <- Adultos_2017 %>% 
  dplyr::filter(AREA=="Medellin"& Autoempleado==1)
MedellinAutoSvy_2017 <- svydesign(ids=~0,weights=~FExp,
                                  data=MedellinAutoem_2017)

MedellinGener_2017 <- Adultos_2017 %>% 
  dplyr::filter(AREA=="Medellin"& GeneradorEmpleo==1)
MedellinGenerSvy_2017 <- svydesign(ids=~0,weights=~FExp,
                                  data=MedellinGener_2017)

# Se sacan las medias correspondientes, recordar que es una a una.
# Se apilan en un solo DF.
# se eliminan intermedios
Medellin_MeanEduca <- data.frame(svymean(~AniosEscolaridad, 
                                         MedellinSvy_2017, na.rm=T)) %>%
                          select(.,c("mean")) %>% 
  dplyr::rename(.,Medellin="mean")

Medellin_MeanIngreso <- data.frame(svymean(~IngresoLaboral_Mes, 
                                         MedellinSvy_2017, na.rm=T)) %>% 
  select(.,c("mean")) %>% 
  dplyr::rename(.,Medellin="mean")

Medellin_MeanIngAuto <- data.frame(svymean(~IngresoLaboral_Mes, 
                                         MedellinAutoSvy_2017, na.rm=T)) %>% 
  select(.,c("mean")) %>% 
  dplyr::rename(.,Medellin="mean")

Medellin_MeanIngGener <- data.frame(svymean(~IngresoLaboral_Mes, 
                                         MedellinGenerSvy_2017, na.rm=T)) %>% 
  select(.,c("mean")) %>% 
  dplyr::rename(.,Medellin="mean")

Medellin_Means <- data.frame(t(rbind(Medellin_MeanEduca,
                                            Medellin_MeanIngreso,
                                 Medellin_MeanIngAuto,
                                 Medellin_MeanIngGener))) %>% 
  dplyr::rename(.,"Años de escolaridad"="AniosEscolaridad",
                "Ingreso"="IngresoLaboral_Mes",
                "Ingreso de Autoempleadores"="IngresoLaboral_Mes1",
                "Ingreso de Generadores"="IngresoLaboral_Mes2")

Medellin_Means
rm(Medellin_2017,MedellinSvy_2017,MedellinAutoem_2017,MedellinAutoSvy_2017,
   MedellinGener_2017,MedellinGenerSvy_2017,Medellin_MeanEduca,
   Medellin_MeanIngreso,Medellin_MeanIngAuto,Medellin_MeanIngGener)
```

```{r Tabla Ciudad 2017, echo=FALSE}

knitr::kable(
  Medellin_Means,
  caption = "Estadísticas Ciudad Año 2017"
)
```










































